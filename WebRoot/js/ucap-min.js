var appPath="/"+location.pathname.split("/")[1]+"/";var hostPath=location+"";hostPath=hostPath.substring(0,hostPath.indexOf(appPath));Ext.onReady(function(){Ext.namespace("ucapSession");Ext.namespace("ucapCommonFun");Ext.namespace("ucapButtonFunConfirm");Ext.QuickTips.init()});if(typeof(ucapHeader)=="undefined"){var ucapHeader={sUserStylePath:appPath+"uistyle/style_1/",menuType:1,navType:1,viewOpenType:1,userJson:"",indexType:"",index:""}}var ucapSession={appPath:appPath,hostPath:hostPath,sUserStylePath:ucapHeader.sUserStylePath,sUserImgPath:ucapHeader.sUserStylePath+"ucapimages/",userJson:ucapHeader.userJson,indexType:ucapHeader.indexType,viewOpenType:ucapHeader.viewOpenType,appUnid:ucapHeader.appUnid,index:ucapHeader.index,newdocType:ucapHeader.newdocType,opendocType:ucapHeader.opendocType,baseAction:appPath+"BaseAction.action",middleHeight:0,win:{winImg:"<img src='"+appPath+"uistyle/images/icon/icon_87.gif' align='absmiddle' ></img>&nbsp;",winBodyStyle:"background-color:#FFF;padding:10px 14px 0px 14px;"},mainLeft:"ucapMainLeft",portalID:"portal_id",ucapModuleId:"ucapModule",leftArrowheadId:"leftArrowhead",ucapViewId:"ucapView",portal_info:"portal_info",commonWin:null,docWin:null,userDefineWin:null,commonSelectWin:null,loginAppJson:"",fvs_sp:","};Ext.BLANK_IMAGE_URL=ucapSession.appPath+"uistyle/images/s.gif";var ucapCommonFun={isHead:1,autoMenuHeight:function(){var d=ucapCommonFun.isHead;var e=parseInt(Ext.getDom("footer").clientHeight)||0;var f=parseInt(Ext.getDom("headerBox").clientHeight)||0;var b=Ext.getDoc().dom.body.clientHeight;var h=b-(d?f:0)-e;ucapSession.middleHeight=h-10;if(Ext.getDom("mainRight")){Ext.getDom("mainRight").style.height=(h-10)+"px"}if(Ext.getDom("leftArrowhead")){Ext.getDom("leftArrowhead").style.height=(h-10)+"px";Ext.getDom("leftArrowhead").style.paddingTop=((h-10)/2-20)+"px"}if(Ext.getCmp("ucap_deptTree")){Ext.getCmp("ucap_deptTree").setHeight(ucapSession.middleHeight)}if(Ext.getCmp("ucap_dictTree")){Ext.getCmp("ucap_dictTree").setHeight(ucapSession.middleHeight)}if(Ext.getCmp("ucap_columnsTree")){Ext.getCmp("ucap_columnsTree").setHeight(ucapSession.middleHeight)}if(ucapPortal.portal){ucapPortal.portal.setHeight(ucapSession.middleHeight)}if(Ext.getCmp("ucapMenu_tree")){Ext.getCmp("ucapMenu_tree").setHeight(ucapSession.middleHeight)}var a=Ext.query("div[id=info]");if(a&&a.length>0){var g=h-(24)*a.length-37;for(var c=0;c<a.length;c++){a[c].style.height=g+"px"}}a=Ext.query("div[id=ucap_menuFlex]");if(a&&a.length>0){var g=h-(28)*a.length-19;for(var c=0;c<a.length;c++){a[c].style.height=g+"px"}}},refreshParentView:function(){if(window.opener&&window.opener.ucapCommonFun.ucapCurOpenType!=1){window.opener.view.refresh()}if(window.parent&&window.parent.ucapCommonFun.ucapCurOpenType!=1){if(window.parent.ucapCurOpenDocViewId!=""&&typeof window.parent.ucapCurOpenDocViewId!="undefined"){var e=window.parent.Ext.getDom("ifr"+window.parent.ucapCurOpenDocViewId);if(e){e=e.contentWindow;if(e){e.view.refresh()}}else{if(window.parent.view){window.parent.view.refresh()}}}else{if(window.parent.view){window.parent.view.refresh()}}var a=_UcapForm.handler.allView;for(var b in a){var c=$(b);if(c&&c.tagName.toLowerCase()=="iframe"){var d=c.contentWindow;if(d&&d.view){d.view.refresh()}}}}},executeInteraction:function(interactionId,json,from){var requestConfig={url:ucapSession.baseAction,params:{type:"common",sid:interactionId},jsonData:json,callback:function(options,success,response){if(null!=response.responseText&&response.responseText!=""){try{var resultJson=Ext.decode(response.responseText);var exResult=ucapCommonFun.dealException(resultJson);if(!exResult){return}var callBackFn=resultJson.callBackFn;if(callBackFn&&"string"!=callBackFn&&callBackFn!=""){eval(callBackFn+"(response.responseText);")}else{var msg=resultJson.msg;var result=resultJson.result;if(null==msg||msg==""){if(result=="true"){alert("操作成功")}else{alert("操作失败")}}else{alert(msg)}if("undefined"!=typeof(from)){if(from==0){window.location=window.location;ucapCommonFun.refreshParentView()}else{if(from==1){view.refresh()}}}}}catch(Exception){if(response.responseText.indexOf("true")>=0){alert("操作成功")}else{alert("操作失败")}}}else{Ext.Msg.alert("提示","无返回操作结果提示信息！")}}};Ext.Ajax.request(requestConfig)},getDisplayNames:function(c,b,e){var a=ucapSession.baseAction;if(typeof e=="undefined"){e=""}a+="?unid="+b+"&sourceType="+c+"&dictUnid="+e+"&type=getDisplayName&rand="+Math.random();var d=Ext.lib.Ajax.getConnectionObject().conn;d.open("GET",a,false);d.send(null);return d.responseText},setViewWidth:function(){if(view==null||undefined==view.namePrefix||view.viewBaseInfos==undefined){return}var d=document.body.offsetWidth;var a=ucapModule.deductViewDivId;if(typeof a!="undefined"&&a!=""){var c=a.split(",");for(var b=0;b<c.length;b++){if(typeof Ext.getDom(c[b])!="undefined"&&Ext.getDom(c[b])){d=d-Ext.getDom(c[b]).offsetWidth}}}if("undefined"!=typeof Ext.getDom(ucapSession.mainLeft)&&Ext.getDom(ucapSession.mainLeft)!=null){d=d-Ext.getDom(ucapSession.mainLeft).offsetWidth;if(Ext.getDom(ucapSession.leftArrowheadId)!=null){d=d-Ext.getDom(ucapSession.leftArrowheadId).offsetWidth}}var f=Ext.getDom("viewCategories");if("undefined"!=f&&f!=null){d=d-f.offsetWidth-5}for(var b=0;b<view.viewBaseInfos.length;b++){var e=Ext.getCmp(view.namePrefix+b);e.setWidth(d)}},moduleMenuClk:function(g,c,a,f){c=parseInt(c,10);a=parseInt(a,10);if(c==1){this.indexOpen.openView(g,"",f)}else{if(c==2){viewTabs.isInit=false;if(g.toLowerCase().indexOf("http://")==-1){g=ucapSession.appPath+g}if(a=="01"||a==1){this.indexOpen.openUrl(g)}else{if(a=="02"||a==2){Ext.getDom(ucapSession.portalID).innerHTML="";var b=Ext.get(ucapSession.ucapViewId);var d=b.getUpdater();d.update({url:g,scripts:true});Ext.getDom(ucapSession.ucapViewId).style.height=ucapSession.middleHeight+"px"}else{if(a=="03"||a==3){if(Ext.getDom(ucapSession.portalID)){Ext.getDom(ucapSession.portalID).innerHTML=""}if(Ext.getDom(ucapSession.ucapViewId)){var e="ifram_"+this.getRandomString();Ext.getDom(ucapSession.ucapViewId).innerHTML=this.getIframeHtml(g,e,ucapSession.middleHeight);Ext.getDom(e).src=g}else{alert("ok")}}}}}else{if(c==4){this.evalJavaScript(g)}}}},evalJavaScript:function(js){if(typeof js=="undefined"||js==""){return true}try{return eval(js)}catch(e){return false}},dealException:function(a){if(null!=a&&null!=a.exceptionType){if(a.exceptionType=="01"){if(null!=window.opener){if(window.opener){window.opener.location.reload()}window.close()}else{window.location.reload()}}else{alert(a.exceptionMsg)}return false}return true},indexOpen:{open:function(d,b,a,c){if(b==1){this.openModule(d)}else{if(b==2){this.openView(d,c)}else{if(b==3){ucapCommonFun.moduleMenuClk(d,2,a)}else{if(b==4){ucapCommonFun.evalJavaScript(d)}else{if(b==9){this.openDoc(d)}}}}}},openMainPage:function(){Ext.getDom(ucapSession.ucapViewId).innerHTML="";Ext.getDom(ucapSession.portalID).innerHTML="";Ext.getDom(ucapSession.ucapModuleId).style.display="none";Ext.getDom(ucapSession.leftArrowheadId).style.display="none";ucapPortal.init()},openView:function(c,b,a){if(typeof b!="undefined"&&b!=""){if(Ext.getDom(ucapSession.ucapModuleId)){Ext.getDom(ucapSession.ucapModuleId).innerHTML="";Ext.getDom(ucapSession.ucapModuleId).style.display="none"}if(Ext.getDom(ucapSession.leftArrowheadId)){Ext.getDom(ucapSession.leftArrowheadId).style.display="none"}}if(ucapSession.viewOpenType==1){if(typeof a=="undefined"){a=c}initView(c,ucapSession.ucapViewId,a,true)}else{initView(c,ucapSession.ucapViewId)}},openUrl:function(a){window.open(a)},openModule:function(a){ucapModule.setModuleHtml(a,ucapSession.ucapModuleId);ucapCommonFun.autoMenuHeight()},openDoc:function(a){window.open(a)}},newFlowDoc:function(a){var b="0";if(typeof a!="undefined"&&a!=""){b=b+"~"+a}ucapOpenFlow.openFlowDialog(ucapCommonFun.ucapOpenDoc,b)},newFlowDocByFlowIds:function(c,a){var b="0";if(typeof a!="undefined"&&a!=""){b=b+"~"+a}ucapOpenFlow.openFlowDialogByFlowIds(c,ucapCommonFun.ucapOpenDoc,b)},ucapCurOpenDocViewId:"",ucapCurOpenType:"",ucapOpenDoc:function(b,e,g,k,c){var j="";if((typeof b=="undefined")||b==""){Ext.Msg.alert("提示信息","打开文档的Url不能为空1");return}if(typeof e=="undefined"){Ext.Msg.alert("提示信息","文档的类型docType不能为空");return}if(e==""){e="0"}if((e+"").indexOf("~")>-1){var f=(e+"").split("~");e=f[0];if(typeof g=="undefined"||g==""){g=f[1]}if(f.length>2){j=f[2]}}e=parseInt(e,10);if(typeof g=="undefined"||g==""){if(e==0){g=ucapSession.newdocType}else{g=ucapSession.opendocType}}var h=e==0?"文档新建":"文档编辑";g=parseInt(g,10);var d=window;ucapCommonFun.ucapCurOpenDocViewId="";if(top!=self){d=parent;d.ucapCurOpenDocViewId=view.viewId}var a=ucapCommonFun.getUrlParameter("r");if(a=="0"&&a!=""){b=b+"r="+a}if(null!=j&&j!=""){b+=j}d.ucapCommonFun.ucapCurOpenType=g;if(g==1){if(b.toLowerCase().indexOf("http:")==-1){b=ucapSession.hostPath+b}b+="&div=1";if(top!=self){d.ucapCommonFun.ucapCurOpenType=2;d.ucapCommonFun.ucapOpenDiv(b,k,c,d,h)}else{d.ucapCommonFun.moduleMenuClk(b,"02","03")}}else{if(g==2){d.ucapCommonFun.ucapOpenDiv(b,k,c,d,h)}else{window.open(b,"","loaction=no,fullscreen=no,status=yes,toolbar=no,scrollbars=no,menubar=no,resizable=yes,top=0,left=0,width="+(screen.availWidth-10)+",height="+(screen.availHeight-30))}}},ucapOpenDiv:function(b,a,e,d,f){if(!d){d=window}if(typeof a=="undefined"||a==""){a=d.document.body.clientHeight-30}if(typeof e=="undefined"||e==""){e=d.document.body.clientWidth-100}b=b+"&div=1";var g="_UcapOpenDociFrame";if($(g)){g="_UcapOpenDociFrame1"}var c=' <iframe id="'+g+'" name="_UcapSaveiFrame"  width="100%" height="100%" frameborder="0"  src=""></iframe>';d.ucapSession.docWin=new d.Ext.Window({title:ucapSession.win.winImg+f,width:e,closable:true,maximizable:true,modal:true,height:a,bodyStyle:ucapSession.win.winBodyStyle,html:c});d.ucapSession.docWin.show();d.Ext.getDom(g).src=b},viewButton:{fatherDocIsEdit:function(){if(window.parent){return window.parent._UcapForm.cfg.isRead==1}else{return true}}},buttonFun:{modifyUser:function(a,b){window.open(ucapSession.appPath+"sys/jsp/document.jsp?unid="+a+"&type=03&formId=4A4357091F6399787EA58F85824F6E2F&deptUnid="+b)},changeUserStatus:function(){var b="sys/cfgJsp/portal/selectUserStatus.jsp";var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.changeUserStatusConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"切换用户身份",width:210,closable:true,modal:true,height:300,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},loginOut:function(){var a={url:ucapSession.baseAction,params:{type:"loginWriteOff"},callback:function(d,f,c){if(f){var e=Ext.util.JSON.decode(c.responseText);var b=ucapCommonFun.dealException(e);if(!b){return}window.location=ucapSession.appPath+"login.jsp"}else{Ext.Msg.alert("提示","注销不成功，请重试！")}}};Ext.Ajax.request(a)},changeSystem:function(c){if(typeof(c)=="undefined"){c=""}loginType=c;var b="login/appSelect.jsp";var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.changeSystemConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];var d="切换应用系统";if(c=="style"){d="切换风格"}ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+d,width:500,closable:true,modal:true,height:420,autoScroll:true,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},gotoIndex:function(a){var d=a.indexType;var b=a.index;if(typeof(d)=="undefined"){d="01"}var c=parseInt(d,10);var e="sys/jsp/index.jsp";if(c==1||c==2){window.location.href=ucapSession.appPath+e}else{if(c==3){ucapCommonFun.indexOpen.openUrl(b)}}},userDefine:function(){var c="";if(ucapSession.userJson.userStatus==3){c="个人自定义"}else{if(ucapSession.userJson.userStatus==2){c="部门自定义"}else{c="应用系统管理员自定义"}}var b="sys/cfgJsp/portal/userDefine.jsp";var a=[{text:"关闭",handler:function(){ucapSession.userDefineWin.close()}}];ucapSession.userDefineWin=new Ext.Window({title:ucapSession.win.winImg+c,width:210,closable:true,modal:true,height:330,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.userDefineWin.show()},changeMenuStyle:function(){var b="sys/cfgJsp/portal/selectMenuType.jsp";var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.schemeConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"切换菜单类型",width:510,closable:true,modal:true,height:320,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},changeNavStyle:function(){var b="sys/cfgJsp/portal/selectNavType.jsp";var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.schemeConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"切换导航栏类型",width:210,closable:true,modal:true,height:200,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},setNavContent:function(){var b="sys/cfgJsp/nav/nav.jsp";var c="";if(ucapMenu.navigation&&ucapMenu.navigation.navigation&&ucapMenu.navigation.navigation.shortcutCondition){c=ucapMenu.navigation.navigation.shortcutCondition}b+="?cut="+c;var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.navConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"导航栏内容定制",width:410,closable:true,modal:true,height:240,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},setCuts:function(){var b="sys/cfgJsp/cut/cut.jsp";var a=[{text:"关闭",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"快捷方式定制",width:310,closable:true,modal:true,height:240,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},setScheme:function(){var c="sys/cfgJsp/portal/setScheme.jsp";var a=230;if(ucapSession.userJson.userStatus!=3){c="sys/cfgJsp/unit/setScheme.jsp";a=320}var b=[{text:"确定",handler:function(){ucapButtonFunConfirm.schemeConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"界面方案设置",width:500,closable:true,modal:true,height:a,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},recover:function(){if(ucapSession.userJson.userStatus==1){Ext.Msg.alert("提示","你当前身份是应用系统管理员，不能进行恢复操作！");return}var b="sys/cfgJsp/portal/recover.jsp";var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.recoverConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"恢复默认设置",width:210,closable:true,modal:true,height:290,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},changeLayout:function(){var b="sys/cfgJsp/portal/selectLayout.jsp";var a=[{text:"确定",handler:function(){ucapButtonFunConfirm.changeLayoutConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"切换布局",width:550,closable:true,modal:true,height:430,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},setMainPage:function(){return" onclick=\"this.style.behavior='url(#default#homepage)';this.setHomePage('"+window.location+"');\" "},analogDept:function(){alert("analogDept")},favorites:function(){window.external.addFavorite(window.location.href,window.title)}},bindForm:function(json,applyIf){if(Ext.isEmpty(json)){return false}if(Ext.type(json)=="string"){json=json.replace(/\n|\r/g," ");json=Ext.util.JSON.decode(json)}if(Ext.type(json)=="object"){var _v="";var _domClick=function(path,o){try{path=path.replace(/(,)$/,"");var objs=Ext.DomQuery.select(path,o);Ext.each(objs,function(obj){obj.click()})}catch(e){alert(e.description)}};var getPDiv=function(ooo){var fg=false;if(ooo){var op=ooo.parentNode;if(op&&op.tagName.toLowerCase()=="div"){fg=op}else{fg=getPDiv(op)}}return fg};for(fkey in json){var o=Ext.getDom(fkey)||Ext.query("[id="+fkey+"]")||Ext.query("#"+fkey+"");if(typeof o=="undefined"||o==""||o==null){continue}if(o&&json[fkey]&&Ext.type(json[fkey])=="object"){try{var bindEvs=function(){var itemEvs=json[fkey]["itemEvents"];if(itemEvs){for(var k=0;k<itemEvs.length;k++){var iev=itemEvs[k];var allobj=Ext.query("[name="+fkey+"],[id="+fkey+"]");for(var i=0;i<allobj.length;i++){Ext.get(allobj[i]).on(iev.eType,function(){var obe=this;eval(iev.eValue+"(obe)")},allobj[i])}}}};bindEvs();if(Ext.type(o)!="array"){if(!applyIf){Ext.applyIf(o,json[fkey])}else{Ext.apply(o,json[fkey])}}else{o=o[0]}_v=json[fkey]["value"];switch(o.tagName.toLowerCase()){case"input":switch(o.getAttribute("type").toLowerCase()){case"checkbox":var rdv=_v;var path="";if(Ext.type(rdv)=="array"){for(var i=0;i<rdv.length;i++){var v=_v[i]["value"]||"";path+="[id="+fkey+'][value="'+v+'"],'}}else{if(Ext.type(rdv)=="string"){if(_v.indexOf(ucapSession.fvs_sp)>-1){var ay_v=_v.split(ucapSession.fvs_sp);Ext.each(ay_v,function(v){path+="[id="+fkey+'][value="'+v+'"],'})}else{path="[id="+fkey+'][value="'+_v+'"],'}}}if(path){_domClick(path,getPDiv(o))}break;case"radio":if(_v&&_v[0]&&Ext.type(_v)!="string"){_v=_v[0]["value"]||""}var path="[id="+fkey+'][value="'+_v+'"],';_domClick(path,getPDiv(o));break;default:var cnObj=Ext.getDom(fkey+"_Cn_");if(_v&&_v[0]&&Ext.type(_v)!="string"){if(cnObj){cnObj.value=""}Ext.each(_v,function(v,n){var vt=v.text;var vv=v.value;if(cnObj){if(n==0){_v=(vv==undefined?vt:vv);cnObj.value=vt}else{cnObj.value+=ucapSession.fvs_sp+vt;_v+=ucapSession.fvs_sp+(vv==undefined?vt:vv)}}else{if(n==0){_v=(vt==undefined?vv:vt)}else{_v+=ucapSession.fvs_sp+(vt==undefined?vv:vt)}}})}o.value=_v}break;case"select":if(_v&&_v[0]&&Ext.type(_v)!="string"){_v=_v[0]["value"]||_v}var path='option[value="'+_v+'"]';var objs=Ext.DomQuery.select(path,o);Ext.each(objs,function(obj){obj.selected=true});break;default:if(_v&&_v[0]&&Ext.type(_v)!="string"){var result=_v[0].text;for(var n=1;n<_v.length;n++){result+=ucapSession.fvs_sp+_v[n].text}_v=result}if(json&&json[fkey]&&json[fkey].sourceType=="09"){_v='<a class="red" onclick="window.open(\''+_v+'\');" target="_blank" style="cursor:hand;" title="单击下载文件">单击下载</a>'}if(o.innerHTML==undefined){o.innerText=_v}else{o.innerHTML=_v}break}var isRead=json[fkey]["readOnly"];if(isRead){try{var allobj=Ext.query("[name="+fkey+"],[id="+fkey+"]");for(var i=0;i<allobj.length;i++){allobj[i].setAttribute("disabled",true)}}catch(e){}o.setAttribute("readOnly",true)}}catch(e){}}}}},getFormJSon:function(h,b,f){var d=Ext.getDom(h);if(!d){return false}h="div#"+h+" input[type!=button],select,textarea";var a=[];if(Ext.type(h)=="string"){h=Ext.DomQuery.select(h);Ext.each(h,function(j,k){a[k]=ucapCommonFun.getObjValueJson(j,"",d)})}var g={};for(var c=0;c<a.length;c++){var e=a[c];g[e.k]=e.v}return g},getObjValueJson:function(obj,v,formDom){var s={};if(!Ext.DomQuery.pseudos.selected){}Ext.DomQuery.pseudos.selected=function(c){var r=[];for(var i=0,l=c.length;i<l;i++){if(c[i].selected==true){r[r.length]=c[i]}}return r};formDom=(!formDom)?document:formDom.dom;obj=Ext.getDom(obj);if(!obj){return s}var name=obj.getAttribute("id")||obj.getAttribute("name");var value="";switch(obj.tagName.toLowerCase()){case"input":switch(obj.getAttribute("type").toLowerCase()){case"checkbox":var path="input:checked[id="+name+"]";var objs=Ext.DomQuery.select(path,formDom);value="";Ext.each(objs,function(obj,n){if(n!=0){value+=ucapSession.fvs_sp}value+=obj.value});break;case"radio":var path="input:checked[id="+name+"]";var objs=Ext.DomQuery.select(path,formDom);if(objs&&objs.length>0){value=objs[0].value}break;default:var eeObj=Ext.fly("eWebEditor_"+obj.id);if(eeObj){try{eval("obj.value = eWebEditor_"+obj.id+".getHTML()")}catch(e){}}value=obj.value}break;case"select":var path="option:selected";var objs=Ext.query(path,obj);if(objs&&objs.length>0){value=objs[0].value}break;case"span":value=obj.innerHTML;break;case"div":value=obj.innerHTML;break;default:value=obj.value}s.k=name;s.v=v||value;return s},setFormValue:function(d,b){var a="";for(fkey in d){var c=d[fkey];if(typeof c=="string"){c=c.replace(/'/g,"\\'").replace(/\\/g,"/")}else{if(c==null||c==undefined){c=""}}if(a==""){a=fkey+":{value:'"+c+"'}"}else{a+=","+fkey+":{value:'"+c+"'}"}}a="{"+a+"}";this.bindForm(a,b)},getJsonValue:function(d,c){var b="";c[0]+="";b+=d[0]+":{value:'"+c[0].replace(/'/g,"\\'")+"'}";for(var a=1;a<d.length;a++){if(typeof(c[a])!="undefined"){c[a]+=""}b+=","+d[a]+":{value:'"+c[a].replace(/'/g,"\\'")+"'}"}return b},selectTag:function(d,e){var a=Ext.getDom("tableCustomMenu").getElementsByTagName("li");var c=a.length;for(var b=0;b<c;b++){a[b].className=""}e.className="CustomMenuHover";for(var b=0;b<c;b++){Ext.getDom("tagContent"+b).style.display="none"}Ext.getDom(d).style.display="block"},addOption:function(a,b,c){if(a==null){return}a.options.add(new Option(c,b))},moveOption:function(b,d){var a=false;if(null==b.options||b.options.length<1){return a}for(var e=0;e<b.options.length;e++){var g=b.options[e];if(g.selected){if(d<0&&(e+d)<0){return a}if(d>0&&(e+d)>(b.options.length-1)){return a}var c=b.options[e].value;var f=b.options[e].innerText;b.options[e].value=b.options[e+d].value;b.options[e].innerText=b.options[e+d].innerText;b.options[e+d].value=c;b.options[e+d].innerText=f;b.options[e+d].selected=true;a=true;break}}return a},getUrlParameter:function(b){var d=location.search.slice(1).split("&");for(var c=0;c<d.length;c++){var a=d[c].split("=");if(a[0]==b){return a[1]}}return""},getOpenerUrlParameter:function(b){if(!this.haveOpener()){return""}var d=window.opener.location.search.slice(1).split("&");for(var c=0;c<d.length;c++){var a=d[c].split("=");if(a[0]==b){return a[1]}}return""},getParentUrlParameter:function(b){var d=window.parent.location.search.slice(1).split("&");for(var c=0;c<d.length;c++){var a=d[c].split("=");if(a[0]==b){return a[1]}}return""},haveOpener:function(){if(!window.opener){return false}if(typeof(window.opener.location+"")=="undefined"){return false}return true},getRandomString:function(){var a=new Date();return(a.getHours().toString()+a.getMinutes().toString()+a.getSeconds().toString())},getIframeHtml:function(b,c,a){if(typeof a=="undefined"){a="600"}return'<iframe id="'+c+'" name="'+c+'"  width="100%" height="'+a+'" frameborder="0" src="'+b+'"></iframe>'},getSelfIframeHtml:function(b,d,a){if(typeof a=="undefined"){a="100%"}var c=' onload="ucapCommonFun.iframeFitHeight(this)" ';return'<iframe id="'+d+'" name="'+d+'" '+c+' width="100%" height="'+a+'" frameborder="0" src="'+b+'"></iframe>'},iframeFitHeight:function(f){try{var b=f.name?window.frames[f.name]:f.contentWindow;var a=b.document.body.scrollHeight;var c=b.document.body.scrollWidth;if(c<600){c=600;f.style.width=c+"px"}if(a<500){a=500}f.style.height=a+"px"}catch(d){}},getViewTip:function(c,b){var f=ucapSession.baseAction;f+="?viewId="+c+"&type=viewTip&unid="+b+"&rand="+Math.random();var h=Ext.lib.Ajax.getConnectionObject().conn;h.open("GET",f,false);h.send(null);if(null==h.responseText||h.responseText==""){return""}var g=Ext.util.JSON.decode(h.responseText);var e=ucapCommonFun.dealException(g);if(!e){return}var d=g.items;if(typeof d=="undefined"){return""}var a=ucapCommonFun.getQHtml(g);return a},getQHtml:function(d){var a="<table class='titleTipTb'>";var b=d.items;for(var c=0;c<b.length;c++){a+="<tr>";a+="<td class='titleTipTitleTd' >"+b[c].title+":</td>";a+="<td class='titleTipVTd'>"+b[c].value+"</td>";a+="</tr>"}a+="</table>";return a}};var ucapButtonFunConfirm={changeUserStatusConfirm:function(){var b=ucapCommonFun.getFormJSon("userDialogHtml");if(b.type=="2"&&b.dept==""){Ext.Msg.alert("提示","以部门管理员的身份登录，必须选择一个部门！");return}var a={url:ucapSession.baseAction,params:{type:"switchUserStatus",userType:b.type,deptUnid:b.dept},callback:function(e,g,d){if(g){var f=Ext.util.JSON.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}window.location.reload()}else{Ext.Msg.alert("提示","切换用户身份不成功，请重试！")}}};Ext.Ajax.request(a)},changeSystemConfirm:function(){var c=ucapCommonFun.getFormJSon("dialogHtml");if(c.appList==""){for(var b=0;b<ucapSession.loginAppJson.appList.length;b++){if(ucapSession.loginAppJson.lastApp==ucapSession.loginAppJson.appList[b].unid){c.appList=b;break}}}var a={url:"login.action",params:{type:"afterChoose",styleUnid:ucapSession.loginAppJson.styleList[c.appStyle].unid,isDefault:c.defaultOption,schemeUnid:ucapSession.loginAppJson.scheme[c.appList].unid},jsonData:ucapSession.loginAppJson.appList[c.appList],callback:function(g,h,f){if(h){var d=Ext.util.JSON.decode(f.responseText);var e=ucapCommonFun.dealException(d);if(!e){return}ucapCommonFun.buttonFun.gotoIndex(ucapSession.loginAppJson.scheme[c.appList])}}};Ext.Ajax.request(a);ucapSession.commonWin.hide()},schemeConfirm:function(){var b=ucapCommonFun.getFormJSon("dialogHtml");var a={url:ucapSession.baseAction,params:{type:"setScheme"},jsonData:b,callback:function(e,g,d){if(g){var f=Ext.util.JSON.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}window.location.reload()}else{Ext.Msg.alert("提示","自定义设置不成功，请重新设置！")}}};Ext.Ajax.request(a)},changeLayoutConfirm:function(){var b=ucapCommonFun.getFormJSon("dialogHtml");var a={url:ucapSession.baseAction,params:{type:"portal",act:"changeLayout",portalId:ucapPortal.ucapPortalObj.unid},jsonData:b,callback:function(e,g,d){if(g){var f=Ext.util.JSON.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}ucapPortal.init();ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","切换布局不成功，请重试！")}}};Ext.Ajax.request(a)},recoverConfirm:function(){var b=ucapCommonFun.getFormJSon("dialogHtml");if(b.recover==""){Ext.Msg.alert("提示","请选一项进行恢复设置！");return}var a={url:ucapSession.baseAction,params:{type:"recover",recoverType:b.recover,fvs_sp:ucapSession.fvs_sp},callback:function(e,g,d){if(g){var f=Ext.util.JSON.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}window.location.reload()}else{Ext.Msg.alert("提示","恢复不成功，请重试！")}}};Ext.Ajax.request(a)},navConfirm:function(){var b=ucapCommonFun.getFormJSon("dialogNavHtml");var a={url:ucapSession.baseAction,params:{type:"nav",act:"save"},jsonData:b,callback:function(e,g,d){var f=Ext.util.JSON.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}if(g&&d.responseText=="true"){ucapMenu.initNavigation();ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","导航栏设置不成功！")}}};Ext.Ajax.request(a)}};function $F(a){return $(a).value}function $(a){return Ext.getDom(a)}function $V(b){try{return _UcapForm.tool.getFormValue(b,true)}catch(a){return""}}function loadfile(c,b){if(!isjscssfile(c,b)){var a="http://"+location.host+appPath+c;if(b=="js"){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a)}else{if(b=="css"){var d=document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",a)}}if(typeof d!="undefined"){document.getElementsByTagName("head")[0].appendChild(d)}}}function isjscssfile(d,c){var a=d;var f=(c=="js")?"script":(c=="css")?"link":"none";var e=(c=="js")?"src":(c=="css")?"href":"none";var g=document.getElementsByTagName(f);for(var b=g.length;b>=0;b--){if(g[b]&&g[b].getAttribute(e)!=null&&g[b].getAttribute(e).indexOf(a)!=-1){return true}}return false}Ext.namespace("ucapMenuConfig");var ucapMenuConfig={type:1,htmlType:1,title:"",leftWidth:185,displayName:"",saveNewImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_103.gif"/>',saveImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_29.gif"/>',closeImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_102.gif"/>',rootUnid:"",treeJson:[],oldJson:[],html:"",tree:null,root:null,newRootId:"_ucapMenuNew",height:500,saveFlag:false,isNewFlag:false,preHtml:"",cutNode:null,win:"",initValue:function(){this.oldJson=null;this.preHtml="";this.tree=null;this.treeJson=[]},openMenuConfig:function(b,a){if(typeof(a)=="undefined"){a=false}this.initValue();if(!b||typeof(b)=="undefined"){this.isNewFlag=false}else{this.isNewFlag=b}this.type=1;this.title="系统";this.displayName="应用系统";if(!a){ucapMenuConfig.initWinBox()}this.createMenuTree()},openModeuleByView:function(a){this.openModuleConfig(a)},openModuleConfig:function(c,b){var a=false;if(typeof c=="undefined"||c==""){c="";a=true}if(typeof b=="undefined"){b=""}this.initValue();this.isNewFlag=a;this.html="sys/cfgJsp/menuModule/moduleRoot.jsp";this.type=2;this.title="模块";if(this.isNewFlag){this.rootUnid=this.newRootId;this.displayName="新建模块"}else{this.createModuleTree(c)}if(b==""){this.initWinBox()}this.createTree()},createMenuTree:function(){if(this.isNewFlag){ucapMenuConfig.rootUnid=this.newRootId;ucapMenuConfig.createTree();return}var b={type:"menu",act:"getAllMenu",menuType:"tree",edit:"1"};var a={url:ucapSession.baseAction,params:b,callback:function(e,g,d){if(d.responseText==""){ucapMenuConfig.isNewFlag=true;ucapMenuConfig.rootUnid=ucapMenuConfig.newRootId;ucapMenuConfig.createTree();return}else{if(g){var f=Ext.util.JSON.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}if(typeof f.uiMenu=="undefined"){ucapMenuConfig.treeJson=[]}else{ucapMenuConfig.treeJson=f.uiMenu}ucapMenuConfig.rootUnid=f.unid;ucapMenuConfig.displayName=f.name;ucapMenuConfig.createTree()}}}};Ext.Ajax.request(a)},createModuleTree:function(b){var d=ucapSession.baseAction;d+="?type=module&act=getModuleMenu&moduleUnid="+b+"&random="+ucapCommonFun.getRandomString();var f=Ext.lib.Ajax.getConnectionObject().conn;f.open("GET",d,false);f.send(null);var a=f.responseText;if(a.indexOf("error")>-1){Ext.Msg.alert("提示","从后台获取模块内容时出错，模块的ID为"+b);return""}var e=Ext.decode(a);var c=ucapCommonFun.dealException(e);if(!c){return}this.displayName=e.displayName;this.moduleUnid=e.unid;this.rootUnid=this.moduleUnid;if(typeof e.uiModule=="undefined"){this.treeJson=[]}else{this.treeJson=e.uiModule}},initWinBox:function(){var c=[{text:"重命名",id:"menuFileRename",handler:onItemClick},"-",{text:"删除",id:"menuFileDelete",handler:onItemClick}];var b=[{text:"文件",menu:{items:[{text:"新建",id:"menuFileNew",handler:onItemClick},"-",{text:"关闭",id:"menuFileClose",handler:onItemClick}]}},{text:"编辑",menu:{items:c}},{text:"查看",menu:{items:[{text:"展开",id:"menuExpand",handler:onItemClick},{text:"折叠",id:"menuCollapse",handler:onItemClick},{text:"全部展开",id:"menuExpandAll",handler:onItemClick},{text:"全部折叠",id:"menuCollapseAll",handler:onItemClick}]}},"-",{text:"新建",id:"menuNew",handler:onItemClick},{text:"删除",id:"menuDelete",handler:onItemClick},{text:"恢复默认",id:"menuRecover",handler:onItemClick},{text:"变更生效",id:"menuAppChange",handler:onItemClick},"-"];ucapMenuConfig.win=new Ext.Window({title:ucapSession.win.winImg+this.title+"定制窗口",closable:true,width:700,height:this.height,modal:true,bodyStyle:ucapSession.win.winBodyStyle,tbar:b,plain:true,layout:"border",items:[{title:'<div id="menuConfigTitle"></div>',region:"west",html:'<div id="leftTree">正在加载菜单，请稍等......</div>',width:this.leftWidth,autoScroll:true,collapsible:true,split:true},{id:"centerId",region:"center",html:'<div id="ucapCenter"></div>',buttonAlign:"right",tbar:["->",{text:this.saveNewImg+"保存并新增下一下",handler:function(){ucapMenuConfig.save("",1)}},{text:this.saveImg+"保存",id:"menuSave",handler:function(){ucapMenuConfig.save()}},{text:this.closeImg+"关闭",id:"menuClose",handler:onItemClick}]}]});ucapMenuConfig.win.show();var a=ucapMenuConfig.win.getTopToolbar();a.addField(new Ext.form.Checkbox({name:"saveInfo",fieldLabel:"1",boxLabel:"保存成功时有提示",checked:true}));if(ucapSession.userJson.userStatus==1){Ext.getCmp("menuRecover").setDisabled(true)}ucapMenuConfig.win.on("beforeclose",function(){try{if(ucapMenuConfig.saveFlag&&ucapSession.userJson.userStatus!=1){if(ucapMenuConfig.type==1){ucapMenu.init()}else{ucapModule.setModuleHtml(ucapModule.moduleUnid,ucapSession.ucapModuleId)}ucapMenuConfig.saveFlag=false}}catch(d){}})},createTree:function(){this.preHtml="";this.tree=null;this.htmlType="";var e=this.title+"菜单定制";this.setWinTitle(e);Ext.DomHelper.applyStyles(Ext.get("leftTree"),'style="padding:3px 0px 0px 5px;"');Ext.getDom("leftTree").innerHTML="";var d;if(typeof(this.treeJson)!="undefined"){d=new Ext.tree.AsyncTreeNode({expanded:true,id:this.rootUnid,text:this.displayName,children:this.treeJson})}else{d=new Ext.tree.AsyncTreeNode({expanded:true,id:this.rootUnid,leaf:true,text:this.displayName})}var c=new Ext.tree.TreePanel({renderTo:"leftTree",root:d,animate:true,rootVisible:true,enableDD:true,autoScroll:true,containerScroll:true,height:ucapMenuConfig.height-92,loader:new Ext.tree.TreeLoader({dataUrl:""})});c.on("click",function(){ucapMenuConfig.isNewFlag=false;ucapMenuConfig.loadHtml()});c.addListener("movenode",ucapMenuConfig.handleMoveNode);c.on("contextmenu",b);function b(f){f.select();ucapMenuConfig.setButtonState();a.show(f.ui.getAnchor())}var a=new Ext.menu.Menu({items:[{id:"menuRightNew",text:"新建",icon:"",handler:onItemClick},{id:"menuRightDelete",text:"删除",icon:"",handler:onItemClick},{text:"重命名",icon:"",handler:function(){onItemClick("menuRename")}}]});this.tree=c;d.select();this.root=d;this.loadHtml()},loadHtml:function(c){var h=false;if(typeof(c)!="undefined"){h=c}var e=this.getSelectNode();var a=e.id;var g;if(ucapMenuConfig.type==2){if(e.id==this.root.id){if(e.id==this.newRootId||!this.isNewFlag){this.htmlType=2}else{this.htmlType=3}}else{this.htmlType=3}if(this.htmlType==2){g={type:"module",act:"getModuleRoot",unid:a,random:ucapCommonFun.getRandomString()};ucapMenuConfig.html="sys/cfgJsp/menuModule/moduleRoot.jsp"}else{g={type:"module",act:"getModuleItem",unid:a,random:ucapCommonFun.getRandomString()};ucapMenuConfig.html="sys/cfgJsp/menuModule/module.jsp"}}else{if(e.id==this.root.id){if(e.id==this.newRootId||!this.isNewFlag){this.htmlType=4}else{this.htmlType=1}}else{this.htmlType=1}if(this.htmlType==4){ucapMenuConfig.html="sys/cfgJsp/menuModule/menuRoot.jsp";g={type:"menu",act:"getMenuRoot",unid:a,random:ucapCommonFun.getRandomString()}}else{ucapMenuConfig.html="sys/cfgJsp/menuModule/menu.jsp";g={type:"menu",act:"getMenuItem",unid:a,random:ucapCommonFun.getRandomString()}}}if(h){return}if(this.isNewFlag){ucapMenuConfig.preHtml=""}var b=ucapSession.appPath+ucapMenuConfig.html;if(ucapMenuConfig.preHtml!=ucapMenuConfig.html){var d=Ext.get("ucapCenter");var f=d.getUpdater();f.update({url:b,scripts:true});f.on("update",function(){if(ucapSession.userJson.userStatus!=1){if(Ext.getDom("systemSet")){Ext.getDom("systemSet").style.display="none"}}ucapMenuConfig.setValue(a,g)});ucapMenuConfig.preHtml=ucapMenuConfig.html}else{ucapMenuConfig.setValue(a,g)}},setButtonState:function(){var a=ucapMenuConfig.getSelectNode();if(ucapMenuConfig.root.id==ucapMenuConfig.newRootId){Ext.getCmp("menuNew").setDisabled(true);Ext.getCmp("menuRightNew").setDisabled(true);Ext.getCmp("menuFileNew").setDisabled(true);Ext.getCmp("menuDelete").setDisabled(true);Ext.getCmp("menuRightDelete").setDisabled(true);Ext.getCmp("menuFileDelete").setDisabled(true);return}else{Ext.getCmp("menuDelete").setDisabled(false);Ext.getCmp("menuRightDelete").setDisabled(false);Ext.getCmp("menuFileDelete").setDisabled(false)}if(!a.isLeaf()||a.id==ucapMenuConfig.root.id||ucapMenuConfig.oldJson.type=="09"){Ext.getCmp("menuFileNew").setDisabled(false);Ext.getCmp("menuNew").setDisabled(false);Ext.getCmp("menuRightNew").setDisabled(false)}else{Ext.getCmp("menuFileNew").setDisabled(true);Ext.getCmp("menuNew").setDisabled(true);Ext.getCmp("menuRightNew").setDisabled(true)}},setValue:function(a,d,c){if(this.isNewFlag){ucapMenuConfig.setButtonState();return}var b={url:ucapSession.baseAction,params:d,callback:function(h,l,g){if(l){var j=Ext.decode(g.responseText);var f=ucapCommonFun.dealException(j);if(!f){return}ucapCommonFun.setFormValue(j);if(j!=null){if(Ext.getDom("interaction_Cn_")){Ext.getDom("interaction_Cn_").value=ucapCommonFun.getDisplayNames("227",Ext.getDom("interaction").value)}if(Ext.getDom("unuseScopes_Cn_")){Ext.getDom("unuseScopes_Cn_").value=ucapCommonFun.getDisplayNames("200,201,202,203",Ext.getDom("unuseScopes").value)}if(Ext.getDom("useScopes_Cn_")){Ext.getDom("useScopes_Cn_").value=ucapCommonFun.getDisplayNames("200,201,202,203",Ext.getDom("useScopes").value)}try{if(Ext.getDom("smallPicture")){titleModuleIconChange(Ext.getDom("smallPicture"))}if(Ext.getDom("picture")){titleMenuIconChange(Ext.getDom("picture"))}}catch(k){}}ucapMenuConfig.oldJson=ucapCommonFun.getFormJSon("menuConfigdialogHtml");ucapMenuConfig.setButtonState()}else{Ext.Msg.alert("提示","取值不成功，请重试！")}}};Ext.Ajax.request(b)},save:function(g,j){if(typeof j=="undefined"){j=""}var d=ucapCommonFun.getObjValueJson("saveInfo").v;var h=true;if(typeof(g)=="undefined"||g==""){h=false}var k;if(!h){k=ucapCommonFun.getFormJSon("menuConfigdialogHtml");if(j==""){if(Ext.encode(ucapMenuConfig.oldJson)==Ext.encode(k)){Ext.Msg.alert("保存提示","当前数据未更改，无须保存！");return}}}else{ucapMenuConfig.loadHtml(true);if(ucapMenuConfig.htmlType==2){k={displayName:g}}else{k={name:g}}}var a=ucapMenuConfig.getSelectNode();var c=a.id;var e="";if(ucapMenuConfig.isNewFlag){if(a.id==ucapMenuConfig.root.id){e="newSaveByRoot"}else{e="newSave"}}var b;if(ucapMenuConfig.htmlType==1){b={type:"menu",act:"saveMenuItem",flag:e,unid:c,random:ucapCommonFun.getRandomString()}}else{if(ucapMenuConfig.htmlType==2){b={type:"module",act:"saveModuleRoot",flag:e,unid:c,random:ucapCommonFun.getRandomString()}}else{if(ucapMenuConfig.htmlType==3){b={type:"module",act:"saveModuleItem",flag:e,unid:c,random:ucapCommonFun.getRandomString()}}else{if(ucapMenuConfig.htmlType==4){b={type:"menu",act:"saveMenuRoot",flag:e,unid:c,random:ucapCommonFun.getRandomString()}}}}}var f={url:ucapSession.baseAction,params:b,jsonData:k,callback:function(n,q,m){if(q){var p=Ext.decode(m.responseText);var l=ucapCommonFun.dealException(p);if(!l){return}ucapMenuConfig.oldJson=ucapCommonFun.getFormJSon("menuConfigdialogHtml");if(!h&&d!=""&&j==""){Ext.Msg.alert("提示","保存信息成功！")}if(ucapMenuConfig.isNewFlag){ucapMenuConfig.newSaveConfig(k,m)}else{ucapMenuConfig.oldSaveConfig(k,m)}if(j==1){var o=ucapMenuConfig.getSelectNode();if(o.id!=ucapMenuConfig.tree.getRootNode().id){o.parentNode.select()}ucapMenuConfig.isNewFlag=true;ucapMenuConfig.loadHtml()}ucapMenuConfig.setButtonState()}else{Ext.Msg.alert("提示","保存不成功，请重试！")}}};Ext.Ajax.request(f)},newSaveConfig:function(c,a){var d=ucapMenuConfig.getSelectNode();var e=Ext.decode(a.responseText);if(d.id==ucapMenuConfig.newRootId){d.id=e.unid;if(ucapMenuConfig.type==1){d.setText(e.name)}else{d.setText(e.displayName)}d.leaf=true;ucapMenuConfig.rootUnid=d.id;ucapMenuConfig.root=d}else{if(d.id==ucapMenuConfig.root.id){d.id=e.text;ucapMenuConfig.rootUnid=d.id;ucapMenuConfig.root=d}e.text=(c.name);d.expand();var b=new Ext.tree.TreeNode(e);d.leaf=false;d.icon="";d.appendChild(b);b.select()}ucapMenuConfig.isNewFlag=false},oldSaveConfig:function(b,a){ucapMenuConfig.saveFlag=true;var c=ucapMenuConfig.getSelectNode();if(a.responseText.indexOf("nochange")>-1){if(ucapMenuConfig.htmlType==2){c.setText(b.displayName)}else{c.setText(b.name)}}else{var d=Ext.decode(a.responseText);if(c.id==ucapMenuConfig.root.id){c.id=d.unid;if(ucapMenuConfig.type==1){c.setText(d.name)}else{c.setText(d.displayName)}}else{c.id=d.id;c.attributes.belongToUsers=d.belongToUsers;c.attributes.belongToDepts=d.belongToDepts;c.setText(d.text);c.qtip=d.qtip}}},getSelectNode:function(){return ucapMenuConfig.tree.getSelectionModel().getSelectedNode()},setWinTitle:function(a){Ext.getDom("menuConfigTitle").innerHTML=a},paste:function(){var a=ucapMenuConfig.getSelectNode();ucapMenuConfig.handleMoveNode(ucapMenuConfig.tree,ucapMenuConfig.cutNode,ucapMenuConfig.cutNode.parentNode,a.parentNode,a.parentNode.indexOf(a));ucapMenuConfig.cutNode=null;Ext.getCmp("paste").setDisabled(true);Ext.getCmp("menuPaste").setDisabled(true)},handleMoveNode:function(k,a,g,j,d){var f="module";if(ucapMenuConfig.type==1){f="menu"}var c="item";if(g.id==ucapMenuConfig.root.id){c="root"}var h="item";if(j.id==ucapMenuConfig.root.id){h="root"}var b={type:f,act:"move",unid:a.id,index:d,oldParentId:g.id,newParentId:j.id,oldParentType:c,newParentType:h,random:ucapCommonFun.getRandomString()};var e={url:ucapSession.baseAction,params:b,callback:function(n,p,m){if(p){var o=Ext.decode(m.responseText);var l=ucapCommonFun.dealException(o);if(!l){return}if(m.responseText=="false"){Ext.Msg.alert("移动提示","移动不能被保存，无法生效！");return}ucapMenuConfig.saveFlag=true}else{Ext.Msg.alert("移动提示","移动不能被保存，无法生效！")}}};Ext.Ajax.request(e)},deleteNode:function(a){if(typeof(a)=="undefined"){a=true}var c=function(){var f=d.id;var h="item";var j="";var l="item";if(d.id==ucapMenuConfig.root.id){h="root"}else{j=d.parentNode.id}if(j==ucapMenuConfig.root.id){l="root"}var k="module";if(ucapMenuConfig.type==1){k="menu"}var m={type:k,act:"delete",flag:h,unid:f,fatherUnid:j,fatherType:l,random:ucapCommonFun.getRandomString()};var g={url:ucapSession.baseAction,params:m,callback:function(p,u,o){if(u){var t=Ext.decode(o.responseText);var n=ucapCommonFun.dealException(t);if(!n){return}ucapMenuConfig.saveFlag=true;var q=ucapMenuConfig.getSelectNode();if(h!="root"){var s=Ext.decode(o.responseText);var r=q.parentNode;if(r.id==ucapMenuConfig.root.id){q.parentNode.id=s.unid;ucapMenuConfig.rootUnid=s.unid;ucapMenuConfig.root=r}else{r.id=s.id}q.remove();r.select();ucapMenuConfig.loadHtml()}else{if(o.responseText!="newtree"){var s=Ext.decode(o.responseText);if(ucapMenuConfig.type==1){ucapMenuConfig.treeJson=s.uiMenu;ucapMenuConfig.rootUnid=s.unid;ucapMenuConfig.displayName=s.name;ucapMenuConfig.createTree()}else{ucapMenuConfig.displayName=s.displayName;ucapMenuConfig.moduleUnid=s.unid;ucapMenuConfig.treeJson=s.uiModule;ucapMenuConfig.rootUnid=s.unid;ucapMenuConfig.createTree()}}else{if(ucapMenuConfig.type==1){ucapMenuConfig.openMenuConfig("",1)}else{ucapMenuConfig.openModuleConfig("",1)}}}}else{Ext.Msg.alert("提示","删除或恢复不成功，请重试！")}}};Ext.Ajax.request(g)};var d=ucapMenuConfig.getSelectNode();if(a){var e="";var b="";if(!d.isLeaf()){b="<br><br>删除时将同时删除其下所有的子节点"}if(ucapSession.userJson.userStatus==1){e="你当前是应用系统管理员身份，"+b+"且此操作不可恢复，你是否确定删除？"}else{if(ucapSession.userJson.userStatus==2){e="你当前是部门管理员身份，"+b+"你是否确定删除？"}else{e="你是否确定要删除选中的节点"+b+"？"}}Ext.MessageBox.confirm("删除提示",e,function(f){if(f=="yes"){c()}})}else{c()}}};var onItemClick=function(a){var b=a.id||a;switch(b){case"menuNew":ucapMenuConfig.isNewFlag=true;ucapMenuConfig.loadHtml();break;case"menuRightNew":ucapMenuConfig.isNewFlag=true;ucapMenuConfig.loadHtml();break;case"menuFileNew":ucapMenuConfig.isNewFlag=true;ucapMenuConfig.loadHtml();break;case"menuRecover":Ext.MessageBox.confirm("恢复提示","你是否确定恢复整个菜单<br>你自定义的所有节点都将被删除，并恢复到初始状态，请确认？",function(c){if(c=="yes"){ucapMenuConfig.root.select();ucapMenuConfig.deleteNode(false)}},this);break;case"menuDelete":ucapMenuConfig.deleteNode();break;case"menuRightDelete":ucapMenuConfig.deleteNode();break;case"menuFileDelete":ucapMenuConfig.deleteNode();break;case"menuClose":ucapMenuConfig.win.close();break;case"menuFileClose":ucapMenuConfig.win.close();break;case"menuExpandAll":ucapMenuConfig.getSelectNode().expand(true);break;case"menuExpand":ucapMenuConfig.getSelectNode().expand();break;case"menuCollapseAll":ucapMenuConfig.getSelectNode().collapse(true);break;case"menuCollapse":ucapMenuConfig.getSelectNode().collapse();break;case"menuRename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(d,c){if(d=="ok"){if(c==""){Ext.Msg.alert("改名提示","名称不能为空！");return}ucapMenuConfig.save(c)}},this);break;case"menuFileRename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(d,c){if(d=="ok"){ucapMenuConfig.save(c)}},this);break;case"menuAppChange":if(ucapMenuConfig.type==1){ucapMenu.init()}else{ucapModule.setModuleHtml(ucapModule.moduleUnid,ucapSession.ucapModuleId)}ucapMenuConfig.saveFlag=false;break;default:alert(a.id+"代码未实现！")}};var pfx_ucap="ucap_";var _UcapForm={mainDiv:"_ucap_main_div",cfg:{otherAction:"",otherSaveAction:"",defaultPath:appPath+"html/"+(ucapSession.appUnid||"")+"/",systemPath:appPath+"html/system/",docTitle:{},mainUnid:null,mainFormType:null,unid:null,curFormId:null,curFormType:null,isTabNew:null,tab:null,form:null,formShow:null,composeForm:null,subButtonList:null,uiItemList:null,showLodingId:null,isRead:null,fatherIsRead:"",formType:null,jspTmpStr:{formJson:{id:"showBoxNoTab","class":"showContent"},form:'<div id="{id}"></div>',composeFormJson:{id:"showTabBody","class":"showContent"},composeForm:'<div id="showBox">									<div id="showMenu">								    	<ul id="showMenuUL">								        </ul>								    </div>									<div id="showMenuLine"><div id="fl"></div></div>									<div id="{id}" class="{class}">								    </div>								</div>'},htmlTmpStr:{form:'<div main=## id="'+pfx_ucap+'{unid}" class="" htmlUrl="{htmlUrl}"></div>',input_html:'<input type="{type}" id="{name}" name="{name}" value="{value}"/>{text}&#160;',select_html:'<select name="{name}" id="{name}" value="{value}"></select>',option_html:'<OPTION name="{name}_{i}" id="{name}_{i}" value="{value}">{text}</OPTION>',btn_cn_html:'<input id="{id}_Cn_" type="text" class="{class}" readOnly/>&#160;<input id="btn_{id}" class="btnChannel" value="{text}" type="button"/>',areabtn_html:'<textarea id="{id}_Cn_" class="{class}" readOnly row="2"></textarea>&#160;<input id="btn_{id}" class="btnChannel" value="{text}" type="button"/>',ucap_img:'<img src="{src}" id="{id}" onclick="{onclick}"></img>',btn_html:'<input id="btn_{id}" class="btnChannel" value="{text}" type="button"/>',file_html:'<form name="form_{id}" action="" enctype="multipart/form-data" method="post" target="iframe{id}"><input id="{id}" type="text" class="{class}" readOnly/><br/><div id="div_{id}" style="display:{display}">请选择要上传的文件：<input name="file" id="file_{id}" type="file" style1="width:0px;" value="" style="display:none1;"/></div>{downFile}</form><iframe name="iframe{id}" src="#" style="width:0px;height:0px;"></iframe>',downhtml:"{downFile}"},tabTmp:'<li id="{unid}" types="{types}" contents="{contents}" onclick="{tabclick}" style="cursor:hand;"><span qtip="{name}" style="width:70px;overflow:hidden; word-break:keep-all; white-space:nowrap; text-overflow:ellipsis;">{name}</span></li>',tabBodyTmp:'<div main=# id="'+pfx_ucap+'{unid}" style="display:none;" types="{types}" contents="{contents}"></div>',tabContentsTmp:'<div main=## id="'+pfx_ucap+'{unid}" style="display:none1;" types="{types}"></div>',toolBarBtnTmp:{defaultStr:'<a href="javascript:void(0);"><img src="'+ucapHeader.sUserStylePath+'ucapimages/{picture}" title="{tip}" onclick="{code}"/>{name1}</a>',btn:'<button title="{tip}" onclick="{code}" class=btnn1 onmouseover="this.className=\'btnn3\'" onmouseout="this.className=\'btnn1\'">{name}</button>',btnImg:'<button title="{tip}" onclick="{code}" class=btnn2 onmouseover="this.className=\'btnn4\'" onmouseout="this.className=\'btnn2\'"><IMG src="'+ucapHeader.sUserStylePath+'ucapimages/{picture}" align=absMiddle>&nbsp;{name}</button>'}}};_UcapForm.handler={all:{},getFormById:function(a){return this.all[a]},addForm:function(a,b){this.all[a]=b},removeForm:function(a){delete this.all[a]},allView:{},getViewById:function(a){return this.allView[a]},addView:function(b,a){this.allView[b]=a},removeView:function(a){delete this.allView[a]}};_UcapForm.tool={cfg:_UcapForm.cfg,showLodingMsg:function(e,d,c,a,b){this.cfg.showLodingId=Ext.MessageBox.show({wait:true,waitConfig:{increment:10,interval:1000},title:e||"系统提示",msg:d||"正在处理中...",progressText:"",width:c||300,progress:a||true,closable:b||false,animEl:"loding"});return this.cfg.showLodingId},hideLodingMsg:function(){if(this.cfg.showLodingId){this.cfg.showLodingId.hide()}},getFormValue:function(l,a){l=l.toLowerCase();var j=_UcapForm.handler.all;for(var e in j){var h=j[e].uiItemList;var o="",f,k;for(var c=0;c<h.length;c++){var g=h[c].item.nameEn.toLowerCase();if(g==l){var d=h[c].item.value||h[c].uiItemValueList;f=d[0].value||d[0].text;k=d[0].text||d[0].value;o=a?f:k;for(var b=1;b<d.length;b++){f=d[b].value||d[b].text;k=d[b].text||d[b].value;o+=ucapSession.fvs_sp+(a?f:k);return o}}}}return o},openFile:function(){var a=_UcapForm.handler.all[_UcapForm.cfg.mainUnid];var b={url:appPath+"BackGroundService.upload?getFileName=1&punid="+a.unid,params:"",callback:function(e,g,d){if(g){var f=Ext.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}if(d.responseText){window.open(d.responseText)}else{Ext.Msg.alert("系统提示","当前附件不存在!")}}}};Ext.Ajax.request(b)},deleteFile:function(b){var a=$("file_"+b).value;if(a!=""){Ext.Msg.alert("系统提示","请刷新后再删除文件!");return}Ext.Msg.confirm("是否要删除文件","删除后将无法还原,确定要删除吗？",function(e){if(e=="yes"){var c=_UcapForm.handler.all[_UcapForm.cfg.mainUnid];var d={url:appPath+"BackGroundService.upload?delete=1&punid="+c.unid,params:"",callback:function(h,k,g){if(k){var j=Ext.decode(g.responseText);var f=ucapCommonFun.dealException(j);if(!f){return}if(g.responseText=="true"){if($(b)){$(b).value=""}_UcapForm.docSave();Ext.Msg.alert("系统提示","删除成功！")}else{Ext.Msg.alert("系统提示","删除失败,文件不存在！")}}}};Ext.Ajax.request(d)}})},setCfgJson:function(c){var a=ucapCommonFun.getUrlParameter("unid");this.cfg.form=c.form;this.cfg.formShow=c.formShow;this.cfg.composeForm=c.composeForm;this.cfg.subButtonList=c.subButtonList;this.cfg.uiItemList=c.uiItemList;this.cfg.isRead=c.isRead;if(this.cfg.isRead>_UcapForm.cfg.fatherIsRead){this.cfg.isRead=0}if(this.cfg.isRead==1){if(typeof this.cfg.form.editJs!="undefined"&&this.cfg.form.editJs!=""){var b=ucapCommonFun.evalJavaScript(this.cfg.form.editJs);if(!b){this.cfg.isRead=0}}}this.cfg.isTabNew=(!a||(c.isNew!=""&&c.isNew==1))?1:0},setCfgStr:function(a,b,c){this.cfg.unid=a;this.cfg.curFormType=b;this.cfg.curFormId=c},setDocumentTitle:function(e){var d=Ext.getDom("ucap_document_title");d.innerHTML=e.titleStyle||e.nameCn;var b=d.innerHTML;var c=function(){var l=b;var k=l.match(/{F\$\w*}/g);if(null==k||k.length<1){return l}for(var h=0;h<k.length;h++){var m=k[h].replace(/{F\$|}/g,"");var f=Ext.getDom(m);if(f){f=f.value;if(Ext.type(f)=="array"){f=f[0].text}}else{f=$V(m)}var g=(!f)?"无标题":(f||"无标题");l=l.replace(k[h],g)}return l};b=c()||"";if(!b||b=="undefined"){return}if(window.parent&&window.parent.ucapSession.docWin){var a=window.parent.ucapSession.docWin;if(a.title.indexOf("文档新建")==-1){a.setTitle(ucapSession.win.winImg+b)}}else{Ext.getDoc().dom.title=b}this.cfg.docTitle[this.cfg.curFormId]=b},executeJavaScript:function(formEvents,sType){var result=true;if(formEvents&&formEvents.length>0){Ext.each(formEvents,function(fe){if(null==fe){return}var type=fe.eType;var excType=fe.excType;var value=fe.eValue;if(type=="01"&&excType==sType){result=eval(value)}else{if(type=="02"&&excType==sType){result=eval("_UcapForm.tool.executeInteraction('"+value+"');")}}})}return result},executeInteraction:function(e){var c={};var d=location.search.slice(1).split("&");for(var b=0;b<d.length;b++){var a=d[b].split("=");c[a[0]||""]=a[1]||""}ucapCommonFun.executeInteraction(e,c,0)},setButton:function(sbl,tb){var btn=sbl||this.cfg.subButtonList||[];var altKey=new Ext.KeyMap(document.body);var toolbtn=tb||_ucapButtonDivName;var btnstr="";for(var i=0;i<btn.length;i++){var bn=btn[i];if(bn.display!=false){var b=ucapCommonFun.evalJavaScript(bn.js);if(b==true){var codetype=bn.button.codeType;var jscode=bn.button["code"].replace(/"/g,"'");switch(codetype){case"02":bn.code="_UcapForm.tool.executeInteraction('"+jscode+"');";break;default:bn.code=jscode}try{altKey.addBinding({key:bn.altKey,alt:true,scope:this,fn:(function(){var js=jscode;return function(){eval(js)}})()})}catch(e){}if(bn.picture){btnstr=this.cfg.toolBarBtnTmp.btnImg}else{btnstr=this.cfg.toolBarBtnTmp.btn}if(Ext.fly(toolbtn)){this.complieTmp(btnstr,toolbtn,bn)}}}}},setTabDiv:function(e){var d=e||this.cfg.composeForm.tabs;if(d.length==1){$("showMenu").style.display="none";$("showMenuLine").style.display="none"}for(var c=0;c<d.length;c++){d[c]["tabclick"]="_UcapForm.ucapForm.selectTag("+c+",this);";this.complieTmp(this.cfg.tabTmp,"showMenuUL",d[c]);this.complieTmp(this.cfg.tabBodyTmp,"showTabBody",d[c]);var b=d[c]["types"].split(",");var f=d[c]["contents"].split(",");for(var a=0;a<b.length;a++){this.complieTmp(this.cfg.tabContentsTmp,pfx_ucap+d[c]["unid"],{unid:f[a],types:b[a]})}}},complieTmp:function(d,a,c,e){var b=new Ext.Template(d);b.compile();if(e){return b.doInsert(e,a,c)}else{return b.append(a,c)}},embellishForm:function(args,dictTree){var cfg=_UcapForm.cfg;var complieTmp=_UcapForm.tool.complieTmp;var item,sourceType,nameEn,source;if(args){switch(Ext.type(args)){case"object":item=args;break;case"element":item=args;break;case"array":for(var i=0;i<args.length;i++){this.embellishForm(args[i])}return;case"string":var oy=Ext.query("div#"+args+" input,textarea")||Ext.query(args);this.embellishForm(oy);return}}var objFalg=item.tagName;nameEn=objFalg?(item.getAttribute("nameEn")||item.id):item.nameEn;var obj=Ext.getDom(nameEn);sourceType=obj?obj.getAttribute("sourceType")||item.sourceType:"";source=obj?obj.getAttribute("source")||item.source:"";var displayStyle=obj?obj.getAttribute("displayStyle")||item.displayStyle:"";var setDisplayStyle=function(inputId,styleTypes){if(!$(inputId)){return}var styleType=styleTypes.split(",");for(var i=0;i<styleType.length;i++){switch(styleType[i]){case"underline":$(inputId).style.border=0;$(inputId).style.borderBottom="1 solid black";$(inputId).style.background="transparent";break;case"Strong":$(inputId).style.fontWeight="bold";break;case"em":$(inputId).style.fontStyle="italic";break}}};if(displayStyle){setDisplayStyle(obj,displayStyle)}var displayGivenCondtion=obj?obj.getAttribute("displayGivenCondtion")||item.displayGivenCondtion:"";if(displayGivenCondtion){var isdgc=eval(displayGivenCondtion);if(isdgc){var displayConversion=obj?obj.getAttribute("displayConversion")||item.displayConversion:"";var pobj=obj.parentNode;pobj.removeChild(obj);pobj.appendChild("<span>"+displayConversion+"</span>")}}var editGivenCondtion=obj?obj.getAttribute("editGivenCondtion")||item.editGivenCondtion:"";if(editGivenCondtion){var isegc=eval(displayGivenCondtion);if(isegc&&isegc==true&&item.readOnly!=undefined){item.readOnly=true}}var fn20=function(_s,s02){var btnCnHtmlTmp=cfg.htmlTmpStr.btn_cn_html;var btnHtmlTmp=cfg.htmlTmpStr.btn_html;var obj=Ext.getDom(nameEn);var _ss=obj.getAttribute("source")||item.source;var _t=obj.getAttribute("isSingle")||item.isSingle;var fieldNames=obj.getAttribute("columnMap")||item.columnMap;if(s02){if(!Ext.getDom(nameEn+"_Cn_")){complieTmp(btnHtmlTmp,obj.parentNode,{id:nameEn,text:"选","class":"inputred"})}var btn=Ext.getDom("btn_"+nameEn);Ext.apply(btn,{onclick:function(){var _ev=obj.getAttribute("Evalue")||"";return(function(){selectView(_ss,fieldNames,nameEn,_t,_ev)})()}})}else{if(_t!=1){btnCnHtmlTmp=cfg.htmlTmpStr.areabtn_html}if(!Ext.getDom(nameEn+"_Cn_")){complieTmp(btnCnHtmlTmp,obj.parentNode,{id:nameEn,text:"选","class":"inputred"},"afterBegin")}obj.style.display="none";var btn=Ext.getDom("btn_"+nameEn);Ext.apply(btn,{onclick:function(){var _source=_s;if(!_s){var conValue=obj.getAttribute("conValue");if(Ext.getDom(conValue)){_ss=Ext.getDom(conValue).value}else{_ss=""}_source=obj.getAttribute("source")||200}var _ev=obj.getAttribute("Evalue")||"";return(function(){selectDataSD(_source,_t,nameEn,_ss||"",_ev)})()}})}};var ewebEditorFn=function(){var iframe1='<iframe id="{id}" src="'+ucapSession.appPath+"eWebEditor/ewebeditor.htm?id="+nameEn+'&style=mini" frameborder="0" scrolling="no" width="100%" height="350"></iframe>';complieTmp(iframe1,Ext.getDom(nameEn).parentNode,{id:"eWebEditor_"+nameEn});Ext.getDom(nameEn).style.display="none"};if(obj&&obj.tagName.toLowerCase()!="span"&&obj.tagName.toLowerCase()!="div"){switch(sourceType){case"01":break;case"02":fn20("",1);break;case"04":source=source||"yyyy-MM-dd";var img='<span><IMG style="CURSOR: pointer;" onclick="{onclick}" src="'+ucapSession.appPath+'js/ucap/calendar/skin/datePicker.gif" align=absMiddle/></span>';complieTmp(img,Ext.getDom(nameEn).parentNode,{onclick:"WdatePicker({el:'"+nameEn+"',dateFmt:'"+source+"'});"});break;case"05":source=source||"yyyy-MM-dd HH:mm";var img='<span><IMG style="CURSOR: pointer;" onclick="{onclick}" src="'+ucapSession.appPath+'js/ucap/calendar/skin/datePicker.gif" align=absMiddle/></span>';complieTmp(img,Ext.getDom(nameEn).parentNode,{onclick:"WdatePicker({el:'"+nameEn+"',dateFmt:'"+source+"'});"});break;case"06":var pobj=obj.parentNode;pobj.removeChild(obj);source=source||"350";var areatext='<textarea id="{id}" name="{id}" style="width:100%;height:'+source+'px;"></textarea>';complieTmp(areatext,pobj,{id:nameEn});break;case"07":break;case"08":ewebEditorFn();break;case"09":var filehtml=cfg.htmlTmpStr.file_html;var pobj=obj.parentNode;pobj.removeChild(obj);var filecfg={id:nameEn};if((cfg.isRead+"")=="1"){if(!item.value[0]){filecfg={id:nameEn,display:"none1"};complieTmp(filehtml,pobj,filecfg)}else{filecfg={id:nameEn,"class":"inputred",display:"none",downFile:"<span onclick=\"$('div_"+nameEn+'\').style.display=\'\';" style="color:red;cursor:hand;">重新上传</span>&#160;&#160;<span onclick="_UcapForm.tool.openFile();" style="cursor:hand;">下载</span>&#160;&#160;<span onclick="_UcapForm.tool.deleteFile(\''+nameEn+'\');" style="cursor:hand;">删除</span>'};complieTmp(filehtml,pobj,filecfg)}}break;case"20":fn20();break;case"03":var dicShowType=objFalg?item.getAttribute("dictionaryType"):((item.dictionaryType||item.itemShow["dictionaryType"]));var inputPty={name:nameEn,id:nameEn,type:"text"};var dicHtmlTmp=cfg.htmlTmpStr.input_html;var oObj=obj=Ext.getDom(nameEn);switch(dicShowType){case"01":complieTmp(cfg.htmlTmpStr.select_html,obj.parentNode,inputPty);oObj.parentNode.removeChild(oObj);obj=Ext.getDom(nameEn);dicHtmlTmp=cfg.htmlTmpStr.option_html;inputPty={};Ext.DomHelper.useDom=true;break;case"02":inputPty.type="radio";obj=obj.parentNode;break;case"03":fn20("204");break;case"011":if(!dictTree){dictTree=[]}var children=dictTree.children;var data=[];for(var j=0;j<children.length;j++){data[j]=[children[j]["value"],children[j]["text"]]}var comboWithTooltip=new Ext.form.ComboBox({store:data,displayField:"state",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,applyTo:nameEn});break;case"05":inputPty.type="checkbox";obj=obj.parentNode;break;default:break}if(dicShowType=="01"||dicShowType=="02"||dicShowType=="05"){if(!dictTree){break}var children=dictTree.children;if(!children){break}try{for(var j=0;j<children.length;j++){inputPty.text=children[j]["text"]||"";inputPty.value=children[j]["value"]||"";inputPty.i=j;if(Ext.DomHelper.useDom){Ext.DomHelper.append(Ext.get(obj),{tag:"option",value:inputPty.value,html:inputPty.text})}else{complieTmp(dicHtmlTmp,obj,inputPty)}}if(oObj&&oObj.parentNode){oObj.parentNode.removeChild(oObj)}}catch(e){}}break}}Ext.DomHelper.useDom=false},form:function(b,g){var f=this.cfg;var m=this.complieTmp;var l=b||f.form;var j=g||f.uiItemList;if(!f.mainUnid){f.mainUnid=l.unid}var n=f.jspTmpStr.formJson.id;var h=pfx_ucap+l.unid;if(!Ext.fly(n)){n=f.jspTmpStr.composeFormJson.id}if(!Ext.fly(h)){this.complieTmp(f.htmlTmpStr.form,n,l)}var e="",k="";switch(f.isRead+""){case"0":k="R_"+(l.htmlUrl||(l.unid+".html"));break;case"1":k=l.htmlUrl||(l.unid+".html");break;default:k="error.html";break}var a=this.cfg.defaultPath;if(l.nameEn&&l.nameEn.toLowerCase().indexOf("ucap_")==0){a=this.cfg.systemPath}e=a+k;var d={rds:ucapCommonFun.getRandomString()};var c=this.embellishForm;Ext.get(h).load({url:e},d,function(x,s){if(s){var w,v,o;for(var r=0;r<j.length;r++){var q={};w=j[r]["item"];v=j[r]["uiItemValueList"];w.value=v;o=w.nameEn;var p=j[r]["dictTree"];q[o]=w;Ext.apply(q[o],w.itemShow||{});Ext.apply(q[o],w.itemEvents||{});if((f.isRead+"")=="1"){try{c(w,p)}catch(u){}}ucapCommonFun.bindForm(q)}_UcapForm.tool.setDocumentTitle(l);var t=l.formEvents;if(f.isTabNew){_UcapForm.tool.executeJavaScript(t,"01")}else{_UcapForm.tool.executeJavaScript(t,"02")}}else{if(x){x.update('<div class="red" align="center">未找到相关表单,请与管理员联系!<br/>'+e+"</div>")}}})},formShow:function(a,b){this.form(a||this.cfg.formShow,b||this.cfg.uiItemList)},composeForm:function(a,d){var b=a||this.cfg.composeForm;this.cfg.formType="03";_UcapForm.tool.setDocumentTitle({titleStyle:b.name});if(window.parent&&window.parent.ucapSession.docWin){window.parent.ucapSession.docWin.setTitle(ucapSession.win.winImg+b.name)}else{Ext.getDoc().dom.title=b.name}var c=b.jspUrl;if(c&&c.indexOf("jsp")>-1&&window.location.href.indexOf(c)==-1){window.location=this.cfg.composeForm.jspUrl}if(this.cfg.mainFormType=="02"){this.cfg.mainUnid=this.cfg.form.unid}else{this.cfg.mainUnid=b.mainFormId}this.setTabDiv()}};_UcapForm.docSave=function(S){if(!Validator.Validate(_UcapForm.mainDiv)){Ext.Msg.alert("提示信息","表单数据不完整,请填完整后再提交!");return false}var K=function(){var X=Ext.query("input[sourceType=09]");var ab=false;if(X.length==0){return true}for(var Z=0;Z<X.length;Z++){var ag=X[Z].id;var af=$("div_"+ag);if(af.style.display=="none"){return true}var Y=$("iframe"+ag);var ac=Y.getAttribute("src");var k=Y.contentWindow.document.body.innerHTML;var ae=Y.getAttribute("flag");if(ae=="false"){k="false"}else{ab=true}var aa=$("file_"+ag).value;if(aa==""){ab=true}if((ac=="#"&&k.indexOf("true")==-1&&aa!="")){if(Y.getAttribute("flag")!="true"){Ext.get("iframe"+ag).on("load",function(){var e=Y.contentWindow.document.body.innerHTML;if(e=="false"){Y.setAttribute("flag","true");alert("上传附件失败")}else{$(ag).value=e.replace(/\\/g,"/");Y.setAttribute("flag","true")}_UcapForm.docSave()});try{var W=$("form_"+ag);var a=_UcapForm.handler.all[_UcapForm.cfg.mainUnid];W.setAttribute("action",appPath+"BackGroundService.upload?upload=1&punid="+a.unid);W.submit()}catch(ad){}Y.setAttribute("flag","true");return false}else{Y.setAttribute("flag","false");return true}}else{Y.setAttribute("flag","false")}break}return ab};if(!K()){return}if(typeof S!="string"){S=""}var V=ucapCommonFun.getUrlParameter("unid");var B=ucapCommonFun.getUrlParameter("fformUnid");var d=ucapCommonFun.getUrlParameter("funid");var j="";var l=V;var s=_UcapForm.handler.all;var c=_UcapForm.cfg.mainUnid;var r=_UcapForm.handler.getFormById(c);var H=[];var p=0;var F=s[c]["form"]["formEvents"];var v;if(!l){v=_UcapForm.tool.executeJavaScript(F,"03")}else{v=_UcapForm.tool.executeJavaScript(F,"05")}if(v==false){return}for(var U in s){var n=(!l||(s[U]["isNew"]!=""&&s[U]["isNew"]==1))?1:0;var h={};var y=[];var t=s[U]["uiItemList"];for(var Q=0;Q<t.length;Q++){var A=t[Q]["item"];var o=A.nameEn;var M=A.value||t[Q]["value"];var b=Ext.getDom(o);var x=function(a){var k={};k=ucapCommonFun.getObjValueJson(o,a);var e=A.type;if(Ext.encode(k)=="{}"){if(a&&a.length>0){k.k=o;k.v=a[0].value;k.t=e}}else{k.t=e}return k};if(!n){try{var G=x();if(!M[0]){M[0]={}}var L=(M[0]["value"]||M[0]["text"])||"";for(var P=1;P<M.length;P++){L+=ucapSession.fvs_sp+M[P]["value"]}if(b&&L!=G.v){y[Q]=G;if(A.spellSource==1){G.s=1}}}catch(R){}}else{if(b){y[Q]=x()}else{y[Q]=x(A.value||t[Q]["value"])}if(y[Q]["spellSource"]==1){y[Q]["s"]=1}}}if(Ext.encode(y)=="[]"){continue}var J=s[U]["form"]||s[U]["formShow"];if(J){h.formUnid=J.unid;h.unid=s[U]["unid"];if(!c||c==U){if(!l&&B&&d){h.fformUnid=B;h.funid=d}}else{if(c&&c!=U){var E=s[c]["composeForm"];if(E){h.fformUnid=r.form["unid"];h.funid=s[c]["unid"]}else{}}}}if(n){h.isNew="1";var g=s[U];g.isNew="";var u=ucapCommonFun.getUrlParameter("nodeid");var z=ucapCommonFun.getUrlParameter("flowid");u=!u?"":u;z=!z?"":z;if(z!=""&&j.indexOf("flowid")<0){j+="&flowid="+z+"&nodeid="+u}}else{h.isNew="0"}h.item=y;H[p]=h;p++}var q=_UcapForm.handler.allView;for(var f in q){var N=$(f);if(N&&N.tagName.toLowerCase()=="iframe"){var D=N.contentWindow;if(D&&D.view){var C=D.view.getEditorGridDatas();C=Ext.decode(C);for(var Q=0;Q<C.length;Q++){var T=C[Q];if(!T.fformUnid){T.fformUnid=r.form["unid"]}if(!T.funid){T.funid=s[c]["unid"]}H[H.length]=T}if(!window.view.viewSaveValidator(C)){return false}}}}var O=_UcapForm.ucapForm.otherFormData();if(O&&Ext.type(O)=="array"){for(var Q=0;Q<O.length;Q++){var T=O[Q];if(!T.fformUnid){T.fformUnid=r.form["unid"]}if(!T.funid){T.funid=s[c]["unid"]}H[H.length]=T}}if(Ext.encode(H)=="[]"){Ext.Msg.alert("保存提示","文档没有修改，无需保存！");return false}var m="type=getForm&act=save"+j+"&"+ucapCommonFun.getRandomString();var I=window;if(parent){I=parent}if(!_UcapForm.cfg.otherSaveAction){_UcapForm.cfg.otherSaveAction=ucapSession.baseAction}var w={url:_UcapForm.cfg.otherSaveAction,params:m,jsonData:H,callback:function(X,ab,a){if(ab){var al=a.responseText;var Z=Ext.decode(al);var k=ucapCommonFun.dealException(Z);if(!k){return}if(al=="1"||al==1){I.Ext.Msg.alert("保存提示","文档保存成功!");if(!l){v=_UcapForm.tool.executeJavaScript(F,"04");if(v==false){return}var am=ucapCommonFun.getUrlParameter("type");var e=ucapCommonFun.getUrlParameter("flowid");if(e){ucapOpenFlow.openOldFlowDoc("&unid="+r.unid,_UcapForm.openFlowDoc)}else{window.location=window.location.href.replace(/(unid=)/,"unid="+r.unid)}}else{var ac=X.jsonData;for(var ak=0;ak<ac.length;ak++){var aa=ac[ak].item;for(var W=0;W<aa.length;W++){var ad=aa[W];if(ad){var ae=ad.k;var ag=ac[ak].formUnid;if(!s[ag]){continue}var af=s[ag].uiItemList;for(var ai=0;ai<af.length;ai++){var aj=af[ai].item.nameEn;if(aj==ae){var Y=af[ai].item.value;for(var ah=0;ah<Y.length;ah++){Y[ah].text=ad.v}}}}}}v=_UcapForm.tool.executeJavaScript(F,"06");if(v==false){return}}ucapCommonFun.refreshParentView();if(S!=""){ucapCommonFun.evalJavaScript(S+"('"+r.unid+"');")}}else{if(al=="0"){I.Ext.Msg.alert("保存提示","文档保存失败!")}else{I.Ext.Msg.alert("保存提示",al)}}}_UcapForm.tool.hideLodingMsg()}};this.tool.showLodingMsg();Ext.Ajax.request(w);return true};_UcapForm.openFlowDoc=function(a){var b=ucapSession.opendocType;if(b==1||b==2){a=a+"&div=1"}window.location=a};_UcapForm.formClose=function(){if(window.parent){if(window.parent.ucapSession.docWin){window.parent.ucapSession.docWin.close()}else{window.close()}if(window.parent.ucapCommonFun.ucapCurOpenType==1){window.parent.initView(window.parent.view.viewId,window.parent.ucapSession.ucapViewId)}}else{window.close()}};_UcapForm.ucapForm=function(){var d=false;var a=_UcapForm.cfg;var b=_UcapForm.tool;var c=function(f,j,k,e,h){var g="_ucap_main_div";if(Ext.fly(g)){switch(j){case"01":b.complieTmp(a.jspTmpStr.form,g,a.jspTmpStr.formJson);break;case"02":b.complieTmp(a.jspTmpStr.form,g,a.jspTmpStr.formJson);break;case"03":b.complieTmp(a.jspTmpStr.composeForm,g,a.jspTmpStr.composeFormJson);break}}c.initAjax(f,j,k,e,h)};c.otherFormData=function(){return null};c.initForm=function(e,f){b.setCfgJson(e);f=f||a.curFormType;switch(f){case"01":b.form();break;case"02":b.formShow();break;case"03":b.composeForm();this.selectTag(0);break}if(!d){b.setButton()}return this};c.initAjax=function(k,o,p,g,l,j){if(a.mainFormType=="02"){p=a.form.unid}b.setCfgStr(k,o,p);var r=_UcapForm.handler.getFormById(p);if(a.docTitle[p]){if(window.parent&&window.parent.ucapSession.docWin){window.parent.ucapSession.docWin.setTitle(ucapSession.win.winImg+a.docTitle[p])}else{Ext.getDoc().dom.title=a.docTitle[p]||""}}if(!j){if(!l&&r){if(p==a.mainUnid&&!d){this.initForm(r,o);d=true}return}else{if(l&&r){this.initForm(r);return}}}r={};var h=ucapCommonFun.getUrlParameter("instanceUnid");var f=ucapCommonFun.getUrlParameter("nodeid");var q=ucapCommonFun.getUrlParameter("flowid");f=!f?"":f;q=!q?"":q;h=!h?"":h;var n="&flowid="+q+"&nodeid="+f+"&instanceUnid="+h;var e="type=getForm&unid="+k+"&formType="+o+"&formId="+p+((!g)?"&subButton=0":"")+((!k)?"&isNew=1":"")+((a.mainUnid&&p!=a.mainUnid)?"&main="+a.mainUnid:"")+n;if(!a.otherAction){a.otherAction=ucapSession.baseAction}var m={id:_UcapForm.mainDiv,url:a.otherAction,params:e,callback:function(w,y,u){if(y){r=Ext.decode(u.responseText);var t=ucapCommonFun.dealException(r);if(!t){return}var x=p;if(o=="03"){var s=r.composeForm;if(!s){Ext.Msg.alert("系统提示","组合表单不存在!");return}var v=s.mainFormType;a.mainFormType=v;if(v=="02"){x=r.form["unid"]}else{x=r.composeForm["mainFormId"]}}_UcapForm.handler.addForm(x,r);c.initForm(r,o)}else{c.error(w.id,"加载表单信息失败,请与管理员联系!")}}};Ext.Ajax.request(m)};c.selectTag=function(r,g){var m=Ext.query("div[main=#]","showTabBody");try{var p=m[r].getAttribute("types").split(",");var v=m[r].getAttribute("contents").split(",");var z=ucapCommonFun.getUrlParameter("unid");for(var u=0;u<p.length;u++){var q=p[u];var l=(!v[u])?m[r].id:pfx_ucap+v[u];var B=Ext.getDom(l);switch(q){case"03":if(!z&&u==0){alert("请先保存再打开视图");return}_UcapForm.handler.addView(v[u],v[u]);var w=location.href.replace(/(^[^?]*\?)|(&fformUnid=)[\w]*|(&funid=)[\w]*/ig,"");if(B.innerHTML==""){initJspView(v[u],l,w+"&fformUnid="+a.mainUnid+"&funid="+z,true,true,true)}break;case"04":break;case"05":var f={url:ucapSession.baseAction,params:"type=getOpinion&unid="+z,callback:function(t,I,n){if(I){var F=Ext.util.JSON.decode(n.responseText);if(!F){return}var H=Ext.decode(F);var e=ucapCommonFun.dealException(H);if(!e){return}var G='<table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" class="opndoc">';if(typeof(F)!="undefined"&&F!=null&&F!=""){for(var E=0;E<F.length;E++){G+='<TR><TD class="head">'+F[E].opinionName+"</TD></TR>";G+='<TR><td><div class="rzt">'+F[E].opinionContent+"</div>";G+=' <div class="footnote"><span class="opnblue">'+F[E].transactorBelongName+'   </span><span class="opngreen">';G+=F[E].transactorName+"</span>"+F[E].transactTime+"</div> </td>";G+="</tr>"}}G+="</TABLE>";B.innerHTML=G}else{Ext.Msg.alert("保存提示","文档保存失败!")}}};Ext.Ajax.request(f);break;case"06":m[r].style.display="block";var y=ucapGetUrlParameter("instanceUnid");if(!y){alert("系统提示：非流程文档无监控信息!");return}var k=appPath+"CreateImage?";k+="docUnid="+z;k+="&instanceUnid="+y+"&"+ucapCommonFun.getRandomString();if(B.firstChild.innerHTML==""&&z){_UcapForm.tool.complieTmp(_UcapForm.cfg.htmlTmpStr.ucap_img,B.firstChild,{id:"ucap_img",src:k})}break;case"07":if(Ext.getDom(l).innerHTML==""){var h=Ext.get(l);var A=h.getUpdater();var s=appPath+v[u];var w=location.href.replace(/^[^?]*\?/,"");A.update({url:s,params:w,scripts:true})}break;case"08":if(!B.firstChild.innerHTML&&z){var D=z,j=0;var o=new Ext.Panel({height:300,tbar:[{text:"刷新",handler:function(){ucap_attr_fun.getInfo(j,D)}},{text:"上传附件",handler:function(){var e=3;_UcapForm.ucapForm.templateCfg(e,D,j)}}],html:'<div id="ucap_attr_div'+j+'"></div>',renderTo:B.firstChild});ucap_attr_fun.getInfo(j,D)}break;case"09":if(!B.firstChild.innerHTML&&z){var D=z,j=1;var o=new Ext.Panel({tbar:[{text:"刷新",handler:function(){ucap_attr_fun.getInfo(j,D)}},{text:"上传正文",handler:function(){var e=0;_UcapForm.ucapForm.templateCfg(e,D,j)}},{text:"上传办理单",handler:function(){var e=1;_UcapForm.ucapForm.templateCfg(e,D,j)}}],html:'<div id="ucap_attr_div'+j+'"></div>',renderTo:B.firstChild});ucap_attr_fun.getInfo(j,D)}break;default:this.initAjax(z,q,v[u],true)}}}catch(x){}var C=Ext.query("li","showMenu");for(var u=0;u<C.length;u++){C[u].className=""}C[r].className="showMenuHover";for(u=0;u<m.length;u++){if(u==r){m[r].style.display="block"}else{m[u].style.display="none"}}};c.templateCfg=function(j,e,h,f){var g=new Ext.Window({id:"ucap_win_templatecfg",title:ucapSession.win.winImg+"文件上传",width:500,height:300,closable:true,plain:true,modal:true,autoLoad:{url:appPath+"plus/fileUpload.html?"+ucapCommonFun.getRandomString(),scripts:true,nocache:true},buttons:[{id:"uploadButton",text:"开始上传",type:"submit",handler:function(){if(!f){f="~!~"}var p=Ext.query("input[id=fileName]");var n="";for(var m=0;m<p.length-1;m++){if(p[m].value==""){n+=escape("无标题")+f}else{n+=escape(p[m].value)+f}}var l=new Ext.ProgressBar({text:"Ready",id:"pbar2",cls:"left-align",renderTo:"progressBar"});var o=Ext.get("uploadButton");Runner.run(l,o,100,function(){l.reset();l.updateText("上传成功!")},j,e,h);n=n.replace(/(~!~)$/,"");n=escape(n);Ext.getDom("fileUploadForm").action="BackGroundService.upload?docType="+h+"&punid="+e+"&captions="+n+"&split="+f+"&type="+j;Ext.getDom("fileUploadForm").target="upload_hidd";Ext.getDom("hidd_fileUploadForm_submit").click()}},{id:"cancelUploadButton",text:"关闭",handler:function(){g.close();ucap_attr_fun.getInfo(h,e)}}]});g.show()};c.error=function(f,e){var g=Ext.get(f);if(g){g.update('<div class="red" align="center">'+e+"</div>")}};c.a=function(e){Ext.Msg.alert(e)};return c}();var ucap_attr_fun={getInfo:function(b,a){Ext.Ajax.request({url:appPath+"GetAttrInfo?act=info&docType="+b+"&punid="+a+"&type=-1&"+ucapCommonFun.getRandomString(),success:function(j){Ext.getDom("ucap_attr_div"+b).innerHTML="";var g=Ext.decode(j.responseText);var d=[];if(j.responseText!="[null]"){for(var k=0;k<g.length;k++){var f=[];var l=g[k];f[0]=l.caption||('<a href="javascript:void(0);" onclick="ucap_attr.onconfig(\''+l.cfgUnid+"')\">"+l.cfgCaption+"&#160;</a>");f[1]=(l.fileName||l.cfgFileName).replace(/(\w*:[\\|\/]\w*[\\|\/])/ig,"");f[2]=l.type||l.cfgType;switch(f[2]){case"0":f[2]="正文";break;case"1":f[2]="办理单";break;default:f[2]="其它";break}f[3]=(parseInt((l.size||l.cfgSize)/1024/10.24)/100)||0.01;f[4]=l.created||l.cfgCreated;f[5]='<a href="javascript:void(0);" onclick="ucap_attr_fun.downFile(\''+b+"','"+(l.unid||l.cfgUnid)+'\')">下载</a>&#160;&#160;<a href="javascript:void(0);" onclick="ucap_attr_fun.delFile(\''+b+"','"+(l.unid||l.cfgUnid)+"','"+(l.punid||l.cfgPunid)+"')\">删除</a>";d[k]=f}}var h=Ext.grid;var e=new Ext.data.ArrayReader({},[{name:"文件标题"},{name:"文件名称"},{name:"类型"},{name:"文件大小(M)",type:"float"},{name:"上传时间"},{name:"操作"}]);var c=new h.GridPanel({store:new Ext.data.Store({reader:e,data:d}),viewConfig:{forceFit:true},cm:new h.ColumnModel([new h.RowNumberer(),{id:"caption",header:"文件标题",width:200,sortable:true,dataIndex:"文件标题"},{id:"fileName",header:"文件名称",width:100,sortable:true,dataIndex:"文件名称"},{id:"type",header:"类型",width:50,sortable:true,dataIndex:"类型"},{id:"size",header:"文件大小(M)",width:120,sortable:true,dataIndex:"文件大小(M)"},{id:"created",header:"上传时间",width:200,sortable:true,dataIndex:"上传时间"},{header:"操作",width:80,sortable:true,dataIndex:"操作"}]),bodyStyle:"width:100%",autoWidth:true,renderTo:Ext.getDom("ucap_attr_div"+b)})}})},downFile:function(b,a){window.open(appPath+"GetAttrInfo?act=down&docType="+b+"&unid="+a+"&type=-1&"+ucapCommonFun.getRandomString())},delFile:function(c,a,b){Ext.Msg.confirm("系统提示","警告:删除后将无法恢复！您确定要删除些文件？",function(d){if(d=="yes"){Ext.Ajax.request({url:appPath+"AttrUpload?docType="+c+"&unid="+a+"&stateType=3&"+ucapCommonFun.getRandomString(),success:function(e){ucap_attr_fun.getInfo(c,b)}})}})}};var _UcapFormFun={createHTML:function(){Ext.Msg.confirm("系统提示","确定要生成HTML文件吗？这将会覆盖原有的HTML页面！！！",function(c){if(c=="yes"){var b=ucapCommonFun.getUrlParameter("unid");var a={url:ucapSession.baseAction,params:{type:"CreateHtmlAction",unid:b},callback:function(f,h,e){var g=Ext.decode(e.responseText);var d=ucapCommonFun.dealException(g);if(!d){return}if(callBackFn&&"string"!=callBackFn&&callBackFn!=""){ucapCommonFun.evalJavaScript(callBackFn+"(response.responseText);")}else{if(Ext.encode(e.responseText).indexOf("true")>-1){Ext.Msg.alert("提示","生成HTML页面成功！")}else{Ext.Msg.alert("提示","生成HTML页面失败！")}}}};Ext.Ajax.request(a)}})},fn:function(g,h,s,r,q,p,n,m){var j=Ext.getDom(h);var l=Ext.getDom(h+"_Cn_");var k=Ext.getDom("btn_"+h);if(g){if(j){j.style.display=s}if(l){l.style.display=r}if(k){k.style.display=r}j.setAttribute("sourceType",q);j.setAttribute("source",p);if(typeof m=="undefined"){m=1}j.setAttribute("isSingle",m!=1?"0":m);j.setAttribute("nameEn",j.id);j.setAttribute("dictionaryType","03");if(n){_UcapForm.tool.embellishForm(j)}}},setShowFormUnid:function(){try{var a=ucapCommonFun.getUrlParameter("unid");var b="";if(!a){b=ucapCommonFun.getUrlParameter("funid")}else{b=Ext.getDom("fitem_form_unid").value}Ext.getDom("show_form_unid").value=b}catch(c){}},setUserDeptsUnid:function(){try{var b=ucapCommonFun.getUrlParameter("deptUnid");var d=Ext.getDom("user_depts");var a=Ext.getDom("user_depts_Cn_");if(d){d.value=b;if(a){a.value=b}}}catch(c){}},setColumnsUnid:function(){try{var b=ucapCommonFun.getUrlParameter("funid");var f=ucapCommonFun.getUrlParameter("fcn");var d=Ext.getDom("article_columns_unid");var a=Ext.getDom("article_columns_unid_Cn_");if(d){d.value=b;if(a){a.value=f}}}catch(c){}},viewSourceTypeClick:function(c){var b="view_source_unid";if(c){var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","222","1");break;case"02":this.fn(c,b,"none","","20","224","1");break;default:this.fn(c,b,"","none","","");break}}},viewFormTypeClick:function(c){var b="view_form_unid";if(c){var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","222",1);break;case"02":this.fn(c,b,"none","","20","221",1);break;case"03":this.fn(c,b,"none","","20","226",1);break}}},fitemSourceTypeClick:function(c){var b="fitem_source";var d=$("fitem_column_map").parentNode.parentNode;if(c){var a=c.value+"";switch(a){case"02":this.fn(c,b,"none","","20","218",1);d.style.display="";break;case"03":this.fn(c,b,"none","","03","",1);d.style.display="none";break;default:this.fn(c,b,"","none","","",1);d.style.display="none";break}}},fitemDefaultTypeClick:function(h){var g=Ext.getDom("fitem_default_value");var d=Ext.getDom("fitem_default_value_Cn_");var a=Ext.getDom("btn_fitem_default_value");if(h){var c=function(k,j,n,m,l){g.style.display=k;g.setAttribute("sourceType",n);g.setAttribute("source",m);g.setAttribute("dictionaryType","03");g.setAttribute("isSingle","1");g.setAttribute("nameEn",g.id);if(l){_UcapForm.tool.embellishForm(g)}if(d){d.style.display=j}if(a){a.style.display=j}};var b=h.value+"";switch(b){case"03":try{c("none","","03",Ext.getDom("fitem_source").value,"1")}catch(f){_UcapFormFun.fitemDefaultTypeClick(h)}break;case"02":c("none","","20","208","1");break;default:c("","none","","");break}}},queryFormTypeClick:function(c){var b="query_form_unid";if(c){var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","222");break;case"02":this.fn(c,b,"none","","20","221");break;case"03":this.fn(c,b,"none","","20","226");break}}},channelStyleClick:function(e,f){var b="channel_source_type";if(e){var d=function(g,c){var k=Ext.query("input[id="+b+"][value=04],[id="+b+"][value=05]");var h=Ext.query("input[id="+b+"][value!=04][value!=05]");for(var j=0;j<k.length;j++){k[j].setAttribute("disabled",g);if(!f&&c&&j==0){k[j].click()}}for(var j=0;j<h.length;j++){h[j].setAttribute("disabled",c);if(!f&&g&&j==0){h[j].click()}}};var a=e.value+"";switch(a){case"01":case"02":case"03":d(true,false);break;default:d(false,true);break}}},channelSourceTypeClick:function(e){var b="channel_style";var c=Ext.query("input:checked[id="+b+"]");this.channelStyleClick(c[0],true);if(e){var a=e.value+"";var d="channel_source";switch(a){case"01":this.fn(e,d,"none","","20","218",1);break;case"05":this.fn(e,d,"none","","20","209",1);break;default:this.fn(e,d,"","none","","");break}}},schemeIndexTypeClick:function(d){var b="scheme_index";if(d){var a=d.value+"";switch(a){case"02":try{this.fn(d,b,"none","","20","215",1)}catch(c){this.schemeIndexTypeClick(d)}break;default:this.fn(d,b,"","none","","");break}}},shortcutTypeClick:function(c){var b="shortcut_content";if(c){var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","215",1);break;case"02":this.fn(c,b,"none","","20","218",1);break;case"03":this.fn(c,b,"none","","20","220",1);break;default:this.fn(c,b,"","none","","");break}}},dbviewDisplayFormTypeClick:function(c){var b="dbview_display_form_unid";if(c){var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","221",1);break;case"02":this.fn(c,b,"none","","20","226",1);break;default:this.fn(c,b,"","none","","");break}}},fixedquerySourceTypeClick:function(c){var b="fixedquery_source";if(c){var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","218",1);break;case"02":this.fn(c,b,"none","","20","222",1);break;default:this.fn(c,b,"","none","","");break}}},tabTypesClick:function(c){var b="tab_contents";var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","222",1);break;case"02":this.fn(c,b,"none","","20","221",1);break;case"03":this.fn(c,b,"none","","20","218",1);break;default:this.fn(c,b,"","none","","");break}},cformMainFormTypeClick:function(c){var b="cform_main_form";var a=c.value+"";switch(a){case"01":this.fn(c,b,"none","","20","222",1);break;case"02":this.fn(c,b,"none","","20","221",1);break;default:this.fn(c,b,"","none","","");break}},butonTypeClick:function(c){var b="button_code";var a=c.value+"";switch(a){case"02":this.fn(c,b,"none","","20","227",1);break;case"03":this.fn(c,b,"none","","20","999",1,0);break;default:this.fn(c,b,"","none","","");break}},viewMessageTypeClick:function(h){var g=Ext.getDom("view_message");var d=Ext.getDom("view_message_Cn_");var a=Ext.getDom("btn_view_message");if(h){var c=function(k,j,o,n,m,l){g.style.display=k;g.setAttribute("sourceType",o);g.setAttribute("source",n);g.setAttribute("dictionaryType","03");g.setAttribute("isSingle",l);g.setAttribute("conValue","view_source_unid");g.setAttribute("nameEn",g.id);if(m){_UcapForm.tool.embellishForm(g)}if(d){d.style.display=j}if(a){a.style.display=j}};var b=h.value+"";switch(b){case"02":try{c("none","","20","223","1","0")}catch(f){_UcapFormFun.viewMessageTypeClick(h)}break;case"03":c("none","","20","227","1",1);break;default:c("","none","","");break}}},initRadioToCnValue:function(d){var g=d||{};var b=g.map;var l=g.enObj;var e=g.cnObj||Ext.getDom(l.id+"_Cn_");if(!g.id||!b||!l||!l.id||!e){return false}var k="input:checked[id="+g.id+"]";var h=Ext.DomQuery.select(k);var f;if(h&&h.length>0){f=h[0].value}var j=b[f];if(j){var a=l.getAttribute("source")||"";var c=ucapCommonFun.getDisplayNames(j,l.value,a);e.value=c||l.value||""}},buttonOpenDocSetCn:function(){this.initRadioToCnValue({id:"button_code_type",map:{"03":"999","02":"227"},enObj:Ext.getDom("button_code")})},initFitem:function(){this.initRadioToCnValue({id:"fitem_source_type",map:{"03":"204","02":"218"},enObj:Ext.getDom("fitem_source")});this.initRadioToCnValue({id:"fitem_default_type",map:{"02":"208","03":"204"},enObj:Ext.getDom("fitem_default_value")})},initDbView:function(){this.initRadioToCnValue({id:"dbview_display_form_type",map:{"01":"221","02":"226"},enObj:Ext.getDom("dbview_display_form_unid")})},initView:function(){this.initRadioToCnValue({id:"view_message_type",map:{"02":"223","03":"227"},enObj:Ext.getDom("view_message")})},initViewItemType:function(){this.initRadioToCnValue({id:"itemType",map:{"02":"204"},enObj:Ext.getDom("itemValue")})}};var ucap_attr={json:{appUnid:"",userUnid:"",userName:"",userDept:"",actionType:"0",isMht:"1",isRead:"1",isCopy:"1",isSaveAs:"1",isPrint:"1",countPrint:"0",isHideRevision:"1",punid:"",unid:"",cfgUnid:"",fileName:"",attrType:"0",stateType:"2",docType:"1",caption:"",filePath:"",isShowList:true},optionCfg:{0:"意见1,意见2,意见3,意见4,意见5,意见6,意见7,意见8",1:"opinion_name1,opinion_name2,opinion_name3,opinion_name4,opinion_name5,opinion_name6,opinion_name7,opinion_name8"},optionSource:{0:"",1:""},onlook:function(){ucap_attr.open({punid:ucapCommonFun.getUrlParameter("unid"),actionType:0})},ondraft:function(){ucap_attr.open({punid:ucapCommonFun.getUrlParameter("unid"),actionType:1,isShowList:true})},onfinalize:function(){ucap_attr.open({punid:ucapCommonFun.getUrlParameter("unid"),actionType:3})},onconfig:function(a){ucap_attr.open({actionType:10,punid:ucapCommonFun.getUrlParameter("unid"),docType:1,unid:a})},onprint:function(){ucap_attr.open({punid:ucapCommonFun.getUrlParameter("unid"),actionType:11,attrType:1})},setWordInfoConfig:function(d,c,a){var b={url:ucapSession.baseAction,params:{type:"getWordInfo"},jsonData:d,callback:function(h,l,f){if(l){var k=Ext.decode(f.responseText);var e=ucapCommonFun.dealException(k);if(!e){return}var g=ucapSession.hostPath+appPath+"AttrUpload?docType="+d.docType+"&stateType="+d.stateType+"&caption="+d.caption+"&punid="+d.punid+"&attrType="+d.attrType+"&appUnid="+k.appUnid+"&unid="+d.unid;k.upUrl=g+"&fileName="+(a.fileName||d.fileName)+"&isMht="+k.isMht;k=Ext.encode(k);c.FileName="processing.lw";c.SaveCfgTxt(k);var j=ucapSession.hostPath+appPath+"GetAttrInfo?act=down&docType="+(a.docType||d.docType)+"&unid="+(a.unid||d.unid);c.FileName=d.fileName;c.DownloadAttr(j);c.Launch()}}};Ext.Ajax.request(b)},setWordFormCfg:function(b,a){var c={url:ucapSession.baseAction,params:{unid:b.punid,type:"getWordForm"},jsonData:b,callback:function(m,l,j){if(l){var h="";var g="";var e=Ext.decode(j.responseText);var f=ucapCommonFun.dealException(e);if(!f){return}for(var k=0;k<e.length;k++){var d=e[k];h+=d.nameCn.replace(/,/g,"")+",";g+=d.nameEn.replace(/,/g,"")+","}h+=ucap_attr.optionCfg[0].replace(/(,)$/g,"");g+=ucap_attr.optionCfg[1].replace(/(,)$/g,"");a.FileName=b.unid+"_source.lw";a.SaveCfgTxt(h+";"+g);b.fileName=b.unid+".doc";ucap_attr.setWordInfoConfig(b,a,{})}}};Ext.Ajax.request(c)},setWordOpinionSource:function(h,d,g,a,f,j){var c=h.punid;var e=ucap_attr.attr_escapeStr;var b={url:ucapSession.baseAction,params:{act:"2",unid:c,type:"getWordForm"},jsonData:h,callback:function(t,s,o){if(s){var q={0:"opinion_name",1:"opinion_type",2:"opinion_content",3:"opinion_transactor_name",4:"opinion_tran_dept_name",5:"opinion_transact_time"};var k=Ext.decode(o.responseText);var l=ucapCommonFun.dealException(k);if(!l){return}ucap_attr.optionSource[0]="";ucap_attr.optionSource[1]="";if(k&&k!=null){for(var p=0;p<k.length;p++){var n="";var m="";var r=k[p];if(p==0){n+=q[0]+r[q[1]]+"";m+=e(r[q[0]])+"\n"+e(r[q[2]])+"\n"+e(r[q[3]])+"\t"+e(r[q[4]])+"\t"+e(r[q[5]])+"\n";if(p==k.length-1){ucap_attr.optionSource[0]+=n;ucap_attr.optionSource[1]+=e(m)}}else{if(r[q[p-1]]==r[q[p]]){m+=e(r[q[2]])+"\n"+e(r[q[3]])+"\t"+e(r[q[4]])+"\t"+e(r[q[5]])+"\n";if(p==k.length-1){ucap_attr.optionSource[0]+=n;ucap_attr.optionSource[1]+="\n"+e(m)}}else{ucap_attr.optionSource[0]+=n;ucap_attr.optionSource[1]+="\t"+e(m);n="\t"+q[0]+r[q[1]];m=e(r[q[0]])+","+e(r[q[2]])+","+e(r[q[3]])+","+e(r[q[4]])+","+e(r[q[5]])+""}}}}if(g){ucap_attr.setWordFormSource(h,d,a,f,j)}}}};Ext.Ajax.request(b)},setWordFormSource:function(f,e,d,g,a){var b=ucap_attr.attr_escapeStr;var c={url:ucapSession.baseAction,params:{act:"1",unid:f.punid,formUnid:_UcapForm.cfg.mainUnid,type:"getWordForm"},jsonData:f,callback:function(k,o,j){if(o){var n="";var m="";var l=Ext.decode(j.responseText);var h=ucapCommonFun.dealException(l);if(!h){return}l=l[0];for(fkey in l){n+=fkey.replace(/\t/g,"")+"\t";m+=b(l[fkey])+"\t"}n+=ucap_attr.optionSource[0].replace(/(,)$/g,"");m+=ucap_attr.optionSource[1].replace(/(,)$/g,"");e.FileName=f.unid+".lw";e.SaveCfgTxt(n+"\n"+m,"1");if(d){ucap_attr.setWordInfoConfig(f,e)}if(g){g(f,e,a)}}}};Ext.Ajax.request(c)},open:function(a){var d={};Ext.apply(d,ucap_attr.json||{});Ext.apply(d,a||{});if((typeof(d.actionType)=="undefined")){Ext.Msg.alert("提示信息","打开WORD的actionType不能为空！");return}var c=null;try{c=new ActiveXObject("ucapWord.Interface")}catch(f){Ext.Msg.alert("系统提示：","系统检测：您当前未安装ucap相关控件！");return}if(d.actionType=="10"){ucap_attr.setWordFormCfg(d,c)}else{var b={url:appPath+"GetAttrInfo",params:{punid:d.punid,funid:_UcapForm.cfg.mainUnid,act:"list",type:d.attrType},callback:function(o,n,j){if(n){var e=Ext.decode(j.responseText);var g=ucapCommonFun.dealException(e);if(!g){return}var m=e.length;var h;var l;if(m==1){if(e[0]==null){Ext.Msg.alert("系统提示","未配置模板！");return}h=e[0]["unid"];if(h){d.stateType="2";d.unid=h;l="0"}else{if(d.actionType==0){Ext.Msg.alert("系统提示","没找到相关文件！");return}h=e[0]["cfgUnid"];d.stateType="1";var k=new ActiveXObject("Linewell.Windows");d.unid=k.GetUNID();l="1"}d.fileName=d.unid+".doc";d.caption=e[0]["caption"]||e[0]["cfgCaption"];d.attrType="0";d.docType="0";ucap_attr.setWordOpinionSource(d,c,1,0,ucap_attr.setWordInfoConfig,{punid:d.punid,docType:l,fileName:d.fileName,unid:h})}else{}}}};Ext.Ajax.request(b)}},attr_escapeStr:function(a){a=a.replace(/[\r|\n]/ig,"`!p").replace(/(\t)/ig,"`!t");return a}};var viewBaseInfo={viewId:"",formId:"",formType:"",isSonView:false,sonViewIds:"",previewType:"",categoryType:"",checkPosition:"",pageSize:20,viewType:"",openJs:"",isFlowItem:false,advancedJson:null,categoryItemType:"",isEdit:false,formItemsJson:null,loadJs:"",addRowjs:"",onlysaveSelected:false};var view={viewType:"01",viewId:"",renderto:"",hasTab:false,dataUrl:ucapSession.baseAction+"?type=getView&action=getData&rand="+Math.random(),checkPosition:"",width:822,json:null,displayName:"",viewBaseInfos:null,namePrefix:"viewdiv_",pageSize:10,index:0,sqlLikeKey:"~!@0~!@5",sqlAnd:"~!@AND@!~",sqlOr:"~!@OR@!~",sqlLTEQ:"~!@0~!@2",sqlGTEQ:"~!@0~!@1",sqlEQ:"~!@0~!@0",fieldDbType:"~!@DB@!~",fieldConstType:"~!@CL@!~",fieldEndPrefix:"~!@E@!~",currentGridIndex:0,purl:"",mouseOverIndex:-1,outOtherHeight:0,pcateUrl:"",isSingle:"",recordSplit:"",colSplit:"",isTab:"",noTbar:"",noBbar:"",gridHeight:0,gridWidth:0,initview:function(h,c,a,b,d){var f=h.split(",");for(var e=0;e<f.length;e++){if(undefined==f[e]||f[e]==""){continue}if(view.getIndexFromBaseInfo(f[e])>=0){return}view.init(f[e]);var g=view.viewBaseInfos.length-1;view.createGridDiv(g,c);if("undefined"!=a&&(a==true||a=="true")){var k=Ext.getDom("search");if(undefined!=k&&null!=k){k.style.display="none"}}else{view.initSimpleSelect(view.json,g);view.initAdvancedSelect(view.json,g)}if(view.viewType=="01"){view.loadCommonGrid(f[e],g,b,d)}else{if(view.viewType=="02"){view.loadListGrid(f[e],g)}else{view.loadImageGrid(f[e],g)}}if(view.viewBaseInfos[g].categoryType=="02"&&g==0){viewTree.init(view.viewBaseInfos[g].viewId,"viewCategories",g,view.viewBaseInfos[g].categoryItemType)}if(view.viewBaseInfos[g].sonViewIds!=""){view.initview(view.viewBaseInfos[g].sonViewIds,c,a,b,d)}}},refreshView:function(h,c,a,b,d){var f=h.split(",");for(var e=0;e<f.length;e++){if(undefined==f[e]||f[e]==""){continue}var g=view.getIndexFromBaseInfo(h);view.init(f[e],g);view.createGridDiv(g,c);if("undefined"!=typeof(a)&&(a==true||a=="true")){var k=Ext.getDom("search");if(undefined!=k&&null!=k){k.style.display="none"}}else{view.initSimpleSelect(view.json,g);view.initAdvancedSelect(view.json,g)}if(view.viewType=="01"){view.loadCommonGrid(f[e],g,b,d)}else{if(view.viewType=="02"){view.loadListGrid(f[e],g)}else{view.loadImageGrid(f[e],g)}}if(view.viewBaseInfos[g].categoryType=="02"&&g==0){viewTree.init(view.viewBaseInfos[g].viewId,"viewCategories",g,view.viewBaseInfos[g].categoryItemType)}if(view.viewBaseInfos[g].isSonView&&view.viewBaseInfos[g].sonViewIds!=""){view.initview(view.viewBaseInfos[g].sonViewIds,c,a,b,d)}}},getIndexFromBaseInfo:function(b){var a=-1;if(undefined!=view.viewBaseInfos&&view.viewBaseInfos.length>0){for(var d=0;d<view.viewBaseInfos.length;d++){var c=view.viewBaseInfos[d];if(c.viewId==b){a=d;break}}}return a},createGridDiv:function(e,a){var c=document.getElementById(a);c.innerHTML="";if(view.viewBaseInfos[0].categoryType=="02"){var b=Ext.getDom("viewCategories");if(undefined==b){b=document.createElement("div");b.id="viewCategories";c.appendChild(b)}}var j=Ext.getDom("mainRight");if(undefined==j){j=document.createElement("div");j.id="mainRight";j.style.styleFloat="left";c.appendChild(j)}var d=document.createElement("div");var h='<div id="searchLeft"></div>';h+='<div id="searchBox"><img src="'+ucapSession.sUserImgPath+'icon_search.gif" align="absmiddle" /> 搜索：';h+="<input name='keyword' type='text' class='searchinputbox' onkeydown='view.kdSearch("+e+")' id='keyword' onmousedown=\"if(this.value=='请输入搜索关键字')this.value=''\" value='请输入搜索关键字' size='20' />";h+=' 在 <select name="searchName" id=\'simpleSearchSelect_'+e+"'>";h+="<option value='0'>请选择搜索范围</option>";h+='</select> <input type="button" value="搜索" id="simpleSearch_'+e+'" class="btn1" onclick=view.search('+e+')> <input type="button" class="btn1" id="advancedSearch_'+e+'" onclick="view.setSearchMore(this,'+e+')" value="▼高级搜索" />';d.innerHTML=h;d.id="search";j.appendChild(d);var f=document.createElement("div");f.id="searchMore_"+e;f.style.display="none";j.appendChild(f);var g=document.createElement("div");g.id=view.namePrefix+e;j.appendChild(g)},init:function(a,d){var c=ucapSession.baseAction;c+="?viewId="+a+"&type=getView&rand="+Math.random();var f=Ext.lib.Ajax.getConnectionObject().conn;f.open("GET",c,false);f.send(null);view.json=Ext.util.JSON.decode(f.responseText);var e=ucapCommonFun.dealException(view.json);if(!e){return}if(null==view.viewBaseInfos){view.viewBaseInfos=new Array()}var b=new Object();b.viewId=view.json.punid;b.formId=view.json.formUnid;b.formType=view.json.formType;b.previewType=view.json.previewType;b.isSonView=view.json.sonView;b.pageSize=view.json.pageSize;if(isNaN(b.pageSize)){b.pageSize=0}else{if(parseInt(b.pageSize)<=0){b.pageSize=20}}b.categoryType=view.json.categories;b.checkPosition=view.json.checkPosition;b.sonViewIds=view.json.sonViewUnids;b.viewType=view.json.type;b.openJs=view.json.openJs;if("undefined"!=typeof(view.json.flowItem)){b.isFlowItem=view.json.flowItem}if(undefined==view.json.categoryItems||view.json.categoryItems.length==0){b.categoryType="00"}else{b.categoryItemType=view.json.categoryItems[0].itemType;if(b.categoryType==""){b.categoryType="01"}}var g=1;if(window.parent&&window.parent._UcapForm&&window.parent._UcapForm.cfg){if("undefined"!=typeof(window.parent._UcapForm.cfg.isRead)&&null!=window.parent._UcapForm.cfg.isRead){g=window.parent._UcapForm.cfg.isRead}}if(typeof(g)!="undefined"&&g==1){b.isEdit=view.json.edit}else{b.isEdit=false}b.loadjs=view.json.loadjs;b.addRowjs=view.json.addRowjs;b.onlysaveSelected=view.json.onlysaveSelected;if(undefined==d||d<0){view.viewBaseInfos[view.viewBaseInfos.length]=b}},initSimpleSelect:function(c,a){var e=c.query;if(undefined==e){return}var f=e.querySimpleItems;if(undefined==f){return}var d=Ext.getDom("simpleSearchSelect_"+a);for(var b=0;b<f.length;b++){ucapCommonFun.addOption(d,f[b].itemNameEn,f[b].itemNameCn)}},initAdvancedSelect:function(j,f){var g=j.query;if("undefined"==typeof(g)||g==null){var e=Ext.getDom("search");e.style.display="none";return}var h=g.queryAdvancedItems;if("undefined"==typeof(h)||h==null||h.length<1){Ext.getDom("advancedSearch_"+f).style.display="none";return}view.viewBaseInfos[f].advancedJson=h;var d=Ext.getDom("searchMore_"+f);var l=0;var c="";var a="yyyy-MM-dd";for(var b=0;b<h.length;b++){var k="";if(h[b].hasBegin){if("undefined"!=typeof(h[b].dataType)&&(h[b].dataType=="04"||h[b].dataType=="05")){k+='&nbsp;从&nbsp;&nbsp;<input type="text" name=\''+h[b].itemNameEn+'_1\' class="inputred" readOnly/>';k+="<IMG style='CURSOR: pointer' onclick='WdatePicker({el:\""+h[b].itemNameEn+'_1",dateFmt:"'+a+"\"});' src='"+ucapSession.appPath+"js/ucap/calendar/skin/datePicker.gif' width=16 align=absMiddle/>";k+='&nbsp;&nbsp;到&nbsp;&nbsp;<input type="text" name=\''+h[b].itemNameEn+'_2\' class="inputred" readOnly/>';k+="<IMG style='CURSOR: pointer' onclick='WdatePicker({el:\""+h[b].itemNameEn+'_2",dateFmt:"'+a+"\"});' src='"+ucapSession.appPath+"js/ucap/calendar/skin/datePicker.gif' width=16 align=absMiddle/>"}else{k+='&nbsp;从&nbsp;&nbsp;<input type="text" name=\''+h[b].itemNameEn+'_1\' class="inputsearchbox"/>';k+='&nbsp;&nbsp;到&nbsp;&nbsp;<input type="text" name=\''+h[b].itemNameEn+'_2\' class="inputsearchbox"/>'}}else{if("undefined"!=typeof(h[b].dataType)&&h[b].dataType=="20"){k+='<input type="hidden" id=\''+h[b].itemNameEn+"' name='"+h[b].itemNameEn+'\' class="inputsearchbox"/>';k+='<input type="text" id=\''+h[b].itemNameEn+"_Cn_' name='"+h[b].itemNameEn+'_Cn_\' class="inputred" readOnly/>';k+="<input type='button' class='btn1' name='btnselect' value='选择' onclick=\"selectDataSD('"+h[b].dataSource+"',1,'"+h[b].itemNameEn+"')\"/>"}else{if("undefined"!=typeof(h[b].dataType)&&h[b].dataType=="03"){k+="<select id='"+h[b].itemNameEn+"' name='"+h[b].itemNameEn+"'>"+h[b].optionValue+"</select>"}else{k+='<input type="text" id=\''+h[b].itemNameEn+"' name='"+h[b].itemNameEn+'\' class="inputsearchbox"/>'}}if("undefined"!=typeof(h[b].dataType)&&(h[b].dataType=="04"||h[b].dataType=="05")){k+="<IMG style='CURSOR: pointer' onclick='WdatePicker({el:\""+h[b].itemNameEn+'",dateFmt:"'+a+"\"});' src='"+ucapSession.appPath+"js/ucap/calendar/skin/datePicker.gif' width=16 align=absMiddle/>"}}if(l%2==0){c+="<tr>";c+="<th height='20' class=\"head\">"+h[b].itemNameCn+"</th>";if((h.length<=(b+1))||h[b+1].hasBegin){c+="<td colspan='3'>";c+=k;c+="</td>";c+="</tr>";l=l+2}else{if(h[b].hasBegin){c+="<td colspan='3'>";c+=k;c+="</td>";l=l+2}else{c+="<td>"+k+"</td>";l=l+1}}}else{c+="<th height='20' class=\"head\">"+h[b].itemNameCn+"</th>";c+="<td>";c+=k+"</td>";c+="</tr>";l=l+1}}if(c!=""){if(c.substring(c.length-5,c.length)!="</tr>"){c=c.substring(0,c.length-5)}else{c=c.substring(0,c.length-10)}c+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='button' class='btn1' value='搜索' onclick='view.advancedSearch("+f+")'/></td></tr>"}c='<table class="table2">'+c;c+="</table>";d.innerHTML=c},setSearchMore:function(e,b){var d=document.getElementById("searchMore_"+b);if(d.style.display==""){d.style.display="none";var c=Ext.getCmp(view.namePrefix+b);c.setHeight(ucapSession.middleHeight-27-view.outOtherHeight);e.value="▼高级搜索"}else{d.style.display="";var c=Ext.getCmp(view.namePrefix+b);d.style.width=c.getInnerWidth()-2;var a=document.getElementById("searchMore_"+b).offsetHeight;c.setHeight(ucapSession.middleHeight-27-view.outOtherHeight-a);e.value="▲高级搜索"}},reloadSonView:function(f,e){if(undefined==f||f==""){return}var h=f.split(",");for(var c=0;c<h.length;c++){var g=h[c];var k=null;var d=-1;for(var b=0;b<view.viewBaseInfos.length;b++){if(view.viewBaseInfos[b].viewId==g){k=view.viewBaseInfos[b];d=b}}if(null!=k){if(k.viewTyp=="01"){var a=Ext.getCmp(view.namePrefix+d);a.getStore().baseParams={pdid:e};a.getStore().reload({params:{start:0,limit:k.pageSize}})}else{if(k.viewTyp=="02"){loadListGrid(g,d,e)}else{if(k.viewTyp=="03"){loadListGrid(g,d,e)}}}}}},loadCommonGrid:function(curViewId,index,noPreview,noSelfConfig){var searchDiv=Ext.getDom("search");var width=document.body.offsetWidth;var vcDiv=Ext.getDom("viewCategories");var gridJspHeight=0;if("undefiend"!=searchDiv&&null!=searchDiv&&searchDiv.offsetWidth>0){width=searchDiv.offsetWidth}else{var gridAutoHeight=false;if("undefined"!=typeof(vcDiv)&&vcDiv!=null){width=width-vcDiv.offsetWidth-6}var mainLeft=Ext.getDom("ucapMainLeft");if("undefined"!=typeof(mainLeft)&&mainLeft!=null&&mainLeft.offsetWidth>0){width=width-mainLeft.offsetWidth-8;if("undefined"!=typeof(vcDiv)&&vcDiv!=null){width=width+2}}}if("undefined"==typeof(isFromJsp)||isFromJsp!="true"){gridAutoHeight=false}else{var pIframe=window.parent.Ext.getDom("ifr"+curViewId);if("undefined"!=typeof(pIframe)&&null!=pIframe&&parseInt(pIframe.style.height)>0){gridJspHeight=parseInt(pIframe.style.height);var vcDiv=Ext.getDom("viewCategories");if("undefined"!=typeof(vcDiv)&&null!=vcDiv){vcDiv.style.height=gridJspHeight}var searchDiv=Ext.getDom("search");if("undefiend"!=searchDiv&&null!=searchDiv){gridJspHeight=gridJspHeight-searchDiv.offsetHeight}gridAutoHeight=false}else{gridAutoHeight=true}}var url=view.dataUrl+"&viewId="+curViewId;var urlsp=url.split("?");url=url.substring(urlsp[0].length+1);var urljson=Ext.urlDecode(url);var purljson=Ext.urlDecode(view.purl);Ext.apply(purljson,urljson);url=urlsp[0]+"?"+Ext.urlEncode(purljson);var items=null;var remoteSort=true;if(view.viewBaseInfos[index].isEdit){items=Ext.util.JSON.decode(view.getEditColumnModuleJson(index,view.json));remoteSort=false}else{items=Ext.util.JSON.decode(view.getColumnModuleJson(view.json))}var cm=new Ext.grid.ColumnModel(items);var ds=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:url}),reader:new Ext.data.JsonReader({totalProperty:"totalProperty",root:"root"},view.getJsonReader(view.json)),remoteSort:remoteSort});ds.load({params:{start:0,limit:view.viewBaseInfos[index].pageSize}});var sm=null;if(view.isSingle=="1"){sm=new Ext.grid.RowSelectionModel({singleSelect:true})}else{sm=new Ext.grid.CheckboxSelectionModel()}var gridTbar=null;if("undefined"==typeof(view.noTbar)||view.noTbar!="true"){gridTbar=new Ext.Toolbar({items:view.getTBarJson(view.json,index,noPreview,noSelfConfig)})}var gridBbar=null;if("undefined"==typeof(view.noBbar)||view.noBbar!="true"){gridBbar=new Ext.PagingToolbar({pageSize:view.viewBaseInfos[index].pageSize,store:ds,displayInfo:true,displayMsg:"显示第 {0} 条到 {1} 条记录，一共 {2} 条",emptyMsg:"没有记录"})}var grid=null;if(view.viewBaseInfos[index].isEdit){width=width-14;grid=new Ext.grid.EditorGridPanel({id:view.namePrefix+index,stripeRows:true,cm:cm,ds:ds,sm:sm,loadMask:true,autoHeight:gridAutoHeight,autoWidth:false,width:width,tbar:gridTbar,bbar:gridBbar,clicksToEdit:1,renderTo:view.namePrefix+index})}else{grid=new Ext.grid.GridPanel({id:view.namePrefix+index,stripeRows:true,cm:cm,ds:ds,sm:sm,loadMask:true,autoHeight:gridAutoHeight,autoWidth:false,width:width,viewConfig:{forceFit:false},tbar:gridTbar,bbar:gridBbar,renderTo:view.namePrefix+index});grid.on("headerclick",view.headerclick);if(view.json.messageType!=""&&view.json.messageType!="01"){grid.on("mouseover",view.mouseover)}grid.getColumnModel().on("columnmoved",view.columnMove);grid.on("rowdblclick",view.rowdbClick);grid.on("cellclick",view.cellclick)}cm.defaultSortable=true;if("undefined"==typeof(isFromJsp)||isFromJsp!="true"){if(!gridAutoHeight){view.setGridHeight(grid)}}else{if(!gridAutoHeight){grid.setHeight(gridJspHeight)}}if(null!=view.viewBaseInfos[index].loadjs&&view.viewBaseInfos[index].loadjs!=""){if(view.viewBaseInfos[index].loadjs.indexOf(")")>0){eval(view.viewBaseInfos[index].loadjs)}else{eval(view.viewBaseInfos[index].loadjs+"()")}}if(null!=grid.getStore().getSortState()){grid.getStore().getSortState().field=null}},focus:function(b){var a=Ext.getCmp(view.namePrefix+view.index);var d=a.getSelectionModel();var c=d.getSelected();b.setValue("设置单元格的值!")},insertEditorGridData:function(l){var b=Ext.getCmp(view.namePrefix+view.index);var h="";var c="";var s=true;if("undefined"!=typeof(l)&&l!=""){c=l;s=false}var q=b.getColumnModel().getColumnCount(false);var g=1;if(view.viewBaseInfos[view.index].checkPosition!="02"){g=0}for(var f=g;f<q;f++){var o=b.getColumnModel().getDataIndex(f);var p=view.getItemJsonByItemUnid(view.viewBaseInfos[view.index].formItemsJson,o);var d="";if(null!=p&&null!=p.uiItemValueList){for(var e=0;e<p.uiItemValueList.length;e++){if(d==""){d=typeof(p.uiItemValueList[e].value)=="undefined"?p.uiItemValueList[e].text:p.uiItemValueList[e].value}else{d+=","+typeof(p.uiItemValueList[e].value)=="undefined"?p.uiItemValueList[e].text:p.uiItemValueList[e].value}}}if(h==""){h+="{name:'"+o+"'}";if(s){c+=o+":'"+d+"'"}}else{h+=",{name:'"+o+"'}";if(s){c+=","+o+":'"+d+"'"}}}var n=Ext.data.Record.create(Ext.decode("["+h+"]"));var a=new n(Ext.decode("{"+c+"}"));var m=b.getStore().getCount();b.stopEditing();b.getStore().insert(m,a);b.startEditing(m,g+1)},deleteEditorGridData:function(){var a=Ext.getCmp(view.namePrefix+view.index);var b=a.getSelectionModel().getSelections();if(null==b.length||undefined==b.length){b=new Array(b)}for(i=0;i<b.length;i++){var c=b[i];a.getStore().remove(c)}},addEditorGridRow:function(){if(null!=view.viewBaseInfos[0].addRowjs&&""!=view.viewBaseInfos[0].addRowjs){if(view.viewBaseInfos[0].addRowjs.indexOf(")")>0){eval(view.viewBaseInfos[0].addRowjs)}else{eval(view.viewBaseInfos[0].addRowjs+"()")}}},getEditorGridDatas:function(){if(!view.viewBaseInfos[view.index].isEdit){return"[]"}var a=Ext.getCmp(view.namePrefix+view.index);if(!view.viewBaseInfos[view.index].onlysaveSelected){a.getSelectionModel().selectAll()}var f=a.getSelectionModel().getCount();if(f<1){return"[]"}var d="[";var k=a.getColumnModel().getColumnCount(false);var e=1;if(view.viewBaseInfos[view.index].checkPosition!="02"){e=0}for(var c=0;c<f;c++){var l=a.getSelectionModel().getSelections()[c];if(d!="["){d+=",{"}else{d+="{"}var h=a.getColumnModel().getDataIndex(e);d+="formUnid:'"+view.viewBaseInfos[view.index].formId+"',unid";d+=":'"+(l.data[h]||"")+"',isNew:";if(null==l.data[h]||l.data[h]==""){d+="'1'"}else{d+="'0'"}d+=",item:[";for(var b=e;b<k;b++){var g=a.getColumnModel().getDataIndex(b);if(g==h){continue}d+="{k:'"+g+"',v:"+Ext.encode(view.formatDate((l.data[g]||"")))+"},"}d=d.substring(0,d.length-1);d+="]";d+="}"}d+="]";return d},setGridHeight:function(b){var a=Ext.getDom("search");var d=Ext.getDom("viewCategories");if("undefined"==typeof(b)||b==null){var b=Ext.getCmp(view.namePrefix+view.index)}if("undefiend"==typeof(b)||b==null){return}if(ucapSession.middleHeight==0){ucapCommonFun.autoMenuHeight()}var c=ucapSession.middleHeight;if("undefiend"!=a&&null!=a){c=c-a.offsetHeight}b.setHeight(c-view.outOtherHeight);if("undefined"!=typeof(d)&&d!=null){d.style.height=ucapSession.middleHeight}},mouseover:function(c,h){var b="";var g=this.getView().findRowIndex(h);if(g==view.mouseOverIndex){return}view.mouseOverIndex=g;var j=this.getStore().getAt(view.mouseOverIndex);if(null==j||typeof(j)=="undefined"){return}var d=0;var k=view.viewBaseInfos[view.getGridNum(this.id)];if(k.checkPosition=="02"){d=1}b=k.viewId;var a=j.data[this.getColumnModel().getDataIndex(d)];var f=ucapCommonFun.getViewTip(b,a);Ext.QuickTips.register({target:c.target,text:f,autoHide:true,hideDelay:0,showDelay:0})},loadListGrid:function(f,b,a){var d='<table class=table3 cellSpacing=0 cellPadding=0 width="100%" border=0>';for(var c=0;c<20;c++){d+="<tr>";d+='<TD class=tdHover><IMG src="'+ucapSession.sUserImgPath+'icon_file.gif">&nbsp;&nbsp;<A class=tableText href="#">一个模块下可以包含多级的子模块，显示主要有两种形式</A></TD>';d+='<TD class=tdHover><IMG src="'+ucapSession.sUserImgPath+'icon_file.gif">&nbsp;&nbsp;<A class=tableText href="#">一个模块下可以包含多级的子模块，显示主要有两种形式</A></TD>';d+="</tr>"}d+="</table>";var e=Ext.getDom(view.namePrefix+b);e.style.margin="0px 5px";e.style.border="#BAD1D7 1px solid";e.style.padding="4px";e.style.height="485px";e.style.overflow="auto";e.innerHTML=d},loadImageGrid:function(f,b,a){var d="<table class=table5>";for(var c=0;c<3;c++){d+="<tr>";d+='<TH><A href="#"><IMG height=100 src="../../appimage/imglist_pic_5.jpg" width=154></A></TH>';d+='<TH><A href="#"><IMG height=100 src="../../appimage/imglist_pic_6.jpg" width=154></A></TH>';d+='<TH><A href="#"><IMG height=100 src="../../appimage/imglist_pic_7.jpg" width=154></A></TH>';d+='<TH><A href="#"><IMG height=100 src="../../appimage/imglist_pic_8.jpg" width=154></A></TH>';d+="</tr>";d+="<tr>";d+='<TD><INPUT id=checkbox type=checkbox name=checkbox> <A class=tableText href="#">图文并茂式</A>&nbsp;&nbsp;&nbsp;<IMG height=13 src="'+ucapSession.sUserImgPath+'img_between.gif" width=1> &nbsp;<A href="#"><IMG title=修改 height=9 src="'+ucapSession.sUserImgPath+'icon_img_edit.gif" width=9></A> <A href="#"><IMG title=删除 height=7 src="'+ucapSession.sUserImgPath+'icon_img_del.gif" width=8></A></TD>';d+='<TD><INPUT id=checkbox type=checkbox name=checkbox> <A class=tableText href="#">图文并茂式</A>&nbsp;&nbsp;&nbsp;<IMG height=13 src="'+ucapSession.sUserImgPath+'img_between.gif" width=1> &nbsp;<A href="#"><IMG title=修改 height=9 src="'+ucapSession.sUserImgPath+'icon_img_edit.gif" width=9></A> <A href="#"><IMG title=删除 height=7 src="'+ucapSession.sUserImgPath+'icon_img_del.gif" width=8></A></TD>';d+='<TD><INPUT id=checkbox type=checkbox name=checkbox> <A class=tableText href="#">图文并茂式</A>&nbsp;&nbsp;&nbsp;<IMG height=13 src="'+ucapSession.sUserImgPath+'img_between.gif" width=1> &nbsp;<A href="#"><IMG title=修改 height=9 src="'+ucapSession.sUserImgPath+'icon_img_edit.gif" width=9></A> <A href="#"><IMG title=删除 height=7 src="'+ucapSession.sUserImgPath+'icon_img_del.gif" width=8></A></TD>';d+='<TD><INPUT id=checkbox type=checkbox name=checkbox> <A class=tableText href="#">图文并茂式</A>&nbsp;&nbsp;&nbsp;<IMG height=13 src="'+ucapSession.sUserImgPath+'img_between.gif" width=1> &nbsp;<A href="#"><IMG title=修改 height=9 src="'+ucapSession.sUserImgPath+'icon_img_edit.gif" width=9></A> <A href="#"><IMG title=删除 height=7 src="'+ucapSession.sUserImgPath+'icon_img_del.gif" width=8></A></TD>';d+="</tr>"}d+="</table>";var e=Ext.getDom(view.namePrefix+b);e.style.margin="0px 5px";e.style.border="#BAD1D7 1px solid";e.style.padding="4px";e.style.height="485px";e.style.overflow="auto";e.innerHTML=d},getColumnModuleJson:function(d){var e="";view.checkPosition=d.checkPosition;if(view.checkPosition=="02"){e+="new Ext.grid.CheckboxSelectionModel()"}var b=d.viewItems;for(var c=0;c<b.length;c++){if(undefined==typeof(b[c].itemNameEn)||b[c].itemNameEn==""){continue}if(e==""){e="{header:'"+b[c].displayName+"'"}else{e=e+",{header:'"+b[c].displayName+"'"}e+=",dataIndex:'"+b[c].itemNameEn.toLowerCase()+"'";var f=b[c].width;var a=b[c].widthType;if(!b[c].display){e+=",hidden:true,hideable:false"}if(a=="02"){f=view.width*f/100}e+=",width:"+f;if(b[c].conversion!=""){e+=",renderer:"+b[c].conversion}e+="}"}if(view.checkPosition=="03"){e+=",new Ext.grid.CheckboxSelectionModel()"}e="["+e+"]";return e},getEditColumnModuleJson:function(j,m){var o=view.viewBaseInfos[j];var a=ucapSession.baseAction;a+="?formType=01&formId="+o.formId+"&type=getForm&rand="+Math.random();var e=Ext.lib.Ajax.getConnectionObject().conn;e.open("GET",a,false);e.send(null);var d=Ext.util.JSON.decode(e.responseText);var b=ucapCommonFun.dealException(d);if(!b){return}view.viewBaseInfos[j].formItemsJson=d;var k="";view.checkPosition=m.checkPosition;if(view.checkPosition=="02"){k+="new Ext.grid.CheckboxSelectionModel()"}var n=m.viewItems;for(var g=0;g<n.length;g++){if(undefined==typeof(n[g].itemNameEn)||n[g].itemNameEn==""){continue}var l=view.getItemJsonByItemUnid(d,n[g].itemUnid);if(k==""){k="{header:'"+n[g].displayName+"'"}else{k=k+",{header:'"+n[g].displayName+"'"}k+=",dataIndex:'"+n[g].itemNameEn.toLowerCase()+"'";var c=n[g].width;var f=n[g].widthType;if(!n[g].display){k+=",hidden:true,hideable:false"}if(f=="02"){c=view.width*c/100}k+=",width:"+c;if(n[g].conversion!=""){k+=",renderer:"+n[g].conversion}else{if(null!=l&&(l.item.sourceType=="04"||l.item.sourceType=="05")){k+=",renderer:view.formatDate"}}var h=view.getEditerByItemJson(l,n[g]);if(null!=h&&h!=""){k+=","+h}k+="}"}if(view.checkPosition=="03"){k+=",new Ext.grid.CheckboxSelectionModel()"}k="["+k+"]";return k},formatDate:function(b){try{return b.format("Y-m-d")}catch(a){return b}},getItemJsonByItemUnid:function(d,c){var e=null;if(null!=d&&d.uiItemList.length>0){for(var b=0;b<d.uiItemList.length;b++){var a=d.uiItemList[b];if(null!=a&&null!=a.item&&(c==a.item.unid||a.item.nameEn.toLowerCase()==c)){e=a;break}}}return e},getEditerByItemJson:function(e,b){var c="";if(null==e||null==e.item){return c}switch(e.item.sourceType){case"03":c="editor: new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',transform:'"+e.item.nameEn.toLowerCase()+"',lazyRender:true,listClass: 'x-combo-list-small'";if(null!=e.item.itemShow){if("undefined"!=typeof(e.item.itemShow.readOnly)&&e.item.itemShow.readOnly){c+=",readOnly:true"}}c+="})";var a=document.getElementById(e.nameEn);if("undefined"==typeof(a)||null==a){a=document.createElement("select");a.id=e.item.nameEn.toLowerCase();a.name=e.item.nameEn.toLowerCase();a.style.display="none";if(null!=e.dictTree&&null!=e.dictTree.children){for(var d=0;d<e.dictTree.children.length;d++){ucapCommonFun.addOption(a,e.dictTree.children[d].value,e.dictTree.children[d].text)}}document.body.insertBefore(a)}break;case"04":c="editor:new Ext.form.DateField({format:'Y-m-d'";if(null!=e.item.itemShow){if("undefined"!=typeof(e.item.itemShow.readOnly)&&e.item.itemShow.readOnly){c+=",readOnly:true"}}c+="})";break;case"05":c="editor:new Ext.form.DateField({format:'Y-m-d'";if(null!=e.item.itemShow){if("undefined"!=typeof(e.item.itemShow.readOnly)&&e.item.itemShow.readOnly){c+=",readOnly:true"}}c+="})";break;case"20":c="editor: new Ext.form.TextField({";if(b.onclick!=""){c+="listeners:{focus:"+b.onclick+"}"}if(b.onchange!=""){c+="listeners:{change:function(field,e){ "+b.onchange+" }}"}if(null!=e.item.itemShow){if("undefined"!=typeof(e.item.itemShow.readOnly)&&e.item.itemShow.readOnly){if(b.onclick!=""){c+=","}c+="readOnly:true"}}c+="})";break;default:if(e.item.length>500){c="editor: new Ext.form.TextArea({";if(b.onclick!=""){c+="listeners:{focus:"+b.onclick+"}"}else{c+="listeners:{focus:view.setTextAreaHeight}"}}else{c="editor: new Ext.form.TextField({";if(b.onclick!=""){c+="listeners:{focus:"+b.onclick+"}"}if(b.onchange!=""){c+="listeners:{change:function(field,e){ "+b.onchange+" }}"}if(null!=e.item.itemShow){if("undefined"!=typeof(e.item.itemShow.readOnly)&&e.item.itemShow.readOnly){if(b.onclick!=""){c+=","}c+="readOnly:true"}}}c+="})"}return c},setTextAreaHeight:function(a){a.setHeight(200)},getJsonReader:function(d){var a="";var b=d.viewItems;for(var c=0;c<b.length;c++){if(undefined==typeof(b[c].itemNameEn)||b[c].itemNameEn==""){continue}if(a==""){a+="{name:'"+b[c].itemNameEn.toLowerCase()+"'}"}else{a+=",{name:'"+b[c].itemNameEn.toLowerCase()+"'}"}}a="["+a+"]";return Ext.util.JSON.decode(a)},getTBarJson:function(h,f,a,c){var g="";var b=h.subButtonList;for(var e=0;e<b.length;e++){if(typeof b[e].button=="undefined"||b[e].button=="null"||b[e].button==null){continue}if("undefined"!=typeof(b[e].js)&&b[e].js!=""){var j=ucapCommonFun.evalJavaScript(b[e].js);if(!j){continue}}if(g==""){g="{id:'btn"+b[e].unid+"'"}else{g+=",{id:'btn"+b[e].unid+"'"}g+=",text:'"+b[e].name+"'";if("undefined"!=typeof(b[e].picture)&&b[e].picture!=""){g+=",icon:'"+ucapSession.sUserImgPath+b[e].picture+"'";g+=",iconCls:'x-btn-text-icon'"}var d=b[e].button.codeType;if(d=="01"){g+=",handler:function(){view.index="+f+";"+b[e].button.code+"}}"}else{if(d=="02"){g+=",handler:function(){view.index="+f+";view.executeInteration('"+b[e].button.code+"')}}"}else{if(d=="03"){g+=",handler:function(){view.index="+f+";ucapCommonFun.newFlowDocByFlowIds('"+b[e].button.code+"')}}"}}}}if(g==""){g="{id:'btnAdd',text:'新增',handler:function(){view.index="+f+";view.newDocument()}}";g+=",{id:'btndelete',text:'删除',handler:function(){view.index="+f+";view.deleteDocument()}}";g+=",{id:'btnmodify',text:'修改',handler:function(){view.index="+f+";view.openDocument(3)}}";g+=",{id:'btnrefresh',text:'刷新',handler:function(){view.index="+f+";view.refresh()}}";g+=",{id:'btnreset',text:'重置',handler:function(){view.index="+f+";view.reset()}}"}if(g!=""){g=g+",'->'"}else{g=g+"'->'"}if("undefined"==typeof(c)||!(c==true||c=="true")){g+=",{id:'btnselfconfig"+f+"',text:'自定义',";g+="iconCls: 'preview-bottom',menu:{id:'selfconfig-menu"+f+"',cls:'reading-menu',width:100,items:[";g+="{text:'基本信息',checked:true,group:'rp-group',handler:function(){view.selfConfig('01',"+f+")},scope:this}";g+=",{text:'视图列',checked:true,group:'rp-group',handler:function(){view.selfConfig('02',"+f+")},scope:this}";g+=",{text:'简单查询',checked:true,group:'rp-group',handler:function(){view.selfConfig('03',"+f+")},scope:this}";g+=",{text:'高级查询',checked:true,group:'rp-group',handler:function(){view.selfConfig('04',"+f+")},scope:this}";g+=",{text:'视图排序',checked:true,group:'rp-group',handler:function(){view.selfConfig('05',"+f+")},scope:this}";g+=",{text:'视图分类',checked:true,group:'rp-group',handler:function(){view.selfConfig('06',"+f+")},scope:this}";if(typeof(ucapSession.userJson.userStatus)!="undefined"&&ucapSession.userJson.userStatus=="1"){g+=",{text:'视图条件',checked:true,group:'rp-group',handler:function(){view.selfConfig('07',"+f+")},scope:this}";g+=",{text:'视图按钮',checked:true,group:'rp-group',handler:function(){view.selfConfig('08',"+f+")},scope:this}"}g+=",{text:'恢复默认',checked:false,group:'rp-group',handler:function(){view.selfConfig('10',"+f+")},scope:this}]}}"}g+=",{id:'btnno',text:'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'}";g="["+g+"]";return Ext.util.JSON.decode(g)},getColumnValueByName:function(f){var k="";var e="";if("undefined"==typeof(f)||f==""){return k}var h=f.split(",");var a=Ext.getCmp(view.namePrefix+view.index);var d=a.getSelectionModel().getSelections();if(null==d.length||"undefined"==typeof(d.length)){d=new Array(d)}for(var c=0;c<d.length;c++){var g=d[c];if(k!=""){k=k+view.recordSplit}for(var b=0;b<h.length;b++){if("undefined"==typeof(k)||k==""){k=g.data[h[b]]}else{k+=view.colSplit+g.data[h[b]]}}if(view.isSingle=="1"){break}}return k},getGridNum:function(b){var a=0;if(b!=""){a=Number(b.replace(view.namePrefix,""))}return a},getGridRowCount:function(){var b=Ext.getCmp(view.namePrefix+view.index);var a=b.getStore().getCount();return a},columnMove:function(c,d,b){if(view.viewBaseInfos[view.currentGridIndex].checkPosition=="02"){d=d-1;b=b-1}var a={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"sortViewColumn",viewId:view.viewBaseInfos[view.currentGridIndex].viewId,oldIndex:d,newIndex:b},callback:function(g,j,f){if(j){var h=Ext.util.JSON.decode(f.responseText);var e=ucapCommonFun.dealException(h);if(!e){return}}else{Ext.Msg.alert("提示","移动失败，下次登录时将不起作用！")}}};Ext.Ajax.request(a)},headerclick:function(a,b,c){view.currentGridIndex=view.getGridNum(a.id)},rowdbClick:function(a,h,f){var c=view.getGridNum(a.id);var k=view.viewBaseInfos[c];var b=k.openJs;if(b=="0"){return}if(k.isSonView){var j=a.getStore().getAt(h);var g=0;if(view.viewBaseInfos[c].checkPosition=="02"){g=1}var d=j.data[a.getColumnModel().getDataIndex(g)];view.openDocument(1,c,d,k.formType,k.formId)}},cellclick:function(a,h,g,f){if(g==0){return}var c=view.getGridNum(a.id);var k=view.viewBaseInfos[c];var b=k.openJs;if(b=="0"){return}if(!k.isSonView){var j=a.getStore().getAt(h);var g=0;if(view.viewBaseInfos[c].checkPosition=="02"){g=1}var d=j.data[a.getColumnModel().getDataIndex(g)];view.openDocument(1,c,d,k.formType,k.formId)}},preview:function(c,b){var a=Ext.getDom("formdiv_"+b);if(c=="00"){a.style.display="none"}else{a.style.display=""}},executeInteration:function(b){var a=Ext.getCmp(view.namePrefix+view.index);var c=view.getGridNum(a.id);var e=a.getSelectionModel().getSelections();if(null==e.length||undefined==e.length){e=new Array(e)}var f="";for(var d=0;d<e.length;d++){var h=e[d];f+=","+h.data[a.getColumnModel().getDataIndex(1)]}if(f!=""){f=f.substring(1)}var j=view.viewBaseInfos[c];var g="{unid:'"+f+"',type:'"+j.formType+"',formId:'"+j.formId+"'}";ucapCommonFun.executeInteraction(b,Ext.decode(g),1)},newDocument:function(){this.openDocument(2)},openDocument:function(e,b,d,c,g){var k=null;if("undefined"==typeof(e)||e==""){Ext.Msg.alert("提示信息","openDocument打开文档type的类型不能为空");return}if("undefined"==typeof(b)||"undefined"==typeof(d)||"undefined"==typeof(c)||"undefined"==typeof(g)){var a=Ext.getCmp(view.namePrefix+view.index);b=view.getGridNum(a.id);k=view.viewBaseInfos[b];var j=a.getSelectionModel().getSelected();var f=1;if(e==3){if(undefined==j||j==null){Ext.MessageBox.alert("提示","请选择要打开的文档!");return}d=j.data[a.getColumnModel().getDataIndex(f)]}if(typeof d=="undefined"){d=""}c=k.formType;g=k.formId}else{k=view.viewBaseInfos[b]}var h=view.filterSql(view.purl);if(h==""){h=view.pcateUrl}else{if(h.substring(h.length-1)=="&"){h=h+view.pcateUrl}else{h=h+"&"+view.pcateUrl}}h=view.filterSql(h);this.openViewDoc(d,c,g,k.isFlowItem,h,k.openJs)},openViewDoc:function(g,f,l,m,p,c,n,d){if(typeof m=="undefined"){m=false}if(undefined!=c&&c!=""){var k=c.substring(0,c.indexOf("("));var e=c.indexOf("(")+1;var o=c.indexOf(")");var j=c.substring(e,o);if(j.trim()==""){j=""}else{j=","+j}var b;if(c.indexOf("OpenFlowDocByTodoUnid")>-1){b=k+"('"+g+"',ucapCommonFun.ucapOpenDoc,1"+j+")"}else{b=k+"('"+g+"','"+f+"','"+l+"',"+m+",'"+p+"',''"+j+")"}ucapCommonFun.evalJavaScript(b)}else{if(m){ucapOpenFlow.openOldFlowDoc("&unid="+g,ucapCommonFun.ucapOpenDoc,1)}else{var a=ucapSession.appPath+"sys/jsp/";a+="document.jsp?unid="+g+"&type="+f+"&formId="+l;if(undefined!=p&&p!=""){a+="&"+p}var h=(g==""?0:1);ucapCommonFun.ucapOpenDoc(a,h,"",n,d)}}},deleteDocument:function(){var b=Ext.getCmp(view.namePrefix+view.index);var c=b.getSelectionModel().getSelections();if(null==c.length||undefined==c.length){c=new Array(c)}var e="";for(var a=0;a<c.length;a++){var d=c[a];e+=","+d.data[b.getColumnModel().getDataIndex(1)]}if(e==""){Ext.MessageBox.alert("提示","请选择要删除的文档！");return}e=e.substring(1);Ext.MessageBox.confirm("确认","是否确认要删除选中的文档！",function(h){if(h=="yes"){var g={formUnid:view.viewBaseInfos[view.index].formId,formType:view.viewBaseInfos[view.index].formType,docUnid:e};var f={url:ucapSession.baseAction,params:{type:"getForm",act:"delete"},jsonData:g,callback:function(l,n,k){if(n){var m=Ext.util.JSON.decode(k.responseText);var j=ucapCommonFun.dealException(m);if(!j){return}Ext.Msg.alert("提示","删除文档成功！");view.refresh()}else{Ext.Msg.alert("提示","删除文档不成功！")}}};Ext.Ajax.request(f)}})},recycleDoc:function(c){var e="delete";var h="删除";if("undefined"!=typeof(c)&&c==1){e="restore";h="还原"}var b=Ext.getCmp(view.namePrefix+view.index);var d=b.getSelectionModel().getSelections();if(null==d.length||undefined==d.length){d=new Array(d)}var g="";for(var a=0;a<d.length;a++){var f=d[a];g+=","+f.data[b.getColumnModel().getDataIndex(1)]}if(g==""){Ext.MessageBox.alert("提示","请选择要"+h+"的文档！");return}g=g.substring(1);Ext.MessageBox.confirm("确认","是否确认要"+h+"选中的文档！",function(l){if(l=="yes"){var k={docUnid:g};var j={url:ucapSession.baseAction,params:{type:"recycle",action:e},jsonData:k,callback:function(o,q,n){if(q){var p=Ext.util.JSON.decode(n.responseText);var m=ucapCommonFun.dealException(p);if(!m){return}Ext.Msg.alert("提示",h+"文档成功！");view.refresh()}else{Ext.Msg.alert("提示",h+"文档不成功！")}}};Ext.Ajax.request(j)}})},filterSql:function(e){if(undefined==e||e==""||e=="null"||e==null){return""}var d=true;if(e.indexOf("funid=")>=0){d=false}var f=e.split("&");var c="";for(var b=0;b<f.length;b++){var a=f[b].substring(0,f[b].indexOf("="));if(a=="unid"||a=="type"||a=="formId"){continue}if(!d&&a=="instanceUnid"){continue}if(c==""){c=f[b]}else{c+="&"+f[b]}}return c},refresh:function(){try{var a=Ext.getCmp(view.namePrefix+view.index);if(a){a.getStore().removeAll();a.getBottomToolbar().updateInfo();a.getStore().reload()}else{}}catch(b){}},reset:function(){var c=Ext.getCmp(view.namePrefix+view.index);if(c){var d=Ext.getDom("keyword");d.value="";var f=Ext.getDom("searchMore_"+view.index);var e=f.getElementsByTagName("input");for(var b=0;b<e.length;b++){var a=e[b];if(a.type=="text"&&a.value!=""){a.value=""}}c.getStore().removeAll();c.getBottomToolbar().updateInfo();c.getStore().baseParams={extracon:"",categorycon:""};c.getStore().reload({params:{start:0,limit:view.viewBaseInfos[view.index].pageSize}})}},selfConfig:function(b,a){var c=view.viewBaseInfos[a].viewId;if(b=="01"){viewConfig.configViewInfo(c)}else{if(b=="02"){viewConfig.configViewColumns(c)}else{if(b=="03"){viewConfig.configSimpleQuery(c)}else{if(b=="04"){viewConfig.configAdvancedQuery(c)}else{if(b=="05"){viewConfig.configSortItem(c)}else{if(b=="06"){viewConfig.configCategoryItem(c)}else{if(b=="07"){viewConfig.configViewCondition(c)}else{if(b=="08"){viewConfig.configSubButton(c)}else{if(b=="10"){viewConfig.configRestoreDefault(c)}}}}}}}}}view.currentGridIndex=a},kdSearch:function(a){if(event.keyCode==13){view.search(a)}},search:function(g){var b="";var c=window.event.srcElement.parentElement;var j=Ext.getDom("simpleSearchSelect_"+g).options;var h=c.getElementsByTagName("input");var d=null;for(var e=0;e<h.length;e++){if(h[e].name=="keyword"){d=h[e];break}}for(var e=1;e<j.length;e++){var f=j[e];if(f.selected){b=view.fieldDbType+f.value+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+d.value+view.fieldEndPrefix;break}if(b==""){b=view.fieldDbType+f.value+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+d.value+view.fieldEndPrefix}else{b=b+view.sqlOr+view.fieldDbType+f.value+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+d.value+view.fieldEndPrefix}}var a=Ext.getCmp(view.namePrefix+g);view.reloadByCon(g,b,"01")},viewTest:function(a){return"原值："+a+";现值：*"+a},advancedSearch:function(f){var a="";var b=Ext.getDom("searchMore_"+f);var j=b.getElementsByTagName("input");for(var d=0;d<j.length;d++){var c=j[d];if(c.type=="text"&&c.value!=""){if(view.hasBeginInputName(c.name,f)){if(c.name.lastIndexOf("_1")>0){a=a+view.fieldDbType+c.name.substring(0,c.name.length-2)+view.fieldEndPrefix+view.sqlGTEQ+view.fieldConstType+c.value+view.fieldEndPrefix+view.sqlAnd}else{a=a+view.fieldDbType+c.name.substring(0,c.name.length-2)+view.fieldEndPrefix+view.sqlLTEQ+view.fieldConstType+c.value+view.fieldEndPrefix+view.sqlAnd}}else{if(c.name.lastIndexOf("_Cn_")>0){continue}var g=c.name;a=a+view.fieldDbType+g+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+c.value+view.fieldEndPrefix+view.sqlAnd}}}var e=b.getElementsByTagName("select");for(var d=0;d<e.length;d++){var h=e[d];a=a+view.fieldDbType+h.name+view.fieldEndPrefix+view.sqlGTEQ+view.fieldConstType+h.value+view.fieldEndPrefix+view.sqlAnd}if(a==""){Ext.MessageBox.alert("信息提示","请针对查询字段输入相应的查询值！");return}a=a.substring(0,a.length-view.sqlAnd.length);view.reloadByCon(f,a,"01")},hasInputByName:function(e,c){var a=false;for(var d=0;d<e.length;d++){var b=e[d];if(b.name==(c+"_Cn_")){a=true;break}}return a},reloadByCon:function(a,e,c,d){if("undefined"!=typeof(d)){view.pcateUrl=d}var b=Ext.getCmp(view.namePrefix+a);if(undefined!=c&&c=="01"){if(undefined!=typeof(b.getStore().baseParams.categorycon)){b.getStore().baseParams={extracon:e,categorycon:b.getStore().baseParams.categorycon}}else{b.getStore().baseParams={extracon:e}}}else{b.getStore().baseParams={categorycon:e}}b.getStore().removeAll();b.getBottomToolbar().updateInfo();b.getStore().reload({params:{start:0,limit:view.viewBaseInfos[a].pageSize}})},hasBeginInputName:function(c,b){var a=false;var e=view.viewBaseInfos[b].advancedJson;if(c.substr(c.length-2)=="_1"||c.substr(c.length-2)=="_2"){c=c.substr(0,c.length-2)}else{return a}if(undefined!=e){for(var d=0;d<e.length;d++){var f=e[d];if(f.itemNameEn==c&&f.hasBegin){return true}}}return a},loadItemsConfig:function(a){var c=null;var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"getFormItemEnCn",viewId:a},callback:function(f,g,e){if(g){c=Ext.util.JSON.encode(e.responseText);var d=ucapCommonFun.dealException(c);if(!d){return}return c}else{Ext.Msg.alert("提示","表单字段或数据库视图字段加载不成功！")}}};Ext.Ajax.request(b)},getViewDisplayName:function(e){var d=null;var b=ucapSession.baseAction;b+="?viewIds="+e+"&action=getViewName&type=getView&rand="+Math.random();var c=Ext.lib.Ajax.getConnectionObject().conn;c.open("GET",b,false);c.send(null);var f=Ext.util.JSON.encode(c.responseText);var a=ucapCommonFun.dealException(f);if(!a){return}return c.responseText},viewSaveValidator:function(a){return true}};var viewTabs={tabs:null,isInit:false,tabViewIds:null,closeabled:false,addTab:function(a,e,b){if(ucapSession.middleHeight==0){ucapCommonFun.autoMenuHeight()}var d=ucapSession.middleHeight;d=d-25;if(null==e||e==undefined){e="未知"}if(b!=0){this.closeabled=false}var c=viewTabs.tabs.add({id:a,title:e,tabTip:e,header:false,html:"<iframe name='ifr"+a+"' id='"+a+"' src='"+ucapSession.appPath+"sys/jsp/view.jsp?viewId="+a+"&isTab=1' style='width:100%;height:"+d+"px' marginwidth='1' frameborder='0' scrolling='no'></iframe>",closable:this.closeabled});viewTabs.tabs.on("remove",viewTabs.tabRemove);if(b==0){c.show();Ext.getDom("ifr"+a).src=ucapSession.appPath+"sys/jsp/view.jsp?viewId="+a+"&isTab=1"}},init:function(a){if(viewTabs.isInit){if(null!=viewTabs.tabViewIds&&viewTabs.tabViewIds.length>0){viewTabs.tabViewIds.splice(0,viewTabs.tabViewIds.length)}viewTabs.closeabled=true;return}else{viewTabs.closeabled=false}if(ucapSession.middleHeight==0){ucapCommonFun.autoMenuHeight()}var b=ucapSession.middleHeight;b=b-20;Ext.getDom(a).innerHTML="";viewTabs.tabs=new Ext.TabPanel({renderTo:a,activeTab:0,resizeTabs:true,minTabWidth:65,tabWidth:85,enableTabScroll:true,height:b,bodyBorder:false,frame:false,autoWidth:true,defaults:{autoScroll:false},plugins:new Ext.ux.TabCloseMenu()});viewTabs.isInit=true},removeTabId:function(a){if(undefined!=viewTabs.tabViewIds.length&&viewTabs.tabViewIds.length>0){for(var b=0;b<viewTabs.tabViewIds.length;b++){if(viewTabs.tabViewIds[b]==a){viewTabs.tabViewIds.splice(b,1);break}}}},tabRemove:function(a,b){viewTabs.removeTabId(b.id)}};Ext.ux.TabCloseMenu=function(){var a,c,b;this.init=function(e){a=e;a.on("contextmenu",d)};function d(h,g,j){if(!c){c=new Ext.menu.Menu([{id:a.id+"-close",text:"关闭页签",handler:function(){viewTabs.removeTabId(g.id);a.remove(b)}},{id:a.id+"-close-others",text:"关闭其它页签",handler:function(){a.items.each(function(e){if(e.closable&&e!=b){viewTabs.removeTabId(e.id);a.remove(e)}})}}])}b=g;var f=c.items;f.get(a.id+"-close").setDisabled(!g.closable);var k=true;a.items.each(function(){if(this!=g&&this.closable){k=false;return false}});f.get(a.id+"-close-others").setDisabled(k);c.showAt(j.getPoint())}};function initView(n,h,m,l,o,k,a,b,c){if(Ext.getDom(ucapSession.portalID)){Ext.getDom(ucapSession.portalID).innerHTML=""}if(Ext.getDom(ucapSession.portal_info)){Ext.getDom(ucapSession.portal_info).style.display="none"}if("undefined"==typeof(o)){view.purl=""}else{view.purl=o}if("undefined"!=typeof(k)){view.outOtherHeight=k}else{view.outOtherHeight=0}var g=n.split(",");var f=[];if(g.length>1){if(undefined==l||!l){if(undefined!=viewTabs.tabViewIds&&viewTabs.tabViewIds.length>0){viewTabs.tabViewIds.splice(0,viewTabs.tabViewIds.length)}viewTabs.isInit=false}var j=view.getViewDisplayName(n);f=j.split(",");l=true}if(undefined==l||!l){view.viewBaseInfos=new Array();view.viewId=n;view.renderto=h;Ext.QuickTips.init();view.initview(n,h,a,b,c);view.hasTab=false}else{for(var e=0;e<g.length;e++){var d=g[e];view.hasTab=true;if(undefined!=viewTabs.tabViewIds&&viewTabs.tabViewIds.length>0&&viewTabs.isInit){var l=false;viewTabs.tabs.items.each(function(p){if(p.id==d){viewTabs.tabs.activate(p.id);l=true}});if(l){return}}viewTabs.init(h);if(e<f.length){viewTabs.addTab(d,f[e],e)}else{viewTabs.addTab(d,m,e)}if(undefined==viewTabs.tabViewIds){viewTabs.tabViewIds=new Array()}viewTabs.tabViewIds[viewTabs.tabViewIds.length]=d;if(g.length>1){viewTabs.tabs.show(g[0])}}}}function initFormJspView(k,h,l,a,b,d,c,j,f,e,g,m){Ext.QuickTips.init();view.viewBaseInfos=new Array();view.renderto=h;view.viewId=k;view.hasTab=false;if("undefined"!=typeof(e)){view.isSingle=e}if("undefined"!=typeof(g)){view.recordSplit=g}if("undefined"!=typeof(m)){view.colSplit=m}if("undefined"!=typeof(c)){view.isTab=c}if("undefined"!=typeof(j)){view.noTbar=j}if("undefined"!=typeof(f)){view.noBbar=f}if(undefined==l){view.purl=""}else{view.purl=l}view.initview(k,h,a,b,d)}function initJspView(g,f,h,b,c,d){if("undefined"!=typeof(f)&&f!=""){var j=Ext.getDom(f);j.innerHTML='<iframe name="ifr'+g+'" id="'+g+"\" style='width:100%;height:300px;' scrolling='no' marginwidth='1' frameborder='0' src='false'></iframe>";var k=/&/g;h=h.replace(k,"~$*$~");var a=ucapSession.appPath+"sys/jsp/view.jsp?viewId="+g+"&purl="+h;if("undefined"!=typeof(b)){a+="&noQuery="+b}if("noPreview"!=typeof(c)){a+="&noPreview="+c}if("noSelfConfig"!=typeof(d)){a+="&noSelfConfig="+d}var e=1;if(window.parent&&window.parent._UcapForm){e=window.parent._UcapForm.cfg.isRead}if(typeof e=="undefined"||"undefined"==e||!e){e=_UcapForm.cfg.isRead}if(e!=1){e="&r=0"}else{e="&r=1"}Ext.getDom("ifr"+g).src=a+e}}Ext.override(Ext.grid.RowSelectionModel,{onEditorKey:function(l,h){var b=h.getKey(),c,d=this.grid,f=d.activeEditor;var a=h.shiftKey;var m=d.getColumnModel().getColumnCount(false);var j=d.getStore().getCount();if(b==h.ENTER){h.stopEvent();f.completeEdit();if(a){c=d.walkCells(f.row,f.col-1,-1,this.acceptsNav,this)}else{if(j==(f.row+1)&&m==(f.col+1)){view.addEditorGridRow()}else{c=d.walkCells(f.row,f.col+1,1,this.acceptsNav,this)}}}else{if(b==h.TAB){h.stopEvent();f.completeEdit();c=d.walkCells(f.row,f.col-1,-1,this.acceptsNav,this)}else{if(b==h.ESC){f.cancelEdit()}}}if(c){d.getSelectionModel().selectRow(c[0]);d.startEditing(c[0],c[1])}}});var viewTree={dataUrl:ucapSession.baseAction+"?type=getView&action=getCategory",viewId:"",index:0,rootJson:null,deptId:"",init:function(l,j,k,h){var b=viewTree.dataUrl+"&viewId="+l;var c=Ext.urlDecode(view.purl);delete c.type;b+="&"+Ext.urlEncode(c);viewTree.viewId=l;if("undefined"!=typeof(h)&&h=="04"){var e=ucapSession.baseAction;e+="?action=getDeptTree&type=treeSelect&unid=&rand="+Math.random();var d=Ext.lib.Ajax.getConnectionObject().conn;d.open("GET",e,false);d.send(null);var g=Ext.util.JSON.decode(d.responseText);var a=ucapCommonFun.dealException(g);if(!a){return}if("undefined"!=typeof(d.responseText)&&d.responseText!=""){viewTree.rootJson=Ext.util.JSON.decode(d.responseText)[0];deptId=this.rootJson.id;b+="&deptUnid="+deptId}else{viewTree.rootJson={id:l,text:"视图分类"}}}else{viewTree.rootJson={id:l,text:"视图分类"}}var f=new Ext.tree.TreePanel({id:"treePanel_"+l,border:false,lines:true,rootVisible:true,autoScroll:true,animate:true,autoHeight:true,autoWidth:true,renderTo:j,enableDD:false,containerScroll:true,loader:new Ext.tree.TreeLoader({dataUrl:b}),root:new Ext.tree.AsyncTreeNode({id:viewTree.rootJson.id,text:viewTree.rootJson.text,draggable:false,expanded:true}),listeners:{click:function(m){var o="";var n="";while(m.id!=viewTree.viewId){if("undefined"==typeof(m.attributes.name)||m.attributes.name==""){break}if(o.indexOf(m.attributes.name)>=0){m=m.parentNode;continue}if(o==""){o=view.fieldDbType+m.attributes.name+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+m.attributes.value+view.fieldEndPrefix;n=m.attributes.name+"="+m.attributes.value}else{o=view.fieldDbType+m.attributes.name+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+m.attributes.value+view.fieldEndPrefix+view.sqlAnd+o;n+="&"+m.attributes.name+"="+m.attributes.value}m=m.parentNode;if(null==m||"undefined"==typeof(m)){break}}view.reloadByCon(k,o,"00",n)},beforeload:function(m){}}});f.on("beforeload",function(o){if(!o.isLeaf()){var m=viewTree.dataUrl+"&viewId="+viewTree.viewId+"&itemName="+o.attributes.name;var n="";while(o.id!=viewTree.viewId){if(n.indexOf(o.attributes.name)>=0){o=o.parentNode;continue}if(n==""){n=view.fieldDbType+o.attributes.name+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+o.attributes.value+view.fieldEndPrefix}else{n=view.fieldDbType+o.attributes.name+view.fieldEndPrefix+view.sqlLikeKey+view.fieldConstType+o.attributes.value+view.fieldEndPrefix+view.sqlAnd+n}o=o.parentNode;if(null==o||"undefined"==typeof(o)){break}}m+="&conn="+n;f.loader.dataUrl=m}})}};var sortItem={sortItem:"",json:null};var viewConfig={hasViewColumnConfig:false,configViewInfo:function(a){var c="sys/cfgJsp/view/viewinfo.jsp?unid="+a;var b=[{text:"确定",handler:function(){viewConfigFun.viewInfoConfirm(a)}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"视图基本信息自定义",width:650,closable:true,modal:true,height:260,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configViewColumns:function(a){var c="sys/cfgJsp/view/viewcolumns.jsp?unid="+a+"&personalconfig=1";var b=[{text:"确定",handler:function(){viewConfigFun.viewColumnsConfigConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"视图列自定义",width:880,closable:true,modal:true,height:400,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configSimpleQuery:function(a){var c="sys/cfgJsp/view/querySimpleItem.jsp?unid="+a+"&personalconfig=1";var b=[{text:"确定",handler:function(){viewConfigFun.querySimpleItemConfigConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"简单查询自定义",width:480,closable:true,modal:true,height:440,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configAdvancedQuery:function(a){var c="sys/cfgJsp/view/queryAdvancedItem.jsp?unid="+a+"&personalconfig=1";var b=[{text:"确定",handler:function(){viewConfigFun.queryAdvancedItemConfigConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"高级查询自定义",width:480,closable:true,modal:true,height:440,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configSortItem:function(a){var c="sys/cfgJsp/view/sortItem.jsp?unid="+a+"&personalconfig=1";var b=[{text:"确定",handler:function(){viewConfigFun.sortItemConfigConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"视图排序自定义",width:480,closable:true,modal:true,height:420,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configCategoryItem:function(a){var c="sys/cfgJsp/view/categoryitem.jsp?unid="+a+"&personalconfig=1";var b=[{text:"确定",handler:function(){viewConfigFun.viewCategoriesConfigConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"视图分类自定义",width:880,closable:true,modal:true,height:420,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configViewCondition:function(a){var c="sys/cfgJsp/view/viewConditionCfg.jsp?unid="+a+"&personalconfig=1";var b=[{text:"确定",handler:function(){viewConfigFun.viewConditionConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"视图条件",width:880,closable:true,modal:true,height:420,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configSubButton:function(a){var c="sys/cfgJsp/subbutton/subbutton.jsp?unid="+a+"&personalconfig=1&btntype=03";var b=[{text:"确定",handler:function(){viewConfigFun.subButtonConfigConfirm(a,"1")}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"视图子按钮",width:880,closable:true,modal:true,height:400,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()},configRestoreDefault:function(a){var c="sys/cfgJsp/view/restoreDefault.jsp?unid="+a;var b=[{text:"确定",handler:function(){viewConfigFun.restoreDefaultConfirm(a)}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+"恢复默认",width:280,closable:true,modal:true,height:320,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});ucapSession.commonWin.show()}};var viewConfigFun={viewConfigItems:null,viewCofigColumns:null,viewConfigCategoriesItems:null,viewSortItems:null,viewQuerySimpleItems:null,viewQueryAdvancedItems:null,subButtonItems:null,itemConfigList:null,buttonConfigList:null,restoreDefaultConfirm:function(a){var c=ucapCommonFun.getFormJSon("rdDialogHtml");var d=c.restoreType;if(undefined==d||d==""){Ext.MessageBox.alert("提示","请选择要恢复默认的类型！");return}var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"restoreDefault",viewId:a,restoreType:d,tmp:ucapCommonFun.getRandomString()},callback:function(g,j,f){if(j){var h=Ext.util.JSON.decode(f.responseText);var e=ucapCommonFun.dealException(h);if(!e){return}viewConfigFun.viewConfigRefresh(a);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","恢复默认不成功！");ucapSession.commonWin.close()}}};Ext.Ajax.request(b)},viewConditionConfirm:function(a,c){viewConditionCfg.setCondition();var d={condition:viewConditionCfg.condition,conditionCn:viewConditionCfg.conditionCn};var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"saveViewCondition",viewId:a,tmp:ucapCommonFun.getRandomString()},jsonData:d,callback:function(g,j,f){if(j){var h=Ext.util.JSON.decode(f.responseText);var e=ucapCommonFun.dealException(h);if(!e){return}if(undefined!=c&&c=="1"){viewConfigFun.viewConfigRefresh(a);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","条件配置保存成功！")}}else{Ext.Msg.alert("提示","条件配置不成功！");if(undefined!=c&&c=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(b)},convertArray2Json:function(a,f){var e="";for(var d=0;d<f.length;d++){var c=f[d];if(undefined!=a&&a!=""&&a.length>0){for(var b=0;b<a.length;b++){if(c[a[b]]=="1"){c[a[b]]=true}else{c[a[b]]=false}}}if(e==""){e=Ext.util.JSON.encode(c)}else{e+=","+Ext.util.JSON.encode(c)}}e="{items:["+e+"]}";return Ext.util.JSON.decode(e)},viewConfigRefresh:function(a){var b=Ext.getDom(view.renderto);if(undefined==b||null==b){return}b.innerHTML="";view.refreshView(a,view.renderto,false)},viewInfoConfirm:function(a){var c=ucapCommonFun.getFormJSon("dialogHtml");if(c.turnPage=="1"){c.turnPage=true}else{c.turnPage=false}var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"saveViewInfo",viewId:a,tmp:ucapCommonFun.getRandomString()},jsonData:c,callback:function(f,h,e){if(h){var g=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(g);if(!d){return}viewConfigFun.viewConfigRefresh(a);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","视图基本信息自定义不成功！");ucapSession.commonWin.close()}}};Ext.Ajax.request(b)},loadItemsConfig:function(h,c){viewConfigFun.itemConfigList=new Array();var a=ucapSession.baseAction;a+="?viewId="+h+"&type=viewSelfConfig&action=getFormItemEnCn";a+="&tmp="+ucapCommonFun.getRandomString();var d=Ext.lib.Ajax.getConnectionObject().conn;d.open("GET",a,false);d.send(null);var j=Ext.util.JSON.decode(d.responseText);var b=ucapCommonFun.dealException(j);if(!b){return}var f=Ext.getDom(c);var g=j.items;if(undefined!=g){for(var e=0;e<g.length;e++){if(undefined==g[e]||null==g[e]){continue}viewConfigFun.itemConfigList[e]=g[e];ucapCommonFun.addOption(f,g[e].unid,g[e].nameCn)}}},viewColumnsConfigConfirm:function(b,d){var g=ucapCommonFun.getFormJSon("viDialogHtml");if(undefined!=g.itemUnid&&g.itemUnid!=""){for(var f=0;f<viewConfigFun.viewCofigColumns.length;f++){var e=viewConfigFun.viewCofigColumns[f];if(e.itemUnid==g.itemUnid){viewConfigFun.viewCofigColumns[f]=g;break}}}var a=["statistics","displayCn","display"];g=viewConfigFun.convertArray2Json(a,viewConfigFun.viewCofigColumns);var c={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"setViewColumn",viewId:b,tmp:ucapCommonFun.getRandomString()},jsonData:g,callback:function(k,m,j){if(m){var l=Ext.util.JSON.decode(j.responseText);var h=ucapCommonFun.dealException(l);if(!h){return}if(undefined!=d&&d=="1"){viewConfigFun.viewConfigRefresh(b);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","视图列配置保存成功！")}}else{Ext.Msg.alert("提示","视图排序保存不成功！");if(undefined!=d&&d=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(c)},loadViewItemsConfig:function(a,c){viewConfigFun.viewCofigColumns=new Array();var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"getViewColumns",viewId:a,tmp:ucapCommonFun.getRandomString()},callback:function(l,j,e){if(j){var k=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(k);if(!d){return}var h=Ext.getDom(c);var m=k.viewItems;if(undefined!=m&&m){for(var f=0;f<m.length;f++){if(undefined==m[f]||null==m[f]){continue}viewConfigFun.viewCofigColumns[f]=m[f];var g=ucapCommonFun.addOption(h,m[f].itemUnid,m[f].displayName)}}}else{Ext.Msg.alert("提示","表单字段或数据库视图字段加载不成功！")}}};Ext.Ajax.request(b)},addViewColumn:function(c,j){if("string"==typeof(c)){c=Ext.getDom(c)}if(c.selectedIndex<0){return}var e=c.options[c.selectedIndex];var b=Ext.getDom("viewColumnList");for(var d=0;d<b.options.length;d++){var a=b.options[d];if(a.value==e.value){return}}ucapCommonFun.addOption(b,e.value,e.text);var g=["itemUnid","displayName","width","widthType"];var h=[e.value,e.text,"100","01"];var f="{"+ucapCommonFun.getJsonValue(g,h)+"}";ucapCommonFun.bindForm(f);viewConfigFun.saveViewColumn(j)},delViewColumn:function(b,a){if("string"==typeof(b)){b=Ext.getDom(b)}if(b.selectedIndex<0){return}viewConfigFun.viewCofigColumns.splice(b.selectedIndex,1);b.remove(b.selectedIndex);Ext.getDom("itemUnid").value=""},changeViewColumn:function(b,j){var k=ucapCommonFun.getFormJSon("viDialogHtml");if(undefined!=k.itemUnid&&k.itemUnid!=""){for(var c=0;c<viewConfigFun.viewCofigColumns.length;c++){var l=viewConfigFun.viewCofigColumns[c];if(l.itemUnid==k.itemUnid){viewConfigFun.viewCofigColumns[c]=k;break}}}if(b.selectedIndex<0){return}for(var c=0;c<viewConfigFun.viewCofigColumns.length;c++){var k=viewConfigFun.viewCofigColumns[c];if(k.itemUnid==b.value){var g=["itemUnid","displayName","width","widthType","statistics","displayCn","onclick","conversion","display","messageType","message","converseInteraction","converseInteraction_Cn_","onfocus","onfocusout","onchange"];var d="0";if(undefined!=k.display&&(k.display==true||k.display=="1")){d="1"}var a="0";if(undefined!=k.statistics&&(k.statistics==true||k.statistics=="1")){a="1"}var f="0";if(undefined!=k.displayCn&&(k.displayCn==true||k.displayCn=="1")){f="1"}var h=[k.itemUnid,k.displayName,k.width,k.widthType,a,f,k.onclick,k.conversion,d,k.messageType,k.message,k.converseInteraction,k.converseInteraction_Cn_,k.onfocus,k.onfocusout,k.onchange];var e="{"+ucapCommonFun.getJsonValue(g,h)+"}";ucapCommonFun.bindForm(e);break}}},saveViewColumn:function(a){var b=ucapCommonFun.getFormJSon("viDialogHtml");if(b.itemUnid==""){return}viewConfigFun.viewCofigColumns[viewConfigFun.viewCofigColumns.length]=b},moveViewColumn:function(b,d){var e=Ext.getDom("viewColumnList").selectedIndex;var a=ucapCommonFun.moveOption(Ext.getDom("viewColumnList"),d);if(a){var c=viewConfigFun.viewCofigColumns[e+d];viewConfigFun.viewCofigColumns[e+d]=viewConfigFun.viewCofigColumns[e];viewConfigFun.viewCofigColumns[e]=c}},viewCategoriesConfigConfirm:function(a,c){var f=ucapCommonFun.getFormJSon("ciDialogHtml");if(undefined!=f.itemUnid&&f.itemUnid!=""){for(var e=0;e<viewConfigFun.viewConfigCategoriesItems.length;e++){var d=viewConfigFun.viewConfigCategoriesItems[e];if(d.itemUnid==f.itemUnid){viewConfigFun.viewConfigCategoriesItems[e]=f;break}}}f=viewConfigFun.convertArray2Json("",viewConfigFun.viewConfigCategoriesItems);var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"setCategoryItem",viewId:a},jsonData:f,callback:function(j,l,h){if(l){var k=Ext.util.JSON.decode(h.responseText);var g=ucapCommonFun.dealException(k);if(!g){return}if(undefined!=c&&c=="1"){viewConfigFun.viewConfigRefresh(a);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","视图分类保存成功！")}}else{Ext.Msg.alert("提示","视图分类保存不成功！");if(undefined!=c&&c=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(b)},loadCategoryItemsConfig:function(a,c){viewConfigFun.viewConfigCategoriesItems=new Array();var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"getCategoryItems",viewId:a},callback:function(l,j,e){if(j){var k=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(k);if(!d){return}var h=Ext.getDom(c);var m=k.categoryItems;if(undefined!=m&&m){for(var f=0;f<m.length;f++){if(undefined==m[f]||null==m[f]){continue}viewConfigFun.viewConfigCategoriesItems[f]=m[f];var g=ucapCommonFun.addOption(h,m[f].itemUnid,m[f].itemCn)}}}else{Ext.Msg.alert("提示","表单字段或数据库视图字段加载不成功！")}}};Ext.Ajax.request(b)},addCategoryItem:function(c,j){if("string"==typeof(c)){c=Ext.getDom(c)}if(c.selectedIndex<0){return}var e=c.options[c.selectedIndex];var b=Ext.getDom("categoryItemList");for(var d=0;d<b.options.length;d++){var a=b.options[d];if(a.value==e.value){return}}ucapCommonFun.addOption(b,e.value,e.text);var g=["itemUnid","itemCn","itemType","itemValue"];var h=[e.value,e.text,"01",""];var f="{"+ucapCommonFun.getJsonValue(g,h)+"}";ucapCommonFun.bindForm(f);viewConfigFun.saveCategoryItem(j)},delCategoryItem:function(b,a){if("string"==typeof(b)){b=Ext.getDom(b)}if(b.selectedIndex<0){return}viewConfigFun.viewConfigCategoriesItems.splice(b.selectedIndex,1);b.remove(b.selectedIndex);Ext.getDom("itemUnid").value=""},changeCategoryItem:function(h,a){var e=ucapCommonFun.getFormJSon("ciDialogHtml");if(undefined!=e.itemUnid&&e.itemUnid!=""){for(var d=0;d<viewConfigFun.viewConfigCategoriesItems.length;d++){var b=viewConfigFun.viewConfigCategoriesItems[d];if(b.itemUnid==e.itemUnid){viewConfigFun.viewConfigCategoriesItems[d]=e;break}}}if(h.selectedIndex<0){return}for(var d=0;d<viewConfigFun.viewConfigCategoriesItems.length;d++){var e=viewConfigFun.viewConfigCategoriesItems[d];if(e.itemUnid==h.value){var g=["itemUnid","itemCn","itemType","itemValue","beginIndex","endIndex"];var f=[e.itemUnid,e.itemCn,e.itemType,e.itemValue,e.beginIndex,e.endIndex];var c="{"+ucapCommonFun.getJsonValue(g,f)+"}";ucapCommonFun.bindForm(c);break}}},saveCategoryItem:function(a){var b=ucapCommonFun.getFormJSon("ciDialogHtml");if(b.itemUnid==""){return}viewConfigFun.viewConfigCategoriesItems[viewConfigFun.viewConfigCategoriesItems.length]=b},moveCategoryItem:function(b,d){var e=Ext.getDom("categoryItemList").selectedIndex;var a=ucapCommonFun.moveOption(Ext.getDom("categoryItemList"),d);if(a){var c=viewConfigFun.viewConfigCategoriesItems[e+d];viewConfigFun.viewConfigCategoriesItems[e+d]=viewConfigFun.viewConfigCategoriesItems[e];viewConfigFun.viewConfigCategoriesItems[e]=c}},loadSortItemsConfig:function(a,c){viewConfigFun.viewSortItems=new Array();var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"getSortItems",viewId:a},callback:function(m,k,e){if(k){var l=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(l);if(!d){return}var h=Ext.getDom(c);var j=l.sortItems;if(undefined!=j){for(var f=0;f<j.length;f++){if(undefined==j[f]||null==j[f]){continue}viewConfigFun.viewSortItems[f]=j[f];var g=ucapCommonFun.addOption(h,j[f].sortItem,viewConfigFun.getItemNameCn(j[f].sortItem))}}}else{Ext.Msg.alert("提示","表单字段或数据库视图字段加载不成功！")}}};Ext.Ajax.request(b)},addSortItem:function(c,j){if("string"==typeof(c)){c=Ext.getDom(c)}if(c.selectedIndex<0){return}var e=c.options[c.selectedIndex];var b=Ext.getDom("sortItemList");for(var d=0;d<b.options.length;d++){var a=b.options[d];if(a.value==e.value){return}}ucapCommonFun.addOption(b,e.value,e.text);var g=["sortItem","sortType"];var h=[e.value,"01"];var f="{"+ucapCommonFun.getJsonValue(g,h)+"}";ucapCommonFun.bindForm(f);viewConfigFun.saveSortItem(j)},saveSortItem:function(a){var b=ucapCommonFun.getFormJSon("siDialogHtml");if(b.sortItem==""){return}viewConfigFun.viewSortItems[viewConfigFun.viewSortItems.length]=b},delSortItem:function(b,a){if("string"==typeof(b)){b=Ext.getDom(b)}if(b.selectedIndex<0){return}viewConfigFun.viewSortItems.splice(b.selectedIndex,1);b.remove(b.selectedIndex)},changeSortItem:function(h,a){var e=ucapCommonFun.getFormJSon("siDialogHtml");if(undefined!=e.sortItem&&e.sortItem!=""){for(var d=0;d<viewConfigFun.viewSortItems.length;d++){var b=viewConfigFun.viewSortItems[d];if(b.sortItem==e.sortItem){viewConfigFun.viewSortItems[d]=e;break}}}if(h.selectedIndex<0){return}for(var d=0;d<viewConfigFun.viewSortItems.length;d++){e=viewConfigFun.viewSortItems[d];if(e.sortItem==h.value){var g=["sortItem","sortType"];var f=[e.sortItem,e.sortType];var c="{"+ucapCommonFun.getJsonValue(g,f)+"}";ucapCommonFun.bindForm(c);break}}},moveSortItem:function(b,d){var e=Ext.getDom("sortItemList").selectedIndex;var a=ucapCommonFun.moveOption(Ext.getDom("sortItemList"),d);if(a){var c=viewConfigFun.viewSortItems[e+d];viewConfigFun.viewSortItems[e+d]=viewConfigFun.viewSortItems[e];viewConfigFun.viewSortItems[e]=c}},sortItemConfigConfirm:function(a,c){var f=ucapCommonFun.getFormJSon("siDialogHtml");if(undefined!=f.sortItem&&f.sortItem!=""){for(var e=0;e<viewConfigFun.viewSortItems.length;e++){var d=viewConfigFun.viewSortItems[e];if(d.sortItem==f.sortItem){viewConfigFun.viewSortItems[e]=f;break}}}f=viewConfigFun.convertArray2Json("",viewConfigFun.viewSortItems);var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"setSortItem",viewId:a},jsonData:f,callback:function(j,l,h){if(l){var k=Ext.util.JSON.decode(h.responseText);var g=ucapCommonFun.dealException(k);if(!g){return}if(undefined!=c&&c=="1"){viewConfigFun.viewConfigRefresh(a);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","视图排序保存成功！")}}else{Ext.Msg.alert("提示","视图排序保存不成功！");if(undefined!=c&&c=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(b)},loadQuerySimpleItemsConfig:function(a,c){viewConfigFun.viewQuerySimpleItems=new Array();var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"getSimpleQueryItems",viewId:a},callback:function(m,k,e){if(k){var l=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(l);if(!d){return}var j=Ext.getDom(c);var g=l.items;if(undefined!=g&&g){for(var f=0;f<g.length;f++){if(undefined==g[f]||null==g[f]){continue}viewConfigFun.viewQuerySimpleItems[f]=g[f];var h=ucapCommonFun.addOption(j,g[f].itemUnid,viewConfigFun.getItemNameCn(g[f].itemUnid))}}}else{Ext.Msg.alert("提示","视图简单查询列加载不成功！")}}};Ext.Ajax.request(b)},addQuerySimpleItem:function(b,j){if("string"==typeof(b)){b=Ext.getDom(b)}if(b.selectedIndex<0){return}var e=b.options[b.selectedIndex];var d=Ext.getDom("querySimpleItemList");for(var c=0;c<d.options.length;c++){var a=d.options[c];if(a.value==e.value){return}}ucapCommonFun.addOption(d,e.value,e.text);var g=["itemUnid","itemNameCn"];var h=[e.value,e.text];var f="{"+ucapCommonFun.getJsonValue(g,h)+"}";ucapCommonFun.bindForm(f);viewConfigFun.saveQuerySimpleItem(j)},saveQuerySimpleItem:function(a){var b=ucapCommonFun.getFormJSon("qsDialogHtml");if(b.sortItem==""){return}viewConfigFun.viewQuerySimpleItems[viewConfigFun.viewQuerySimpleItems.length]=b},delQuerySimpleItem:function(b,a){if("string"==typeof(b)){b=Ext.getDom(b)}if(b.selectedIndex<0){return}viewConfigFun.viewQuerySimpleItems.splice(b.selectedIndex,1);b.remove(b.selectedIndex)},changeQuerySimpleItem:function(h,a){var e=ucapCommonFun.getFormJSon("qsDialogHtml");if(undefined!=e.itemUnid&&e.itemUnid!=""){for(var d=0;d<viewConfigFun.viewQuerySimpleItems.length;d++){var b=viewConfigFun.viewQuerySimpleItems[d];if(b.itemUnid==e.itemUnid){viewConfigFun.viewQuerySimpleItems[d]=e;break}}}if(h.selectedIndex<0){return}for(var d=0;d<viewConfigFun.viewQuerySimpleItems.length;d++){e=viewConfigFun.viewQuerySimpleItems[d];if(e.itemUnid==h.value){var g=["itemUnid","itemNameCn"];var f=[e.itemUnid,e.itemNameCn];var c="{"+ucapCommonFun.getJsonValue(g,f)+"}";ucapCommonFun.bindForm(c);break}}},moveQuerySimpleItem:function(b,d){var e=Ext.getDom("querySimpleItemList").selectedIndex;var a=ucapCommonFun.moveOption(Ext.getDom("querySimpleItemList"),d);if(a){var c=viewConfigFun.viewQuerySimpleItems[e+d];viewConfigFun.viewQuerySimpleItems[e+d]=viewConfigFun.viewQuerySimpleItems[e];viewConfigFun.viewQuerySimpleItems[e]=c}},querySimpleItemConfigConfirm:function(a,c){var f=ucapCommonFun.getFormJSon("qsDialogHtml");if(undefined!=f.itemUnid&&f.itemUnid!=""){for(var e=0;e<viewConfigFun.viewQuerySimpleItems.length;e++){var d=viewConfigFun.viewQuerySimpleItems[e];if(d.itemUnid==f.itemUnid){viewConfigFun.viewQuerySimpleItems[e]=f;break}}}f=viewConfigFun.convertArray2Json("",viewConfigFun.viewQuerySimpleItems);var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"setSimpleQueryItem",viewId:a},jsonData:f,callback:function(j,l,h){if(l){var k=Ext.util.JSON.decode(h.responseText);var g=ucapCommonFun.dealException(k);if(!g){return}if(undefined!=c&&c=="1"){viewConfigFun.viewConfigRefresh(a);ucapSession.commonWin.close()}else{Ext.MessageBox.alert("提示","视图简单查询自定义成功！")}}else{Ext.MessageBox.alert("提示","视图简单查询自定义不成功！");if(undefined!=c&&c=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(b)},loadQueryAdvancedItemsConfig:function(a,c){viewConfigFun.viewQueryAdvancedItems=new Array();var b={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"getAdvancedQueryItems",viewId:a},callback:function(m,k,e){if(k){var l=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(l);if(!d){return}var h=Ext.getDom(c);var j=l.items;if(undefined!=j&&j){for(var f=0;f<j.length;f++){if(undefined==j[f]||null==j[f]){continue}viewConfigFun.viewQueryAdvancedItems[f]=j[f];var g=ucapCommonFun.addOption(h,j[f].itemUnid,viewConfigFun.getItemNameCn(j[f].itemUnid))}}}else{Ext.Msg.alert("提示","视图高级查询列加载不成功！")}}};Ext.Ajax.request(b)},addQueryAdvancedItem:function(c,j){if("string"==typeof(c)){c=Ext.getDom(c)}if(c.selectedIndex<0){return}var e=c.options[c.selectedIndex];var b=Ext.getDom("queryAdvancedItemList");for(var d=0;d<b.options.length;d++){var a=b.options[d];if(a.value==e.value){return}}ucapCommonFun.addOption(b,e.value,e.text);var g=["itemUnid","itemNameCn","hasBegin"];var h=[e.value,e.text,"1"];var f="{"+ucapCommonFun.getJsonValue(g,h)+"}";ucapCommonFun.bindForm(f);viewConfigFun.saveQueryAdvancedItem(j)},saveQueryAdvancedItem:function(a){var b=ucapCommonFun.getFormJSon("qaDialogHtml");if(b.sortItem==""){return}viewConfigFun.viewQueryAdvancedItems[viewConfigFun.viewQueryAdvancedItems.length]=b},delQueryAdvancedItem:function(b,a){if("string"==typeof(b)){b=Ext.getDom(b)}if(b.selectedIndex<0){return}viewConfigFun.viewQueryAdvancedItems.splice(b.selectedIndex,1);b.remove(b.selectedIndex)},changeQueryAdvancedItem:function(b,g){var h=ucapCommonFun.getFormJSon("qaDialogHtml");if(undefined!=h.itemUnid&&h.itemUnid!=""){for(var c=0;c<viewConfigFun.viewQueryAdvancedItems.length;c++){var j=viewConfigFun.viewQueryAdvancedItems[c];if(j.itemUnid==h.itemUnid){viewConfigFun.viewQueryAdvancedItems[c]=h;break}}}if(b.selectedIndex<0){return}for(var c=0;c<viewConfigFun.viewQueryAdvancedItems.length;c++){h=viewConfigFun.viewQueryAdvancedItems[c];if(h.itemUnid==b.value){var e=["itemUnid","itemNameCn","hasBegin"];var a="0";if(undefined!=h.hasBegin&&(h.hasBegin==true||h.hasBegin=="1")){a="1"}var f=[h.itemUnid,h.itemNameCn,a];var d="{"+ucapCommonFun.getJsonValue(e,f)+"}";ucapCommonFun.bindForm(d);break}}},moveQueryAdvancedItem:function(b,d){var e=Ext.getDom("queryAdvancedItemList").selectedIndex;var a=ucapCommonFun.moveOption(Ext.getDom("queryAdvancedItemList"),d);if(a){var c=viewConfigFun.viewQueryAdvancedItems[e+d];viewConfigFun.viewQueryAdvancedItems[e+d]=viewConfigFun.viewQueryAdvancedItems[e];viewConfigFun.viewQueryAdvancedItems[e]=c}},queryAdvancedItemConfigConfirm:function(b,d){var g=ucapCommonFun.getFormJSon("qaDialogHtml");if(undefined!=g.itemUnid&&g.itemUnid!=""){for(var f=0;f<viewConfigFun.viewQueryAdvancedItems.length;f++){var e=viewConfigFun.viewQueryAdvancedItems[f];if(e.itemUnid==g.itemUnid){e=g}}}var a=["hasBegin"];g=viewConfigFun.convertArray2Json(a,viewConfigFun.viewQueryAdvancedItems);var c={url:ucapSession.baseAction,params:{type:"viewSelfConfig",action:"setAdvancedQueryItem",viewId:b},jsonData:g,callback:function(k,m,j){if(m){var l=Ext.util.JSON.decode(j.responseText);var h=ucapCommonFun.dealException(l);if(!h){return}if(undefined!=d&&d=="1"){viewConfigFun.viewConfigRefresh(b);ucapSession.commonWin.close()}else{Ext.MessageBox.alert("提示","视图高级查询自定义成功！")}}else{Ext.MessageBox.alert("提示","视图高级查询自定义不成功！");if(undefined!=d&&d=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(c)},getItemNameCn:function(b){var d="";for(var a=0;a<viewConfigFun.itemConfigList.length;a++){var c=viewConfigFun.itemConfigList[a];if(c.unid==b){d=c.nameCn;break}}return d},loadButtonsConfig:function(j,c){viewConfigFun.buttonConfigList=new Array();var a=ucapSession.baseAction;a+="?btntype="+j+"&type=subButton&action=getButtons";a+="&"+ucapCommonFun.getRandomString();var d=Ext.lib.Ajax.getConnectionObject().conn;d.open("GET",a,false);d.send(null);var h=Ext.util.JSON.decode(d.responseText);var b=ucapCommonFun.dealException(h);if(!b){return}var f=Ext.getDom(c);var g=h.items;if(undefined!=g){for(var e=0;e<g.length;e++){if(undefined==g[e]||null==g[e]){continue}viewConfigFun.buttonConfigList[e]=g[e];ucapCommonFun.addOption(f,g[e].unid,g[e].name)}}},subButtonConfigConfirm:function(g,c){var f=ucapCommonFun.getFormJSon("sbDialogHtml");if(undefined!=f.buttonUnid&&f.buttonUnid!=""){for(var e=0;e<viewConfigFun.subButtonItems.length;e++){var d=viewConfigFun.subButtonItems[e];if(d.buttonUnid==f.buttonUnid){viewConfigFun.subButtonItems[e]=f;break}}}var a=["display"];f=viewConfigFun.convertArray2Json(a,viewConfigFun.subButtonItems);var b={url:ucapSession.baseAction,params:{type:"subButton",action:"saveSubButtons",belongto:g,tmp:ucapCommonFun.getRandomString()},jsonData:f,callback:function(k,m,j){if(m){var l=Ext.util.JSON.decode(j.responseText);var h=ucapCommonFun.dealException(l);if(!h){return}if(undefined!=c&&c=="1"){viewConfigFun.viewConfigRefresh(g);ucapSession.commonWin.close()}else{Ext.Msg.alert("提示","子按钮配置成功！")}}else{Ext.Msg.alert("提示","子按钮配置不成功！");if(undefined!=c&&c=="1"){ucapSession.commonWin.close()}}}};Ext.Ajax.request(b)},loadSubButtonsConfig:function(c,b){viewConfigFun.subButtonItems=new Array();var a={url:ucapSession.baseAction,params:{type:"subButton",action:"getSubButtons",belongto:c},callback:function(m,j,e){if(j){var k=Ext.util.JSON.decode(e.responseText);var d=ucapCommonFun.dealException(k);if(!d){return}var h=Ext.getDom(b);var l=k.items;if(undefined!=l&&l){for(var f=0;f<l.length;f++){if(undefined==l[f]||null==l[f]){continue}viewConfigFun.subButtonItems[f]=l[f];var g=ucapCommonFun.addOption(h,l[f].buttonUnid,l[f].name)}}}else{Ext.Msg.alert("提示","子按钮列表加载不成功！")}}};Ext.Ajax.request(a)},addSubButton:function(h){if("string"==typeof(h)){h=Ext.getDom(h)}if(h.selectedIndex<0){return}var d=h.options[h.selectedIndex];var g=Ext.getDom("subbuttonList");for(var b=0;b<g.options.length;b++){var c=g.options[b];if(c.value==d.value){return}}ucapCommonFun.addOption(g,d.value,d.text);var f=["buttonName","buttonUnid","name","display"];var e=[d.text,d.value,d.text,"1"];var a="{"+ucapCommonFun.getJsonValue(f,e)+"}";ucapCommonFun.bindForm(a);viewConfigFun.saveSubButton()},delSubButton:function(a){if("string"==typeof(a)){a=Ext.getDom(a)}if(a.selectedIndex<0){return}viewConfigFun.subButtonItems.splice(a.selectedIndex,1);a.remove(a.selectedIndex);Ext.getDom("buttonUnid").value=""},changeSubButton:function(h){var d=ucapCommonFun.getFormJSon("sbDialogHtml");if(undefined!=d.buttonUnid&&d.buttonUnid!=""){for(var c=0;c<viewConfigFun.subButtonItems.length;c++){var a=viewConfigFun.subButtonItems[c];if(a.buttonUnid==d.buttonUnid){viewConfigFun.subButtonItems[c]=d;break}}}if(h.selectedIndex<0){return}for(var c=0;c<viewConfigFun.subButtonItems.length;c++){var d=viewConfigFun.subButtonItems[c];if(d.buttonUnid==h.value){var g=["buttonName","buttonUnid","name","display","picture","useScopes","unuseScopes","interaction","js","altKey","menu","tip"];var f="0";if(undefined!=d.display&&(d.display==true||d.display=="1")){f="1"}var e=[d.buttonName,d.buttonUnid,d.name,f,d.picture,d.useScopes,d.unuseScopes,d.interaction,d.js,d.altKey,d.menu,d.tip];var b="{"+ucapCommonFun.getJsonValue(g,e)+"}";ucapCommonFun.bindForm(b);break}}$("useScopes_Cn_").value=ucapCommonFun.getDisplayNames("200,201,202,203",$("useScopes").value,"20");$("unuseScopes_Cn_").value=ucapCommonFun.getDisplayNames("200,201,202,203",$("unuseScopes").value,"20");$("interaction_Cn_").value=ucapCommonFun.getDisplayNames("227",$("interaction").value,"20")},saveSubButton:function(){var a=ucapCommonFun.getFormJSon("sbDialogHtml");if(undefined==a.buttonUnid||a.buttonUnid==""){return}viewConfigFun.subButtonItems[viewConfigFun.subButtonItems.length]=a},moveSubButton:function(c){var d=Ext.getDom("subbuttonList").selectedIndex;var a=ucapCommonFun.moveOption(Ext.getDom("subbuttonList"),c);if(a){var b=viewConfigFun.subButtonItems[d+c];viewConfigFun.subButtonItems[d+c]=viewConfigFun.subButtonItems[d];viewConfigFun.subButtonItems[d]=b}}};var viewConditionCfg={compareCfgs:["~!@0~!@0","~!@0~!@1","~!@0~!@2","~!@0~!@3","~!@0~!@4","~!@0~!@5","~!@0~!@6","~!@0~!@7","~!@0~!@8","~!@0~!@9","~!@0~!@A","~!@0~!@B"],compareSqls:[" = "," >= "," <= "," > "," < "," LIKE "," LIKE "," LIKE "," NOT LIKE "," IS NULL "," IS NOT NULL "," != "],dbItems:null,flowItems:null,sysParamsItems:null,cfgType:"1",condition:"",conditionCn:"",optionSplit:"~@$<br/>$@~",fieldEndPrefix:"~!@E@!~",init:function(c){viewConditionCfg.getViewCondition(c);var f=Ext.getDom("manualCfg");var h=Ext.getDom("sysCfg");if(viewConditionCfg.conditionCn==""&&viewConditionCfg.condition!=""){viewConditionCfg.cfgType=0;viewConditionCfg.checkRadio("0");f.style.display="";h.style.display="none";var b=Ext.getDom("contextarea");b.innerText=viewConditionCfg.condition}else{viewConditionCfg.cfgType=1;viewConditionCfg.checkRadio("1");f.style.display="none";h.style.display="";var d=viewConditionCfg.condition.split(viewConditionCfg.optionSplit);var g=viewConditionCfg.conditionCn.split(viewConditionCfg.optionSplit);var a=Ext.getDom("resultsSel_CN");for(var e=0;e<d.length;e++){ucapCommonFun.addOption(a,d[e],g[e])}viewConditionCfg.initSel(c,"~!@DB@!~","leftSel_CN");viewConditionCfg.initSel(c,"~!@DB@!~","rightSel_CN")}},checkRadio:function(b){var c=document.getElementsByName("cfgType");for(var a=0;a<c.length;a++){if(c[a].value==b){c[a].checked=true}}},getDbItems:function(a,g){if(undefined!=viewConditionCfg.dbItems&&null!=viewConditionCfg.dbItems&&!g){return}viewConditionCfg.dbItems=new Array();var d=ucapSession.baseAction;d+="?viewId="+a+"&type=viewSelfConfig&action=getFormItemEnCn";var h=Ext.lib.Ajax.getConnectionObject().conn;h.open("GET",d,false);h.send(null);var f=Ext.util.JSON.decode(h.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}var b=f.items;if(undefined!=b){for(var e=0;e<b.length;e++){if(undefined==b[e]||null==b[e]){continue}viewConditionCfg.dbItems[e]=b[e]}}},getFlowItems:function(){if(undefined!=viewConditionCfg.flowItems&&null!=viewConditionCfg.flowItems){return}viewConditionCfg.flowItems=new Array();var c=ucapSession.baseAction;c+="?type=viewSelfConfig&action=getFlowItems";var f=Ext.lib.Ajax.getConnectionObject().conn;f.open("GET",c,false);f.send(null);var e=Ext.util.JSON.decode(f.responseText);var b=ucapCommonFun.dealException(e);if(!b){return}var a=e.items;if(undefined!=a){for(var d=0;d<a.length;d++){if(undefined==a[d]||null==a[d]){continue}viewConditionCfg.flowItems[d]=a[d]}}},getSysParams:function(){if(undefined!=viewConditionCfg.sysParamsItems&&null!=viewConditionCfg.sysParamsItems){return}viewConditionCfg.sysParamsItems=new Array();var c=ucapSession.baseAction;c+="?type=viewSelfConfig&action=getSysParams";var f=Ext.lib.Ajax.getConnectionObject().conn;f.open("GET",c,false);f.send(null);var e=Ext.util.JSON.decode(f.responseText);var b=ucapCommonFun.dealException(e);if(!b){return}var a=e.items;if(undefined!=a){for(var d=0;d<a.length;d++){if(undefined==a[d]||null==a[d]){continue}viewConditionCfg.sysParamsItems[d]=a[d]}}},getViewCondition:function(a){var c=ucapSession.baseAction;c+="?viewId="+a+"&type=viewSelfConfig&action=getViewCondition&rand="+Math.random();var e=Ext.lib.Ajax.getConnectionObject().conn;e.open("GET",c,false);e.send(null);var d=Ext.util.JSON.decode(e.responseText);var b=ucapCommonFun.dealException(d);if(!b){return}viewConditionCfg.condition=d.condition;viewConditionCfg.conditionCn=d.conditionCn},initSel:function(a,g,e){var b=null;if(typeof(e)=="string"){e=Ext.getDom(e)}var h=e.options.length;for(var d=0;d<h;d++){e.options.remove(0)}e.style.display="";var f=/Sel/g;var c=Ext.getDom(e.id.replace(f,"Input"));c.style.display="none";if(g=="~!@DB@!~"||g=="~!@FW@!~"){if(g=="~!@DB@!~"){viewConditionCfg.getDbItems(a,false);b=viewConditionCfg.dbItems}else{b=viewConditionCfg.getFlowItems();b=viewConditionCfg.flowItems}for(var d=0;d<b.length;d++){ucapCommonFun.addOption(e,b[d].nameEn,b[d].nameCn)}}else{if(g=="~!@XY@!~"){viewConditionCfg.getSysParams();b=viewConditionCfg.sysParamsItems;for(var d=0;d<b.length;d++){ucapCommonFun.addOption(e,b[d].unid,b[d].name)}}else{e.style.display="none";c.style.display=""}}},setCondition:function(){viewConditionCfg.condition="";viewConditionCfg.conditionCn="";if(viewConditionCfg.cfgType=="0"){viewConditionCfg.condition=Ext.getDom("contextarea").innerText}else{var b=Ext.getDom("resultsSel_CN");for(var a=0;a<b.options.length;a++){var c=b.options[a];if(viewConditionCfg.condition==""){viewConditionCfg.condition=c.value;viewConditionCfg.conditionCn=c.innerText}else{viewConditionCfg.condition+=viewConditionCfg.optionSplit+c.value;viewConditionCfg.conditionCn+=viewConditionCfg.optionSplit+c.innerText}}}},cfgTypeChange:function(d){var b="";if(d.checked){b=d.value}var c=Ext.getDom("manualCfg");var a=Ext.getDom("sysCfg");if(b=="0"){c.style.display="";a.style.display="none";viewConditionCfg.changeConToManual();Ext.getDom("contextarea").innerText=viewConditionCfg.condition.replace(viewConditionCfg.optionSplit,"")}else{c.style.display="none";a.style.display=""}viewConditionCfg.cfgType=b},changeConToManual:function(){viewConditionCfg.setCondition();for(var a=0;a<viewConditionCfg.compareCfgs.length;a++){viewConditionCfg.condition=viewConditionCfg.condition.replace(viewConditionCfg.compareCfgs[a],viewConditionCfg.compareSqls[a])}},addCon:function(k){var l=Ext.getDom("leftseloptions_CN");var d=Ext.getDom("leftSel_CN");var b=Ext.getDom("leftInput_CN");var h=Ext.getDom("compareTypeSel_CN");var m=Ext.getDom("rightseloptions_CN");var f=Ext.getDom("rightSel_CN");var e=Ext.getDom("rightInput_CN");var c=Ext.getDom("andOrSel_CN");var a="";if(l.selectedIndex<0){Ext.MessageBox.alert("提示","请选择字段类型");return}if(l.value!="~!@DZ@!~"&&l.value!="~!@CL@!~"){if(d.selectedIndex<0){Ext.MessageBox.alert("提示","请选择相应的字段");return}}else{if(b.value==""){Ext.MessageBox.alert("提示","请输入相应的字段值");return}}if(h.selectedIndex<0){Ext.MessageBox.alert("提示","请选择比较方式");return}if(h.value!="~!@0~!@9"&&h.value!="~!@0~!@A"){if(m.selectedIndex<0){Ext.MessageBox.alert("提示","请选择条件值类型");return}if(m.value!="~!@DZ@!~"&&m.value!="~!@CL@!~"){if(f.selectedIndex<0){Ext.MessageBox.alert("提示","请选择条件值");return}}if(l.value!="~!@DZ@!~"&&l.value!="~!@CL@!~"){a=l.value+d.value+viewConditionCfg.fieldEndPrefix;conCn=d.options[d.selectedIndex].innerText}else{a=l.value+b.value+viewConditionCfg.fieldEndPrefix;conCn=b.value}a=a+h.value+m.value;conCn=conCn+" "+h.options[h.selectedIndex].innerText+" ";if(m.value!="~!@DZ@!~"&&m.value!="~!@CL@!~"){a+=f.value+viewConditionCfg.fieldEndPrefix;conCn+=f.options[f.selectedIndex].innerText}else{a+=e.value+viewConditionCfg.fieldEndPrefix;conCn+=e.value}a+=c.value;if(c.value!=""){conCn+=" "+c.options[c.selectedIndex].innerText}}else{a=l.value+d.value+viewConditionCfg.fieldEndPrefix+h.value+c.value;conCn=d.options[d.selectedIndex].innerText+h.options[h.selectedIndex].innerText+" "+c.options[c.selectedIndex].innerText}var g=new Option(conCn,a);var j=Ext.getDom("resultsSel_CN");if(undefined==k||k<0){j.options.add(g,j.selectedIndex+1)}else{j.options[k]=g}},refreshCon:function(){var a=Ext.getDom("resultsSel_CN");if(a.selectedIndex<0){return}var a=Ext.getDom("resultsSel_CN");viewConditionCfg.addCon(a.selectedIndex)},delCon:function(){var a=Ext.getDom("resultsSel_CN");if(a.selectedIndex<0){return}a.options.remove(a.selectedIndex)},addLeftBracked:function(){var a=Ext.getDom("resultsSel_CN");var b=new Option("(","(");a.options.add(b,a.selectedIndex+1)},addRightBracked:function(){var a=Ext.getDom("resultsSel_CN");var b=new Option(")",")");a.options.add(b,a.selectedIndex+1)},moveConItem:function(a){if(Ext.getDom("resultsSel_CN").selectedIndex<0){return}ucapCommonFun.moveOption(Ext.getDom("resultsSel_CN"),a)},selectParseAndSet:function(h){if(h.selectedIndex<0){return}var g=h.value;if(g==""||g=="("||g==")"){return}var c=g.substring(0,8);g=g.substring(8);var b=g.substring(0,g.indexOf(viewConditionCfg.fieldEndPrefix));g=g.substring(g.indexOf(viewConditionCfg.fieldEndPrefix)+viewConditionCfg.fieldEndPrefix.length);var f=g.substring(0,8);g=g.substring(8);var a="";var e="";var d="";if(f!="~!@0~!@9"&&f!="~!@0~!@A"){a=g.substring(0,8);g=g.substring(8);e=g.substring(0,g.indexOf(viewConditionCfg.fieldEndPrefix));d=g.substring(g.indexOf(viewConditionCfg.fieldEndPrefix)+viewConditionCfg.fieldEndPrefix.length)}else{d=g}Ext.getDom("leftseloptions_CN").value=c;viewConditionCfg.initSel("",c,"leftSel_CN");if(c=="~!@DZ@!~"||c=="~!@CL@!~"){Ext.getDom("leftInput_CN").value=b}else{Ext.getDom("leftSel_CN").value=b}Ext.getDom("compareTypeSel_CN").value=f;Ext.getDom("rightseloptions_CN").value=a;viewConditionCfg.initSel("",a,"rightSel_CN");if(a=="~!@DZ@!~"||a=="~!@CL@!~"){Ext.getDom("rightInput_CN").value=e}else{Ext.getDom("rightSel_CN").value=e}Ext.getDom("andOrSel_CN").value=d}};var ucapDept={rootJson:[],tree:null,isNewFlag:false,newRootId:"_ucapDeptNew",deptId:"deptleftTree",userViewId:"02EA017398D04F4500151416001D0000",oldJson:[],editDeptWin:null,renameValue:"",initDept:function(){if(ucapSession.userJson.userStatus==3){return}var e=[{text:"编辑部门",handler:function(){onDeptItemClick("edit")}},{text:"重命名",handler:function(){onDeptItemClick("rename")}},"-",{text:"删除部门",handler:function(){onDeptItemClick("delete")}}];var d=[{text:"文件",menu:{items:[{text:"新建部门",handler:function(){onDeptItemClick("new")}}]}},{text:"编辑",menu:{items:e}},{text:"查看",menu:{items:[{text:"展开",id:"deptExpand",handler:onDeptItemClick},{text:"折叠",id:"deptCollapse",handler:onDeptItemClick},{text:"全部展开",id:"deptExpandAll",handler:onDeptItemClick},{text:"全部折叠",id:"deptCollapseAll",handler:onDeptItemClick}]}},"-",{text:"新建部门",handler:function(){onDeptItemClick("new")}},{text:"编辑部门",handler:function(){onDeptItemClick("edit")}},{text:"删除部门",handler:function(){onDeptItemClick("delete")}}];var a=ucapSession.middleHeight;if(a<300){a=500}var c=new Ext.Panel({id:"ucap_deptTree",applyTo:"deptTree",plain:true,layout:"border",height:a,tbar:d,autoWidth:true,items:[{title:"部门列表",region:"west",html:'<div id="'+this.deptId+'">正在加载部门列表，请稍等......</div>',width:180,autoScroll:true,collapsible:true,height:a-10,split:true},{region:"center",contentEl:"deptHtml",autoWidth:true,buttonAlign:"right"}]});var b={url:ucapSession.baseAction,params:{type:"dept",act:"getDeptTree",unid:""},callback:function(h,k,g){if(k){var j=Ext.decode(g.responseText);var f=ucapCommonFun.dealException(j);if(!f){return}if(g.responseText!="null"&&g.responseText!=""){ucapDept.rootJson=Ext.util.JSON.decode(g.responseText)[0]}else{ucapDept.rootJson=[]}ucapDept.createTree("")}}};Ext.Ajax.request(b)},createTree:function(){Ext.DomHelper.applyStyles(Ext.get(this.deptId),'style="padding:3px 0px 0px 5px;"');Ext.getDom(this.deptId).innerHTML="";if(this.rootJson.length==0){this.rootJson={id:ucapDept.newRootId,text:""}}var e=new Ext.tree.AsyncTreeNode({id:this.rootJson.id,expanded:true,text:this.rootJson.text});var d=new Ext.tree.TreeLoader({url:ucapSession.baseAction});d.on("beforeload",function(f,g){if(g.id==ucapDept.newRootId){return}f.baseParams={type:"dept",act:"getDeptTree",unid:g.id}},this);var c=new Ext.tree.TreePanel({renderTo:this.deptId,root:e,animate:true,rootVisible:true,enableDD:true,autoScroll:true,containerScroll:true,loader:d});this.tree=c;c.on("click",function(f){ucapDept.setUserView(f.id)});c.addListener("movenode",ucapDept.handleMoveNode);c.on("contextmenu",b);function b(f){f.select();a.show(f.ui.getAnchor())}var a=new Ext.menu.Menu({id:"treeMenuContext",items:[{text:"新建部门",icon:"",handler:function(){onDeptItemClick("new")}},{text:"编辑部门",icon:"",handler:function(){onDeptItemClick("edit")}},{text:"删除部门",icon:"",handler:function(){onDeptItemClick("delete")}},{text:"重命名",icon:"",handler:function(){onDeptItemClick("rename")}}]});this.tree=c;e.select();ucapDept.setUserView(e.id)},handleMoveNode:function(j,a,g,h,d){var f=d+1;if(d==h.childNodes.length-1){f=d-1}var b=h.childNodes[f];var c={type:"dept",act:"move",unid:a.id,posDeptId:b.id,newParentId:h.id,random:ucapCommonFun.getRandomString()};var e={url:ucapSession.baseAction,params:c,callback:function(m,o,l){if(o){var n=Ext.decode(l.responseText);var k=ucapCommonFun.dealException(n);if(!k){return}if(l.responseText=="false"){Ext.Msg.alert("移动提示","移动不能被保存，无法生效！");return}}else{Ext.Msg.alert("移动提示","移动不能被保存，无法生效！")}}};Ext.Ajax.request(e)},deleteNode:function(){var a=function(){var d=b.id;var f={type:"dept",act:"delete",unid:d};var e={url:ucapSession.baseAction,params:f,callback:function(j,n,h){if(n){var m=Ext.decode(h.responseText);var g=ucapCommonFun.dealException(m);if(!g){return}var k=ucapDept.getSelectNode();var l;if(k.id!=ucapDept.tree.getRootNode().id){if(k.nextSibling){l=k.nextSibling}else{if(k.previousSibling){l=k.previousSibling}else{l=k.parentNode}}l.select();ucapDept.setUserView(l);k.remove()}else{ucapDept.rootJson=[];ucapDept.createTree()}}else{Ext.Msg.alert("提示","删除不成功，请重试！")}}};Ext.Ajax.request(e)};var b=ucapDept.getSelectNode();var c="删除本部门时，将同时删除其下所有的部门及所有对应的用户，此操作不可恢复，请确认?";Ext.MessageBox.confirm("删除提示",c,function(d){if(d=="yes"){a()}})},setValue:function(a){var b={url:ucapSession.baseAction,params:{type:"dept",act:"getDept",unid:a},callback:function(e,g,d){if(g){var f=Ext.decode(d.responseText);var c=ucapCommonFun.dealException(f);if(!c){return}ucapCommonFun.setFormValue(f);ucapDept.oldJson=ucapCommonFun.getFormJSon("deptEditHtml")}}};Ext.Ajax.request(b)},getSelectNode:function(){return ucapDept.tree.getSelectionModel().getSelectedNode()},saveDept:function(d,c){if(typeof d=="undefined"){d=""}if(typeof c=="undefined"){c=""}if(d==""){if(Ext.getDom("name").value.trim()==""){Ext.Msg.alert("保存提示","部门名称不能为空！");return}var e=ucapCommonFun.getFormJSon("deptEditHtml");if(c!=1){if(Ext.encode(this.oldJson)==Ext.encode(e)){Ext.Msg.alert("保存提示","当前文档未更改，无须保存！");return}}}else{var e={name:d}}var f=this.getSelectNode();var b=f.id;if(f.id==this.newRootId){b=""}var a={url:ucapSession.baseAction,params:{type:"dept",act:"save",punid:b,flag:this.isNewFlag},jsonData:e,callback:function(j,l,h){if(l){var k=Ext.decode(h.responseText);var g=ucapCommonFun.dealException(k);if(!g){return}ucapDept.oldJson=ucapCommonFun.getFormJSon("deptTreeHtml");if(ucapDept.isNewFlag){ucapDept.newSaveConfig(k,h,c)}else{ucapDept.oldSaveConfig(k,h,c)}ucapDept.editDeptWin.close();if(c==1){ucapDept.newEditDept()}}else{Ext.Msg.alert("提示","保存不成功，请重试！")}}};Ext.Ajax.request(a)},newSaveConfig:function(c,a){var d=ucapDept.getSelectNode();var e=Ext.decode(a.responseText);if(d.id==ucapDept.newRootId){d.id=e.id;d.setText(e.text);d.leaf=true}else{d.expand();var b=new Ext.tree.TreeNode(e);d.leaf=false;d.icon="";d.appendChild(b)}ucapDept.isNewFlag=false},oldSaveConfig:function(b,a){var c=ucapDept.getSelectNode();if(Ext.getDom("name")){c.setText(Ext.getDom("name").value)}else{c.setText(ucapDept.renameValue);ucapDept.renameValue=""}},setUserView:function(a){initView(this.userViewId,"userView","","","deptUnid="+a,26);ucapModule.deductViewDivId=ucapDept.deptId;ucapCommonFun.setViewWidth()},newEditDept:function(a){var d;if(typeof a=="undefined"||a==this.newRootId){d="新建部门";a="";this.isNewFlag=true}else{d="编辑部门"}var c="sys/cfgJsp/dept/dept.jsp?unid="+a;var b=[{text:"保存并新增下一个",handler:function(){ucapDept.saveDept("",1)}},{text:"保存并关闭",handler:function(){ucapDept.saveDept()}},{text:"取消",handler:function(){ucapDept.editDeptWin.close()}}];this.editDeptWin=new Ext.Window({title:ucapSession.win.winImg+d,width:500,closable:true,modal:true,height:300,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+c,scripts:true,nocache:true},buttons:b});this.editDeptWin.show()}};var onDeptItemClick=function(a){var c=a.id||a;switch(c){case"new":ucapDept.newEditDept();break;case"newWin":window.open(window.location,"_blank");break;case"edit":var b=ucapDept.getSelectNode();ucapDept.newEditDept(b.id);break;case"delete":ucapDept.deleteNode();break;case"deptExpandAll":ucapDept.getSelectNode().expand(true);break;case"deptExpand":ucapDept.getSelectNode().expand();break;case"deptCollapseAll":ucapDept.getSelectNode().collapse(true);break;case"deptCollapse":ucapDept.getSelectNode().collapse();break;case"rename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(e,d){if(e=="ok"){if(d==""){Ext.Msg.alert("改名提示","部门名称不能为空！");return}ucapDept.renameValue=d;ucapDept.saveDept(d)}},this);break;default:alert(a.id+"代码未实现！")}};Ext.namespace("ucapDictConfig");var ucapDictConfig={title:"",leftWidth:200,displayName:"",saveNewImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_103.gif"/>',saveImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_29.gif"/>',closeImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_102.gif"/>',treeJson:[],oldJson:[],rootUnid:"",rootName:"字典列表",tree:null,newRootId:"_ucapDictNew",root:null,isNewFlag:false,initDict:function(a,b){if(ucapSession.userJson.userStatus==3){return}this.oldJson=null;this.tree=null;this.treeJson=[];if(typeof a!="undefined"&&a!="null"){this.rootUnid=a;if(typeof b!="undefined"&&b!="null"&&b!=""){this.rootName=b}}else{this.rootUnid=this.newRootId}ucapDictConfig.initWinBox();this.createDictTree()},createDictTree:function(){if(this.isNewFlag){ucapDictConfig.rootUnid=this.newRootId;ucapDictConfig.createTree();return}ucapDictConfig.createTree()},initWinBox:function(){var e=[{text:"重命名",id:"dictFileRename",handler:onDictItemClick},"-",{text:"删除",id:"dictFileDelete",handler:onDictItemClick}];var d=[{text:"文件",menu:{items:[{text:"新建",id:"dictFileNew",handler:onDictItemClick},"-",{text:"关闭",id:"dictFileClose",handler:onDictItemClick}]}},{text:"编辑",menu:{items:e}},{text:"查看",menu:{items:[{text:"展开",id:"dictExpand",handler:onDictItemClick},{text:"折叠",id:"dictCollapse",handler:onDictItemClick},{text:"全部展开",id:"dictExpandAll",handler:onDictItemClick},{text:"全部折叠",id:"dictCollapseAll",handler:onDictItemClick}]}},"-",{text:"新建",id:"dictNew",handler:onDictItemClick},{text:"删除",id:"dictDelete",handler:onDictItemClick},{text:"恢复默认",id:"dictRecover",handler:onDictItemClick},"-"];var a=ucapSession.middleHeight;if(a<300){a=500}Ext.getDom("dictTree").innerHTML="";var b=new Ext.Panel({plain:true,id:"ucap_dictTree",applyTo:"dictTree",layout:"border",height:a,tbar:d,items:[{region:"west",html:'<div id="dictleftTree">正在加载字典，请稍等......</div>',width:this.leftWidth,autoScroll:true,collapsible:true,split:true},{region:"center",html:'<div id="ucapDictCenter"></div>',buttonAlign:"right",tbar:["->",{text:this.saveNewImg+"保存并新增下一下",handler:function(){ucapDictConfig.save("",1)}},{text:this.saveImg+"保存",id:"dictSave",handler:function(){ucapDictConfig.save()}}]}]});var c=b.getTopToolbar();c.addField(new Ext.form.Checkbox({name:"saveInfo",fieldLabel:"1",boxLabel:"保存成功时有提示",checked:true}));if(ucapSession.userJson.userStatus==1){Ext.getCmp("dictRecover").setDisabled(true)}},createTree:function(){Ext.DomHelper.applyStyles(Ext.get("dictleftTree"),'style="padding:3px 0px 0px 5px;"');Ext.getDom("dictleftTree").innerHTML="";var d=new Ext.tree.AsyncTreeNode({expanded:true,id:this.rootUnid,text:this.rootName});var b=new Ext.tree.TreeLoader({url:ucapSession.baseAction});b.on("beforeload",function(g,h){var f=h.id;if(h.id==ucapDictConfig.newRootId){f=""}g.baseParams={type:"dict",act:"getDictTree",flag:"edit",unid:f}},this);var a=new Ext.tree.TreePanel({renderTo:"dictleftTree",root:d,animate:true,rootVisible:true,enableDD:true,autoScroll:true,containerScroll:true,loader:b});a.on("click",function(f){if(f.id==ucapDictConfig.newRootId){ucapDictConfig.isNewFlag=true}else{ucapDictConfig.isNewFlag=false}ucapDictConfig.loadHtml()});a.addListener("movenode",ucapDictConfig.handleMoveNode);a.on("contextmenu",e);function e(f){f.select();ucapDictConfig.setButtonState();c.show(f.ui.getAnchor())}var c=new Ext.menu.Menu({items:[{id:"dictRightNew",text:"新建",icon:"",handler:onDictItemClick},{id:"dictRightDelete",text:"删除",icon:"",handler:onDictItemClick},{text:"重命名",icon:"",handler:function(){onDictItemClick("dictRename")}}]});a.on("load",function(g){if(g.id==ucapDictConfig.rootUnid){var f=g.firstChild;if(f==null){ucapDictConfig.isNewFlag=true;g.select()}else{var h="/"+ucapDictConfig.rootUnid+"/"+f.id;ucapDictConfig.tree.selectPath(h)}ucapDictConfig.loadHtml()}});this.tree=a;this.root=d},loadHtml:function(){var d=this.getSelectNode();var a=d.id;var c="sys/cfgJsp/dict/dictItem.jsp";var b=ucapSession.appPath+c;Ext.get("ucapDictCenter").load({url:b},{},function(){if(ucapSession.userJson.userStatus!=1){if(Ext.getDom("systemSet")){Ext.getDom("systemSet").style.display="none"}}ucapDictConfig.setValue(a)})},setButtonState:function(){var c=ucapDictConfig.getSelectNode();var b=true;if(c.id==ucapDictConfig.rootUnid){b=false}else{var a=c.attributes.attributes;if(typeof a=="undefined"){a=c.attributes}if(ucapSession.userJson.userStatus==1){b=false}else{if(ucapSession.userJson.userStatus==2){if(typeof a.belongToDepts!="undefined"){if(a.belongToDepts==ucapSession.userJson.effectiveAdminDept){b=false}}}else{if(ucapSession.userJson.userStatus==3){if(typeof a.belongToUsers!="undefined"){if(a.belongToUsers==ucapSession.userJson.unid){b=false}}}}}}Ext.getCmp("dictDelete").setDisabled(b);Ext.getCmp("dictRightDelete").setDisabled(b);Ext.getCmp("dictFileDelete").setDisabled(b)},setValue:function(a){Ext.getDom("dictName").focus();if(a==ucapDictConfig.newRootId){return}if(this.isNewFlag){ucapDictConfig.setButtonState();return}var c={type:"dict",act:"getDictItem",unid:a,random:ucapCommonFun.getRandomString()};var b={url:ucapSession.baseAction,params:c,callback:function(f,h,e){if(h){var g=Ext.decode(e.responseText);var d=ucapCommonFun.dealException(g);if(!d){return}ucapCommonFun.setFormValue(g);if(Ext.getDom("editors_Cn_")){Ext.getDom("editors_Cn_").value=ucapCommonFun.getDisplayNames("200,201,202,203",Ext.getDom("editors").value)}ucapDictConfig.oldJson=ucapCommonFun.getFormJSon("dictConfigdialogHtml");ucapDictConfig.setButtonState()}else{Ext.Msg.alert("提示","取值不成功，请重试！")}}};Ext.Ajax.request(b)},save:function(g,j){if(typeof j=="undefined"){j=""}var d=ucapCommonFun.getObjValueJson("saveInfo").v;var h=true;if(typeof(g)=="undefined"||g==""){h=false}var k;if(!h){k=ucapCommonFun.getFormJSon("dictConfigdialogHtml");k={name:k.dictName,value:k.value,editors:k.editors};if(j==""){if(Ext.encode(ucapDictConfig.oldJson)==Ext.encode(k)){Ext.Msg.alert("保存提示","当前数据未更改，无须保存！");return}}if(Ext.getDom("dictName").value==""){Ext.Msg.alert("保存提示","字典名称不能为空！");Ext.getDom("dictName").focus();return}}else{ucapDictConfig.loadHtml(true);k={name:g}}var a=ucapDictConfig.getSelectNode();var c=a.id;var e="";if(ucapDictConfig.isNewFlag){if(a.id==ucapDictConfig.root.id){e="newSaveByRoot"}else{e="newSave"}}else{e="oldSave"}var b;b={type:"dict",act:"save",flag:e,unid:c,random:ucapCommonFun.getRandomString()};var f={url:ucapSession.baseAction,params:b,jsonData:k,callback:function(n,q,m){if(q){var p=Ext.decode(m.responseText);var l=ucapCommonFun.dealException(p);if(!l){return}ucapDictConfig.oldJson=ucapCommonFun.getFormJSon("dictConfigdialogHtml");if(!h&&d!=""&&j==""){Ext.Msg.alert("提示","保存信息成功！")}if(ucapDictConfig.isNewFlag){ucapDictConfig.newSaveConfig(k,m)}else{ucapDictConfig.oldSaveConfig(k,m)}if(j==1){var o=ucapDictConfig.getSelectNode();o.parentNode.select();ucapDictConfig.isNewFlag=true;ucapDictConfig.loadHtml()}ucapDictConfig.setButtonState()}else{Ext.Msg.alert("提示","保存不成功，请重试！")}}};Ext.Ajax.request(f)},newSaveConfig:function(c,a){var d=ucapDictConfig.getSelectNode();var e=Ext.decode(a.responseText);d.expand();var b=new Ext.tree.TreeNode(e);d.leaf=false;d.icon="";d.appendChild(b);b.select();ucapDictConfig.isNewFlag=false},oldSaveConfig:function(b,a){ucapDictConfig.saveFlag=true;var c=ucapDictConfig.getSelectNode();if(a.responseText.indexOf("nochange")>-1){c.setText(b.name)}else{var d=Ext.decode(a.responseText);c.id=d.unid;if(d.belongToUsers){c.attributes.belongToUsers=d.belongToUsers}if(d.belongToDepts){c.attributes.belongToDepts=d.belongToDepts}c.setText(d.dictName)}},getSelectNode:function(){return ucapDictConfig.tree.getSelectionModel().getSelectedNode()},handleMoveNode:function(l,a,j,k,f){var h=f-1;var d=k.childNodes[h];var b="";if(typeof(d)!="undefined"){b=d.id}var e="";if(k.id!=ucapDictConfig.root.id){e=k.id}var c={type:"dict",act:"move",unid:a.id,posNode:b,newParentId:e,random:ucapCommonFun.getRandomString()};var g={url:ucapSession.baseAction,params:c,callback:function(o,r,n){if(r){if(n.responseText=="false"){Ext.Msg.alert("移动提示","移动不能被保存，无法生效！");return}else{var q=Ext.decode(n.responseText);var m=ucapCommonFun.dealException(q);if(!m){return}a.id=q.id;a.attributes.belongToUsers=q.belongToUsers;a.attributes.belongToDepts=q.belongToDepts;a.setText(q.text);var p=ucapDictConfig.tree.getLoader();p.load(a)}}else{Ext.Msg.alert("移动提示","移动不能被保存，无法生效！")}}};Ext.Ajax.request(g)},deleteNode:function(a){if(typeof(a)=="undefined"){a=true}var c=function(){var f=d.id;var h="item";if(d.id==ucapDictConfig.root.id){h="root"}var j={type:"dict",act:"delete",flag:h,unid:f,random:ucapCommonFun.getRandomString()};var g={url:ucapSession.baseAction,params:j,callback:function(n,r,l){if(r){var o=Ext.decode(l.responseText);var k=ucapCommonFun.dealException(o);if(!k){return}ucapDictConfig.saveFlag=true;var p=ucapDictConfig.getSelectNode();var m=parseInt(l.responseText,10);if(m<1&&a){Ext.Msg.alert("删除提示","你所选的字典你没有权限删除！");return}if(h!="root"){var q;if(p.nextSibling){q=p.nextSibling}else{if(p.previousSibling){q=p.previousSibling}else{q=p.parentNode}}p.remove();q.select();ucapDictConfig.loadHtml()}else{ucapDictConfig.initDict()}}else{Ext.Msg.alert("提示","删除不成功，请重试！")}}};Ext.Ajax.request(g)};var d=ucapDictConfig.getSelectNode();if(a){var e="";var b="";if(!d.isLeaf()){b="<br><br>删除时将同时删除其下所有的子节点"}if(ucapSession.userJson.userStatus==1){e="你当前是应用系统管理员身份，"+b+"且此操作不可恢复，你是否确定删除？"}else{if(ucapSession.userJson.userStatus==2){e="你当前是部门管理员身份，"+b+"你是否确定删除？"}else{e="你是否确定要删除选中的节点"+b+"？"}}Ext.MessageBox.confirm("删除提示",e,function(f){if(f=="yes"){c()}})}else{c()}}};var onDictItemClick=function(a){var b=a.id||a;switch(b){case"dictNew":ucapDictConfig.isNewFlag=true;ucapDictConfig.loadHtml();break;case"dictRightNew":ucapDictConfig.isNewFlag=true;ucapDictConfig.loadHtml();break;case"dictFileNew":ucapDictConfig.isNewFlag=true;ucapDictConfig.loadHtml();break;case"dictDelete":ucapDictConfig.deleteNode();break;case"dictRightDelete":ucapDictConfig.deleteNode();break;case"dictFileDelete":ucapDictConfig.deleteNode();break;case"dictClose":ucapDictConfig.win.close();break;case"dictFileClose":ucapDictConfig.win.close();break;case"dictExpandAll":ucapDictConfig.getSelectNode().expand(true);break;case"dictExpand":ucapDictConfig.getSelectNode().expand();break;case"dictCollapseAll":ucapDictConfig.getSelectNode().collapse(true);break;case"dictCollapse":ucapDictConfig.getSelectNode().collapse();break;case"dictRename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(d,c){if(d=="ok"){if(c==""){Ext.Msg.alert("改名提示","名称不能为空！");return}ucapDictConfig.save(c)}},this);break;case"dictFileRename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(d,c){if(d=="ok"){if(c==""){Ext.Msg.alert("改名提示","名称不能为空！");return}ucapDictConfig.save(c)}},this);break;case"dictRecover":Ext.MessageBox.confirm("恢复提示","你是否确定恢复整个字典<br>你自定义的所有字典都将被删除，并恢复到初始状态，请确认？",function(c){if(c=="yes"){ucapDictConfig.root.select();ucapDictConfig.deleteNode(false)}},this);break;default:alert(a.id+"代码未实现！")}};Validator={Notnull:/^(.+)?\S+(.+)?$/,Require:/.+/,Email:/^((\s?)+$)|(\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)$/,Phone:/^((\(\d{3}\))|(\d{3}\-))?(\(0\d{2,3}\)|0\d{2,3}-)?[1-9]\d{6,7}$/,Mobile:/^((\(\d{3}\))|(\d{3}\-))?13\d{9}$/,Url:/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/,IdCard:/^\d{15}(\d{2}[A-Za-z0-9])?$/,Currency:/^\d+(\.\d+)?$/,Number:/^\d+$/,Zip:/^[1-9]\d{5}$/,QQ:/^[1-9]\d{4,9}$/,Integer:/^[-\+]?\d+$/,Double:/^[-\+]?\d+(\.\d+)?$/,English:/^[A-Za-z]+$/,Chinese:/^[\u0391-\uFFE5]+$/,UnSafe:/^(([A-Z]*|[a-z]*|\d*|[-_\~!@#\$%\^&\*\.\(\)\[\]\{\}<>\?\\\/\'\"]*)|.{0,5})$|\s/,Date:/^((((1[6-9]|[2-9]\d)\d{2})-(0?[13578]|1[02])-(0?[1-9]|[12]\d|3[01]))|(((1[6-9]|[2-9]\d)\d{2})-(0?[13456789]|1[012])-(0?[1-9]|[12]\d|30))|(((1[6-9]|[2-9]\d)\d{2})-0?2-(0?[1-9]|1\d|2[0-8]))|(((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))-0?2-29-))$/,DateTime:/^((((1[6-9]|[2-9]\d)\d{2})-(0?[13578]|1[02])-(0?[1-9]|[12]\d|3[01]))|(((1[6-9]|[2-9]\d)\d{2})-(0?[13456789]|1[012])-(0?[1-9]|[12]\d|30))|(((1[6-9]|[2-9]\d)\d{2})-0?2-(0?[1-9]|1\d|2[0-8]))|(((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))-0?2-29-)) ([0-1][0-9]|2[0-3]):[0-5][0-9]$/,IsSafe:function(a){return !this.UnSafe.test(a)},SafeString:"this.IsSafe(value)",Limit:"this.limit(value.length,getAttribute('min'),  getAttribute('field_len'))",LimitB:"this.limit(this.LenB(value), getAttribute('min'), getAttribute('field_len'))",Repeat:"value == document.getElementsByName(getAttribute('to'))[0].value",Range:"getAttribute('min') < value && value < getAttribute('field_len')",Compare:"this.compare(value,getAttribute('operator'),getAttribute('to'))",Custom:"this.Exec(value, getAttribute('regexp'))",Group:"this.MustChecked(getAttribute('name'), getAttribute('min'), getAttribute('field_len'))",Item:[],ErrorItem:[],ErrorMessage:["以下原因导致提交失败：\t\t\t\t"],Validate:function(str,mode){var require,msg,vScope,vType,vEmpty;str=str?("div#"+str+" input,textarea"):"input,textarea";var objs=Ext.query(str);this.Item=objs;this.ErrorItem=[];this.ErrorMessage=["以下原因导致提交失败：\t\t\t\t"];this.ClearState();for(var i=0;i<objs.length;i++){with(objs[i]){require=getAttribute("require");if(require&&require==1){continue}msg=getAttribute("validateMessage")||"";vScope=getAttribute("validateScope")||"";vType=getAttribute("valiateType")||"";vEmpty=getAttribute("validateEmpty");var bResult=true;if((!vEmpty||vEmpty==0)&&Ext.isEmpty(value)&&vType!="Notnull"){continue}switch(vType){case"":break;default:if(vType&&this[vType]&&!this[vType].test(value)){if(null==msg||msg==""){var cusMsg="";switch(vType){case"Date":cusMsg=",日期格式填写不对，只能为YYYY-MM-DD";break;case"DateTime":cusMsg=",日期时间格式填写不对，只能为YYYY-MM-DD hh:mm";break;case"Notnull":cusMsg=",不能为空";break;case"Integer":cusMsg=",只能为整数";break;case"Number":cusMsg=",只能为数值";break;default:cusMsg=",输入不符合规则";break}this.AddError(i,getAttribute("nameCn")+cusMsg)}else{this.AddError(i,getAttribute("nameCn")+","+msg)}bResult=false}if(bResult&&vScope){var vs=vScope.split(",");var len=value.length;if(vs.length==1){bResult=(len==vs[0]);if(!bResult){this.AddError(i,getAttribute("nameCn")+",长度不等于"+vs[0])}}else{if(vs.length==2){var min=parseInt(vs[0]),max=parseInt(vs[1]);if(vs[0]==""){bResult=(len<max);if(!bResult){this.AddError(i,getAttribute("nameCn")+",长度小于"+max)}}else{if(vs[1]==""){bResult=(len>min);if(!bResult){this.AddError(i,getAttribute("nameCn")+",长度大于"+min)}}else{bResult=(len>min&&len<max);if(!bResult){this.AddError(i,getAttribute("nameCn")+",长度不在"+min+"到"+max+"范围")}}}}}}}}}if(this.ErrorMessage.length>1){mode=mode||3;var errCount=this.ErrorItem.length;switch(mode){case 2:for(var i=1;i<errCount;i++){if(this.ErrorItem[i]){this.ErrorItem[i].style.color="red"}}case 1:alert(this.ErrorMessage.join("\n"));break;case 3:for(var i=0;i<errCount;i++){try{if(this.ErrorItem[i]){Ext.DomHelper.append(this.ErrorItem[i].parentNode,'<span style="color:red;cursor:hand;width:20px;" id="__ErrorMessagePanel" title="'+this.ErrorMessage[i+1].replace(/\d+:/,"")+'">&#160;！</span>')}}catch(e){}}break;default:alert(this.ErrorMessage.join("\n"));break}return false}return true},limit:function(b,c,a){c=c||0;a=a||Number.MAX_VALUE;return c<=b&&b<=a},LenB:function(a){return a.replace(/[^\x00-\xff]/g,"**").length},ClearState:function(b){var c=Ext.query("span[id=__ErrorMessagePanel]");for(var a=0;a<c.length;a++){c[a].parentNode.removeChild(c[a])}},AddError:function(a,b){this.ErrorItem[this.ErrorItem.length]=this.Item[a];this.ErrorMessage[this.ErrorItem.length]=b},Exec:function(b,a){return new RegExp(a,"g").test(b)},compare:function(c,a,b){switch(a){case"NotEqual":return(c!=b);case"GreaterThan":return(c>b);case"GreaterThanEqual":return(c>=b);case"LessThan":return(c<b);case"LessThanEqual":return(c<=b);default:return(c==b)}},MustChecked:function(d,f,b){var a=document.getElementsByName(d);var c=0;f=f||1;b=b||a.length;for(var e=a.length-1;e>=0;e--){if(a[e].checked){c++}}return f<=c&&c<=b}};Ext.ux.TreeCheckNodeUI=function(){this.checkModel="multiple";this.onlyLeafCheckable=false;Ext.ux.TreeCheckNodeUI.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.TreeCheckNodeUI,Ext.tree.TreeNodeUI,{renderElements:function(e,k,j,l){var m=e.getOwnerTree();this.checkModel=m.checkModel||this.checkModel;this.onlyLeafCheckable=m.onlyLeafCheckable||false;this.indentMarkup=e.parentNode?e.parentNode.ui.getChildIndent():"";var f=(!this.onlyLeafCheckable||k.leaf);var c=k.href?k.href:Ext.isGecko?"":"#";var d=['<li class="x-tree-node"><div ext:tree-node-id="',e.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',k.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',k.icon||this.emptyIcon,'" class="x-tree-node-icon',(k.icon?" x-tree-node-inline-icon":""),(k.iconCls?" "+k.iconCls:""),'" unselectable="on" />',f?('<input class="x-tree-node-cb" type="checkbox" '+(k.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',k.hrefTarget?' target="'+k.hrefTarget+'"':"",'><span unselectable="on">',e.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var b;if(l!==true&&e.nextSibling&&(b=e.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",b,d)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",j,d)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var h=this.elNode.childNodes;this.indentNode=h[0];this.ecNode=h[1];this.iconNode=h[2];var g=3;if(f){this.checkbox=h[3];Ext.fly(this.checkbox).on("click",this.check.createDelegate(this,[null]));g++}this.anchor=h[g];this.textNode=h[g].firstChild},check:function(f){var g=this.node;var c=g.getOwnerTree();this.checkModel=c.checkModel||this.checkModel;if(f===null){f=this.checkbox.checked}else{this.checkbox.checked=f}g.attributes.checked=f;c.fireEvent("check",g,f);if(this.checkModel=="single"){var b=c.getChecked();for(var d=0;d<b.length;d++){var e=b[d];if(e.id!=g.id){e.getUI().checkbox.checked=false;e.attributes.checked=false;c.fireEvent("check",e,false)}}}else{if(!this.onlyLeafCheckable){if(this.checkModel=="cascade"||this.checkModel=="parentCascade"){var a=g.parentNode;if(a!==null){this.parentCheck(a,f)}}if(this.checkModel=="cascade"||this.checkModel=="childCascade"){if(!g.expanded&&!g.childrenRendered){g.expand(false,false,this.childCheck)}else{this.childCheck(g)}}}}},childCheck:function(e){var b=e.attributes;if(!b.leaf){var d=e.childNodes;var f;for(var c=0;c<d.length;c++){f=d[c].getUI();if(f.checkbox.checked^b.checked){f.check(b.checked)}}}},parentCheck:function(c,b){var d=c.getUI().checkbox;if(typeof d=="undefined"){return}if(!(b^d.checked)){return}if(!b&&this.childHasChecked(c)){return}d.checked=b;c.attributes.checked=b;c.getOwnerTree().fireEvent("check",c,b);var a=c.parentNode;if(a!==null){this.parentCheck(a,b)}},childHasChecked:function(b){var c=b.childNodes;if(c||c.length>0){for(var a=0;a<c.length;a++){if(c[a].getUI().checkbox.checked){return true}}}return false},toggleCheck:function(c){var a=this.checkbox;if(a){var b=(c===undefined?!a.checked:c);this.check(b)}}});function selectDataSD(type,selNum,inputName,conValue,outputFunc,inputSplit,outSplit){if(typeof selNum=="undefined"){selNum="0"}listSelect.isTree=false;var html="sys/jsp/select/listSelect.jsp?type="+type;var oldValue="";var oldText="";if(undefined!=inputName&&typeof(inputName)=="string"){oldValue=Ext.getDom(inputName).value;oldText=Ext.getDom(inputName+"_Cn_").value}listSelect.oldValue=oldValue;listSelect.oldText=oldText;listSelect.selNum=selNum;listSelect.conValue=conValue;listSelect.type=type;if(undefined!=inputSplit){listSelect.inputSplit=inputSplit}if(undefined!=outSplit){listSelect.outSplit=outSplit}listSelect.type=type;var width=520;var height=400;if(type=="204"||type=="228"){listSelect.isTree=true;if(typeof conValue=="undefined"){conValue=""}html="sys/jsp/select/commonTreeSelect.jsp?unid="+conValue+"&type="+type;if(type=="204"){ucapTreeSelect.rootName="字典列表";ucapTreeSelect.actionType="dict";ucapTreeSelect.act="getDictTree"}else{if(type=="228"){ucapTreeSelect.rootName="栏目列表";ucapTreeSelect.actionType="columns";ucapTreeSelect.act="getColumnsTree"}}ucapTreeSelect.selectType=selNum;if(selNum=="1"||selNum==1){width=210;height=300;if(conValue==""){height=410}ucapTreeSelect.width=width-40;ucapTreeSelect.height=height-90}else{height=410;ucapTreeSelect.width=190;ucapTreeSelect.height=height-90}}else{if(undefined!=conValue){html+="&conValue="+conValue}html+="&oldValue="+oldValue;if(undefined!=selNum){html+="&selNum="+selNum}if(undefined!=inputSplit){html+="&inputSplit="+inputSplit}if(undefined!=outSplit){html+="&outSplit="+outSplit}}if(type.indexOf("200")>-1||type.indexOf("201")>-1){listSelect.isTree=true}var button=[{text:"确定",handler:function(){if(listSelect.isTree&&listSelect.selNum==1){var flag=listSelect.treeAddSelect();if(!flag){return}}var value=listSelect.getSelectedValue();var text=value.substring(value.indexOf(listSelect.valTextSplit)+listSelect.valTextSplit.length);value=value.substring(0,value.indexOf(listSelect.valTextSplit));if(undefined!=inputName&&inputName!=""){if(typeof(inputName)=="string"){var descCn=Ext.getDom((inputName+"_Cn_"));inputName=Ext.getDom(inputName);if(inputName){inputName.value=value}if(descCn){descCn.value=text}}}if(undefined!=outputFunc&&outputFunc!=""&&typeof outputFunc=="string"){try{(function(){var args={value:value,text:text};eval(outputFunc+"(args);")})()}catch(e){alert("执行回调函数【"+outputFunc+"】失败!")}}ucapSession.commonSelectWin.close()}},{text:"取消",handler:function(){ucapSession.commonSelectWin.close()}}];ucapSession.commonSelectWin=new Ext.Window({title:ucapSession.win.winImg+"通用选择框",width:width,closable:true,modal:true,height:height,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+html,scripts:true,nocache:true},buttons:button});ucapSession.commonSelectWin.show()}function selectView(viewId,fieldNames,inputName,isSingle,callBack,sTitle,purl,recordSplit,colSplit){var recSplit="~RECORD_UCAP~";var cSplit="~COL_UCAP~";if(typeof fieldNames=="undefined"||fieldNames==""){Ext.Msg.alert("提示信息","要选择的视图列名称不能为空！");return}if(typeof viewId=="undefined"||viewId==""){Ext.Msg.alert("提示信息","视图的UNID不能为空！");return}if(typeof isSingle=="undefined"||isSingle==""){isSingle="1"}if(typeof recordSplit=="undefined"||recordSplit==""){recordSplit=recSplit}if(typeof colSplit=="undefined"||colSplit==""){colSplit=cSplit}var html="sys/jsp/view.jsp";html+="?viewId="+viewId;html+="&noPreview=true&noTbar=true";if(typeof purl!="undefined"&&purl!=""){purl=purl.replace(/&/g,"~$*$~");html+="&purl="+purl}html+="&isSingle="+isSingle+"&recordSplit="+recordSplit+"&colSplit="+colSplit;var selectConfirm=function(){var v=Ext.getDom("_UcapSelectiFrame").contentWindow.view.getColumnValueByName(fieldNames);var args={value:v,text:v.replace(/(~RECORD_UCAP~|~COL_UCAP~)/g," ")};if(typeof inputName!="undefined"&&inputName!=""){if(typeof(inputName)=="string"){var descCn=Ext.getDom((inputName+"_Cn_"));inputName=Ext.getDom(inputName);if(inputName){inputName.value=args.text}if(descCn){descCn.value=v}}}if(undefined!=callBack&&callBack!=""&&typeof callBack=="string"){try{(function(){eval(callBack+"(args);")})()}catch(e){alert("执行回调函数【"+callBack+"】失败!")}}ucapSession.commonWin.close()};var button=[{text:"确定",handler:function(){selectConfirm()}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];html=ucapSession.hostPath+ucapSession.appPath+html;html=' <iframe id="_UcapSelectiFrame" name="_UcapSelectiFrame"  width="100%" height="100%" frameborder="0"  src="'+html+'"></iframe>';var height=document.body.clientHeight-50;var width=document.body.clientWidth/2;ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+(sTitle||"视图列选择对话框"),width:width,closable:true,modal:true,autoScroll:true,height:height,html:html,buttons:button});ucapSession.commonWin.show()}var selectValue={type:"",value:"",test:""};var listSelect={selectValues:null,oldValue:"",oldText:"",inputSplit:",",outSplit:",",selNum:0,type:"",conValue:"",inputType:"0",outType:"0",currentType:"",treeDivId:"treeSelect",commSelectId:"selectList",deptRootId:"_deptroot-undefined",rootJson:null,tree:null,isTree:false,valTextSplit:"~$@s@$~",initTypes:function(){var g="";var c=ucapSession.baseAction;c+="?type=listSelect&action=getTypes&selecttype="+listSelect.type+"&rand="+Math.random();var f=Ext.lib.Ajax.getConnectionObject().conn;f.open("GET",c,false);f.send(null);var e=Ext.util.JSON.decode(f.responseText);var b=ucapCommonFun.dealException(e);if(!b){return}var a=e.items;listSelect.initSelectedValue();if(undefined!=a){for(var d=0;d<a.length;d++){if(d==0){listSelect.loadType(a[d].type,listSelect.conValue)}if(undefined==a[d]||null==a[d]){continue}if(undefined==g||g==""){g="<input type='radio' value='"+a[d].type+"' name='select' id='select' checked onClick='listSelect.radioClick(this);'>"+a[d].name+"</input>"}else{g+="<input type='radio' value='"+a[d].type+"' name='select' id='select' onClick='listSelect.radioClick(this);'>"+a[d].name+"</input>"}}}Ext.getDom("selectTypeId").innerHTML=g},loadType:function(b,a){listSelect.currentType=b;if(b=="200"||b=="201"){this.loadTree(b,a)}else{this.loadList(b,a)}},loadList:function(h,j){Ext.getDom(this.treeDivId).style.display="none";Ext.getDom(this.commSelectId).style.display="";this.isTree=false;if(this.selNum=="1"){Ext.getDom(this.commSelectId).multiple=false}else{Ext.getDom(this.commSelectId).multiple=true}var a=ucapSession.baseAction;a+="?type=listSelect&conval="+j+"&selecttype="+h+"&rand="+Math.random();var c=Ext.lib.Ajax.getConnectionObject().conn;c.open("GET",a,false);c.send(null);var k=Ext.util.JSON.decode(c.responseText);var b=ucapCommonFun.dealException(k);if(!b){return}var f=Ext.getDom(this.commSelectId);var g=k.items;if(undefined!=f&&f.options.length>0){var e=f.options.length;for(var d=0;d<e;d++){f.options.remove(0)}}if(undefined!=g){for(var d=0;d<g.length;d++){if(undefined==g[d]||null==g[d]){continue}ucapCommonFun.addOption(f,g[d].id,g[d].name)}}},loadTree:function(c,b){Ext.getDom(this.treeDivId).style.display="";Ext.getDom(this.commSelectId).style.display="none";this.isTree=true;var a={url:ucapSession.baseAction,params:{type:"treeSelect",action:"getDeptTree",unid:""},callback:function(f,h,e){if(h){var g=Ext.decode(e.responseText);var d=ucapCommonFun.dealException(g);if(!d){return}if(e.responseText!="null"){listSelect.rootJson=Ext.util.JSON.decode(e.responseText)[0]}else{this.rootJson=null}listSelect.createTree(c,b)}}};Ext.Ajax.request(a)},createTree:function(g,f){Ext.DomHelper.applyStyles(Ext.get(this.treeDivId),'style="padding:3px 0px 0px 5px;"');Ext.getDom(this.treeDivId).innerHTML="";var e=false;if(g=="200"){e=true}var d="childCascade";if(listSelect.selNum==1){d="single"}if(null==this.rootJson){this.rootJson={id:this.deptRootId,text:""}}var c;if(e){c=new Ext.tree.AsyncTreeNode({id:this.rootJson.id,expanded:true,text:this.rootJson.text})}else{c=new Ext.tree.AsyncTreeNode({id:this.rootJson.id,expanded:true,checked:false,text:this.rootJson.text})}var b=new Ext.tree.TreeLoader({url:ucapSession.baseAction,baseAttrs:{uiProvider:Ext.ux.TreeCheckNodeUI}});b.on("beforeload",function(h,j){if(j.id==this.deptRootId){return}h.baseParams={type:"treeSelect",action:"getDeptTree",unid:j.id,selectType:g}},this);var a=new Ext.tree.TreePanel({renderTo:this.treeDivId,root:c,animate:true,rootVisible:true,autoScroll:true,width:190,height:270,containerScroll:true,loader:b,onlyLeafCheckable:e,checkModel:d});this.tree=a},radioClick:function(h){if(!h.checked){return}var g=h.value;if(g==listSelect.currentType){return}var d=Ext.getDom("resultList");if(undefined!=d){if(null==listSelect.selectValues){listSelect.selectValues=new Array()}var c=-1;for(var e=0;e<listSelect.selectValues.length;e++){var a=listSelect.selectValues[e];if(a.type==listSelect.currentType){c=e;break}}var f=new Object();f.type=listSelect.currentType;var b=listSelect.getResultValue();if(undefined!=b&&b!=""){f.value=b.substring(0,b.indexOf(listSelect.valTextSplit));f.text=b.substring(b.indexOf(listSelect.valTextSplit)+listSelect.valTextSplit.length)}if(c<0){listSelect.selectValues[listSelect.selectValues.length]=f}else{listSelect.selectValues[c]=f}}listSelect.loadType(g,listSelect.conValue)},initSelectedValue:function(){var c=Ext.getDom("resultList");if(undefined!=c&&c.options.length>0){var a=c.options.length;for(var d=0;d<a;d++){c.options.remove(0)}}if(""!=listSelect.oldValue&&""!=listSelect.oldText){var f=listSelect.oldValue.split(listSelect.inputSplit);var b=listSelect.oldText.split(listSelect.inputSplit);var e=f.length>b.length?b.length:f.length;for(var d=0;d<e;d++){ucapCommonFun.addOption(c,f[d],b[d])}}},getResultValue:function(){var c=Ext.getDom("resultList");var g="";var f="";if(undefined!=c.options&&c.options.length>0){for(var d=0;d<c.options.length;d++){var e=c.options[d];var a="";var b="";b=e.innerText;a=e.value;if(g==""){g=a}else{g+=listSelect.outSplit+a}if(f==""){f=b}else{f+=listSelect.outSplit+b}}}return g+listSelect.valTextSplit+f},moveResult:function(b){var a=Ext.getDom("resultList");if(a.selectedIndex<0){return}ucapCommonFun.moveOption(a,b)},addSelect:function(){if(this.isTree){this.treeAddSelect()}else{this.commonAddSelect()}},treeAddSelect:function(){var b=listSelect.tree;var c=b.getChecked();if(c.length==0){Ext.Msg.alert("提示信息","当前未选择任何节点");return false}if(listSelect.selNum==1){this.delAll()}for(var d=0;d<c.length;d++){var a=c[d].id;if(this.type=="204"){if(ucapTreeSelect.valueType=="value"){a=c[d].attributes.value}}var e={value:a,innerText:c[d].text};this.addOptionByValue(e)}return true},commonAddSelect:function(){var c=Ext.getDom(this.commSelectId);if(c.selectedIndex<0){return}var a=Ext.getDom("resultList");if(listSelect.selNum==1){this.delAll()}for(var b=0;b<c.options.length;b++){if(c.options[b].selected){var d=c.options[b];this.addOptionByValue(d)}}},addAll:function(){if(this.isTree){this.treeAddAll()}else{this.commonAddAll()}},treeAddAll:function(){},commonAddAll:function(){var c=Ext.getDom(this.commSelectId);var a=Ext.getDom("resultList");if(undefined==c||c.options.length<0){return}for(var b=0;b<c.options.length;b++){var d=c.options[b];this.addOptionByValue(d)}},delSelect:function(){var a=Ext.getDom("resultList");if(a.selectedIndex<0){return}a.options.remove(a.selectedIndex)},delAll:function(){var b=Ext.getDom("resultList");if(undefined!=b&&b.options.length>0){var a=b.options.length;for(var c=0;c<a;c++){b.options.remove(0)}}},addOptionByValue:function(d){var a=Ext.getDom("resultList");for(var b=0;b<a.options.length;b++){var c=a.options[b];if(c.value==d.value){return}}ucapCommonFun.addOption(a,d.value,d.innerText)},getSelectedValue:function(){var c="";var d="";if(undefined!=listSelect.selectValues&&listSelect.selectValues.length>0){for(var b=0;b<listSelect.selectValues;b++){if(listSelect.selectValues[b].type!=listSelect.currentType){if(c==""){c=listSelect.selectValues[b].value;d=listSelect.selectValues[b].text}else{c+=listSelect.outSplit+listSelect.selectValues[b].value;d+=listSelect.outSplit+listSelect.selectValues[b].text}}}}var a=listSelect.getResultValue();if(a!=""){if(c==""){c=a.substring(0,a.indexOf(listSelect.valTextSplit))}else{c+=listSelect.outSplit+a.substring(0,a.indexOf(listSelect.valTextSplit))}if(d==""){d=a.substring(a.indexOf(listSelect.valTextSplit)+listSelect.valTextSplit.length)}else{d+=listSelect.outSplit+a.substring(a.indexOf(listSelect.valTextSplit)+listSelect.valTextSplit.length)}}return c+listSelect.valTextSplit+d}};var ucapTreeSelect={rootUnid:"",rootName:"字典列表",selectType:"1",inputName:"",inputSplit:"",outSplit:"",valueType:"value",checkModel:"childCascade",onlyLeafCheckable:true,height:"",width:"",actionType:"",act:"",tree:null,createTree:function(c,e){if(typeof c=="undefined"||c==null||c==""){c="_root";this.valueType="id"}else{this.valueType="value";this.rootName=e}this.rootUnid=c;Ext.getDom("multiSelect").style.display="";Ext.getDom("commonSelectTree").innerHTML="";Ext.DomHelper.applyStyles(Ext.get("commonSelectTree"),'style="padding:0px;"');if(this.selectType=="1"){this.checkModel="single";Ext.getDom("multiSelect").style.display="none"}else{this.checkModel="childCascade"}if(c=="_root"){this.onlyLeafCheckable=false}var d=new Ext.tree.AsyncTreeNode({expanded:true,id:this.rootUnid,text:this.rootName});var b=new Ext.tree.TreeLoader({url:ucapSession.baseAction});b.on("beforeload",function(g,h){var f=h.id;if(f=="_root"){f=""}g.baseParams={type:ucapTreeSelect.actionType,act:ucapTreeSelect.act,unid:f},g.baseAttrs={uiProvider:Ext.ux.TreeCheckNodeUI}},this);var a=new Ext.tree.TreePanel({renderTo:"commonSelectTree",root:d,animate:true,checkModel:this.checkModel,onlyLeafCheckable:this.onlyLeafCheckable,rootVisible:true,autoScroll:true,width:this.width,containerScroll:true,height:this.height,loader:b});listSelect.tree=a}};Ext.namespace("ucapShortConfig");var ucapShortConfig={htmlType:1,title:"",leftWidth:185,displayName:"",name:"",saveNewImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_103.gif"/>',saveImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_29.gif"/>',closeImg:'<img align="absmiddle" src="'+ucapSession.appPath+'uistyle/images/icon/icon_102.gif"/>',rootUnid:"",treeJson:[],oldJson:[],html:"",tree:null,root:null,newRootId:"_ucapShortNew",height:500,isNewFlag:false,preHtml:"",cutNode:null,win:"",initValue:function(){this.oldJson=null;this.preHtml="";this.tree=null;this.treeJson=[]},openShortByView:function(a){this.openShortConfig(a)},openShortConfig:function(c,b){var a=false;if(typeof c=="undefined"||c==""){c="";a=true}if(typeof b=="undefined"){b=""}this.initValue();this.isNewFlag=a;this.title="快捷方式集";if(this.isNewFlag){this.rootUnid=this.newRootId;this.displayName="新建快捷方式集"}else{this.createShortTree(c)}if(b==""){this.initWinBox()}this.createTree()},createShortTree:function(f){var c=ucapSession.baseAction;c+="?type=short&act=getShortTree&shortUnid="+f+"&random="+ucapCommonFun.getRandomString();var e=Ext.lib.Ajax.getConnectionObject().conn;e.open("GET",c,false);e.send(null);var a=e.responseText;if(a.indexOf("error")>-1){Ext.Msg.alert("提示","从后台获取快捷方式集内容时出错，快捷方式集的ID为"+f);return""}var d=Ext.decode(a);var b=ucapCommonFun.dealException(d);if(!b){return}this.displayName=d.displayName;this.name=d.name;this.shortUnid=d.unid;this.rootUnid=this.shortUnid;if(typeof d.shortcuts=="undefined"){this.treeJson=[]}else{this.treeJson=d.shortcuts}},initWinBox:function(){var c=[{text:"重命名",id:"shortFileRename",handler:onShortItemClick},"-",{text:"删除",id:"shortFileDelete",handler:onShortItemClick}];var b=[{text:"文件",menu:{items:[{text:"新建",id:"shortFileNew",handler:onShortItemClick},"-",{text:"关闭",id:"shortFileClose",handler:onShortItemClick}]}},{text:"编辑",menu:{items:c}},{text:"查看",menu:{items:[{text:"展开",id:"shortExpand",handler:onShortItemClick},{text:"折叠",id:"shortCollapse",handler:onShortItemClick},{text:"全部展开",id:"shortExpandAll",handler:onShortItemClick},{text:"全部折叠",id:"shortCollapseAll",handler:onShortItemClick}]}},"-",{text:"新建",id:"shortNew",handler:onShortItemClick},{text:"删除",id:"shortDelete",handler:onShortItemClick},"-"];ucapShortConfig.win=new Ext.Window({title:ucapSession.win.winImg+this.title+"定制窗口",closable:true,width:700,height:this.height,modal:true,bodyStyle:ucapSession.win.winBodyStyle,tbar:b,plain:true,layout:"border",items:[{title:'<div id="menuConfigTitle"></div>',region:"west",html:'<div id="leftTree">正在加载，请稍等......</div>',width:this.leftWidth,autoScroll:true,collapsible:true,split:true},{id:"centerId",region:"center",html:'<div id="ucapShortCenter"></div>',buttonAlign:"right",tbar:["->",{text:this.saveNewImg+"保存并新增下一下",handler:function(){ucapShortConfig.save("",1)}},{text:this.saveImg+"保存",id:"shortSave",handler:function(){ucapShortConfig.save()}},{text:this.closeImg+"关闭",id:"shortClose",handler:onShortItemClick}]}]});ucapShortConfig.win.show();var a=ucapShortConfig.win.getTopToolbar();a.addField(new Ext.form.Checkbox({name:"saveInfo",fieldLabel:"1",boxLabel:"保存成功时有提示",checked:true}))},createTree:function(){this.preHtml="";this.tree=null;this.htmlType="";var e=this.title+"定制";this.setWinTitle(e);Ext.DomHelper.applyStyles(Ext.get("leftTree"),'style="padding:3px 0px 0px 5px;"');Ext.getDom("leftTree").innerHTML="";var d;if(typeof(this.treeJson)!="undefined"){d=new Ext.tree.AsyncTreeNode({expanded:true,id:this.rootUnid,text:this.displayName,children:this.treeJson})}else{d=new Ext.tree.AsyncTreeNode({expanded:true,id:this.rootUnid,leaf:true,text:this.displayName})}var c=new Ext.tree.TreePanel({renderTo:"leftTree",root:d,animate:true,rootVisible:true,enableDD:true,autoScroll:true,containerScroll:true,height:ucapShortConfig.height-92,loader:new Ext.tree.TreeLoader({dataUrl:""})});c.on("click",function(){ucapShortConfig.isNewFlag=false;ucapShortConfig.loadHtml()});c.addListener("movenode",ucapShortConfig.handleMoveNode);c.on("contextmenu",b);function b(f){f.select();ucapShortConfig.setButtonState();a.show(f.ui.getAnchor())}var a=new Ext.menu.Menu({items:[{id:"shortRightNew",text:"新建",icon:"",handler:onShortItemClick},{id:"shortRightDelete",text:"删除",icon:"",handler:onShortItemClick},{text:"重命名",icon:"",handler:function(){onShortItemClick("shortRename")}}]});this.tree=c;d.select();this.root=d;this.loadHtml()},loadHtml:function(c){var h=false;if(typeof(c)!="undefined"){h=c}var e=this.getSelectNode();var a=e.id;var g;if(e.id==this.root.id){this.htmlType=2}else{this.htmlType=1}if(this.isNewFlag&&e.id!=this.newRootId){this.htmlType=1}if(this.htmlType==2){ucapShortConfig.html="sys/cfgJsp/short/shortRoot.jsp"}else{g={type:"short",act:"getShortItem",unid:a,random:ucapCommonFun.getRandomString()};ucapShortConfig.html="sys/cfgJsp/short/shortMenu.jsp"}if(h){return}if(this.isNewFlag){ucapShortConfig.preHtml=""}var b=ucapSession.appPath+ucapShortConfig.html;if(ucapShortConfig.preHtml!=ucapShortConfig.html){ucapShortConfig.preHtml=ucapShortConfig.html;var d=Ext.get("ucapShortCenter");var f=d.getUpdater();f.update({url:b,scripts:true});f.on("update",function(){if(ucapShortConfig.htmlType==2){if(e.id==ucapShortConfig.rootUnid){if(Ext.getDom("displayName")){Ext.getDom("displayName").value=ucapShortConfig.displayName}if(ucapShortConfig.name&&Ext.getDom("name")){Ext.getDom("name").value=ucapShortConfig.name}}ucapShortConfig.setButtonState()}else{ucapShortConfig.setValue(a,g)}})}else{if(ucapShortConfig.htmlType==2){return}ucapShortConfig.setValue(a,g)}},setButtonState:function(){var a=ucapShortConfig.getSelectNode();if(ucapShortConfig.root.id==ucapShortConfig.newRootId){Ext.getCmp("shortNew").setDisabled(true);Ext.getCmp("shortRightNew").setDisabled(true);Ext.getCmp("shortFileNew").setDisabled(true);Ext.getCmp("shortDelete").setDisabled(true);Ext.getCmp("shortRightDelete").setDisabled(true);Ext.getCmp("shortFileDelete").setDisabled(true);return}else{Ext.getCmp("shortDelete").setDisabled(false);Ext.getCmp("shortRightDelete").setDisabled(false);Ext.getCmp("shortFileDelete").setDisabled(false)}if(!a.isLeaf()||a.id==ucapShortConfig.root.id){Ext.getCmp("shortFileNew").setDisabled(false);Ext.getCmp("shortNew").setDisabled(false);Ext.getCmp("shortRightNew").setDisabled(false)}else{Ext.getCmp("shortFileNew").setDisabled(true);Ext.getCmp("shortNew").setDisabled(true);Ext.getCmp("shortRightNew").setDisabled(true)}},setValue:function(a,d,c){if(this.isNewFlag){ucapShortConfig.setButtonState();return}var b={url:ucapSession.baseAction,params:d,callback:function(g,j,f){if(j){if(f.responseText==null||f.responseText=="null"){return}var h=Ext.decode(f.responseText);var e=ucapCommonFun.dealException(h);if(!e){return}if(typeof h=="undefined"||h==null){return}ucapCommonFun.setFormValue(h);if(h==undefined||"undefined"!=typeof(h.picturePath)){Ext.getDom("titleIconImg").src=ucapSession.appPath+h.picturePath}ucapShortConfig.oldJson=ucapCommonFun.getFormJSon("shortConfigdialogHtml");ucapShortConfig.setButtonState()}else{Ext.Msg.alert("提示","取值不成功，请重试！")}}};Ext.Ajax.request(b)},save:function(h,k){if(typeof k=="undefined"){k=""}var e=ucapCommonFun.getObjValueJson("saveInfo").v;var j=true;if(typeof(h)=="undefined"||h==""){j=false}var l;if(!j){l=ucapCommonFun.getFormJSon("shortConfigdialogHtml");if(k==""){if(Ext.encode(ucapShortConfig.oldJson)==Ext.encode(l)){Ext.Msg.alert("保存提示","当前数据未更改，无须保存！");return}}}else{ucapShortConfig.loadHtml(true);if(ucapShortConfig.htmlType==2){l={displayName:h}}else{l={name:h}}}var a=ucapShortConfig.getSelectNode();var d=a.id;var f="old";var c="";if(this.isNewFlag){f="new";c=ucapShortConfig.root.id}var b;if(ucapShortConfig.htmlType==2){b={type:"short",act:"saveShortRoot",flag:f,unid:d,random:ucapCommonFun.getRandomString()}}else{if(ucapShortConfig.htmlType==1){b={type:"short",act:"saveShortItem",flag:f,unid:d,parentId:c,random:ucapCommonFun.getRandomString()}}}var g={url:ucapSession.baseAction,params:b,jsonData:l,callback:function(o,r,n){if(r){var q=Ext.decode(n.responseText);var m=ucapCommonFun.dealException(q);if(!m){return}ucapShortConfig.oldJson=ucapCommonFun.getFormJSon("shortConfigdialogHtml");if(!j&&e!=""&&k==""){Ext.Msg.alert("提示","保存信息成功！")}if(ucapShortConfig.isNewFlag){ucapShortConfig.newSaveConfig(l,n)}else{ucapShortConfig.oldSaveConfig(l,n)}if(k==1){var p=ucapShortConfig.getSelectNode();if(p.id!=ucapShortConfig.tree.getRootNode().id){p.parentNode.select()}ucapShortConfig.isNewFlag=true;ucapShortConfig.loadHtml()}ucapShortConfig.setButtonState()}else{Ext.Msg.alert("提示","保存不成功，请重试！")}}};Ext.Ajax.request(g)},newSaveConfig:function(c,a){var d=ucapShortConfig.getSelectNode();var e=Ext.decode(a.responseText);if(d.id==ucapShortConfig.newRootId){d.id=e.unid;d.setText(e.displayName);d.leaf=true;ucapShortConfig.rootUnid=d.id;ucapShortConfig.root=d}else{d.expand();var b=new Ext.tree.TreeNode({id:e.unid,text:e.name,leaf:true});d.leaf=false;d.icon="";d.appendChild(b);b.select()}ucapShortConfig.isNewFlag=false},oldSaveConfig:function(b,a){ucapShortConfig.saveFlag=true;var c=ucapShortConfig.getSelectNode();if(a.responseText.indexOf("nochange")>-1){if(ucapShortConfig.htmlType==2){c.setText(b.displayName)}else{c.setText(b.name)}}else{var d=Ext.decode(a.responseText);if(c.id==ucapShortConfig.root.id){c.id=d.unid;c.setText(d.displayName)}else{c.id=d.unid;c.setText(d.name)}}},getSelectNode:function(){return ucapShortConfig.tree.getSelectionModel().getSelectedNode()},setWinTitle:function(a){Ext.getDom("menuConfigTitle").innerHTML=a},handleMoveNode:function(j,a,g,h,d){var f=d+1;if(d==h.childNodes.length-1){f=d-1}var b=h.childNodes[f];var c={type:"short",act:"move",unid:a.id,posCutId:b.id,random:ucapCommonFun.getRandomString()};var e={url:ucapSession.baseAction,params:c,callback:function(m,o,l){if(o){var n=Ext.decode(l.responseText);var k=ucapCommonFun.dealException(n);if(!k){return}if(l.responseText=="false"){Ext.Msg.alert("移动提示","移动不能被保存，无法生效！");return}}else{Ext.Msg.alert("移动提示","移动不能被保存，无法生效！")}}};Ext.Ajax.request(e)},deleteNode:function(a){if(typeof(a)=="undefined"){a=true}var c=function(){var f=d.id;var h="item";if(d.id==ucapShortConfig.root.id){h="root"}var j={type:"short",act:"delete",flag:h,unid:f,random:ucapCommonFun.getRandomString()};var g={url:ucapSession.baseAction,params:j,callback:function(m,q,l){if(q){var p=Ext.decode(l.responseText);var k=ucapCommonFun.dealException(p);if(!k){return}ucapShortConfig.saveFlag=true;var n=ucapShortConfig.getSelectNode();if(h!="root"){var o=n.parentNode;n.remove();o.select();ucapShortConfig.loadHtml()}else{ucapShortConfig.openShortConfig("",1);ucapShortConfig.name=""}}else{Ext.Msg.alert("提示","删除不成功，请重试！")}}};Ext.Ajax.request(g)};var d=ucapShortConfig.getSelectNode();if(a){var e="";var b="";if(!d.isLeaf()){b="<br><br>删除时将同时删除其下所有的子节点"}e="你是否确定要删除选中的节点"+b+"？";Ext.MessageBox.confirm("删除提示",e,function(f){if(f=="yes"){c()}})}else{c()}}};var onShortItemClick=function(a){var b=a.id||a;switch(b){case"shortNew":ucapShortConfig.isNewFlag=true;ucapShortConfig.loadHtml();break;case"shortRightNew":ucapShortConfig.isNewFlag=true;ucapShortConfig.loadHtml();break;case"shortFileNew":ucapShortConfig.isNewFlag=true;ucapShortConfig.loadHtml();break;case"shortDelete":ucapShortConfig.deleteNode();break;case"shortRightDelete":ucapShortConfig.deleteNode();break;case"shortFileDelete":ucapShortConfig.deleteNode();break;case"shortClose":ucapShortConfig.win.close();break;case"shortFileClose":ucapShortConfig.win.close();break;case"shortExpandAll":ucapShortConfig.getSelectNode().expand(true);break;case"shortExpand":ucapShortConfig.getSelectNode().expand();break;case"shortCollapseAll":ucapShortConfig.getSelectNode().collapse(true);break;case"shortCollapse":ucapShortConfig.getSelectNode().collapse();break;case"shortRename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(d,c){if(d=="ok"){if(c==""){Ext.Msg.alert("改名提示","名称不能为空！");return}ucapShortConfig.save(c)}},this);break;case"shortFileRename":Ext.Msg.prompt("改名对话框","请输入新的名称：",function(d,c){if(d=="ok"){ucapShortConfig.save(c)}},this);break;default:alert(a.id+"代码未实现！")}};var $dp,WdatePicker;(function(){var j={$wdate:true,$crossFrame:false,$dpPath:"",position:{},lang:"auto",skin:"default",dateFmt:"yyyy-MM-dd",realDateFmt:"yyyy-MM-dd",realTimeFmt:"HH:mm:ss",realFullFmt:"%Date %Time",minDate:"1900-01-01 00:00:00",maxDate:"2099-12-31 23:59:59",startDate:"",alwaysUseStartDate:false,yearOffset:1911,isShowWeek:false,highLineWeekDay:true,isShowClear:true,isShowToday:true,isShowOthers:true,readOnly:false,errDealMode:0,autoPickDate:null,qsEnabled:true,disabledDates:null,disabledDays:null,opposite:false,onpicking:null,onpicked:null,onclearing:null,oncleared:null,eCont:null,vel:null,errMsg:"",quickSel:[],has:{}};WdatePicker=h;var e=window,o="document",u="documentElement",ab="getElementsByTagName",g,ac,k,v,a;switch(navigator.appName){case"Microsoft Internet Explorer":k=true;break;case"Opera":a=true;break;default:v=true;break}g=e;if(j.$crossFrame){try{while(g.parent[o]!=g[o]&&g.parent[o][ab]("frameset").length==0){g=g.parent}}catch(m){}}ac=s();if(j.$wdate){r(ac+"skin/WdatePicker.css")}var q;if(g.$dp){try{q=(g.$dp.$("MY")=="lIkEmY97")}catch(m){q=m.number==-2146823277?true:false}}if(!g.$dp||q){$dp=l({ff:v,ie:k,opera:a,el:null,win:e,status:q?2:0,defMinDate:j.minDate,defMaxDate:j.maxDate,$:function(A){try{this.win[o]}catch(B){return"lIkEmY97"}return(typeof A=="string")?this.win[o].getElementById(A):A},$D:function(B,A){return this.$DV(this.$(B).value,A)},$DV:function(C,D){if(C!=""){this.dt=$dp.cal.splitDate(C,$dp.cal.dateFmt);if(D){for(var B in D){if(this.dt[B]===undefined){this.errMsg="invalid property:"+B}this.dt[B]+=D[B]}}if(this.dt.refresh()){return this.dt}}return""},show:function(){if(this.dd){this.dd.style.display="block"}},hide:function(){if(this.dd){this.dd.style.display="none"}},attachEvent:z});if(!q){c(g,function(){h(null,true)})}}else{$dp=g.$dp}if(!e[o].docMD){z(e[o],"onmousedown",aa);e[o].docMD=true}if(!g[o].docMD){z(g[o],"onmousedown",aa);g[o].docMD=true}z(e,"onunload",function(){$dp.hide()});function l(A){g.$dp=g.$dp||{};for(var B in A){g.$dp[B]=A[B]}return g.$dp}function z(C,E,D){if(k){C.attachEvent(E,D)}else{var F=E.replace(/on/,"");D._ieEmuEventHandler=function(A){return D(A)};C.addEventListener(F,D._ieEmuEventHandler,false)}}function s(){var D,C,E=document.getElementsByTagName("script");for(var F=0;F<E.length;F++){D=E[F].src.substring(0,E[F].src.toLowerCase().indexOf("wdatepicker.js"));C=D.lastIndexOf("/");if(C>0){D=D.substring(0,C+1)}if(D){break}}return D}function y(P){var Q,J;if(P.substring(0,1)!="/"&&P.indexOf("://")==-1){Q=g.location.href;J=location.href;if(Q.indexOf("?")>-1){Q=Q.substring(0,Q.indexOf("?"))}if(J.indexOf("?")>-1){J=J.substring(0,J.indexOf("?"))}var N="",I="",L="",M,O,K="";for(M=0;M<Math.max(Q.length,J.length);M++){if(Q.charAt(M).toLowerCase()!=J.charAt(M).toLowerCase()){O=M;while(Q.charAt(O)!="/"){if(O==0){break}O-=1}N=Q.substring(O+1,Q.length);N=N.substring(0,N.lastIndexOf("/"));I=J.substring(O+1,J.length);I=I.substring(0,I.lastIndexOf("/"));break}}if(N!=""){for(M=0;M<N.split("/").length;M++){K+="../"}}if(I!=""){K+=I+"/"}P=K+P}j.$dpPath=P}function r(I,G,H){var J=e[o],F=J[ab]("HEAD").item(0),A=J.createElement("link");A.href=I;A.rel="stylesheet";A.type="text/css";if(G){A.title=G}if(H){A.charset=H}F.appendChild(A)}function c(B,A){z(B,"onload",A)}function x(I){I=I||g;var L=0,A=0;while(I!=g){var J=I.parent[o][ab]("iframe");for(var G=0;G<J.length;G++){try{if(J[G].contentWindow==I){var H=f(J[G]);L+=H.left;A+=H.top;break}}catch(K){}}I=I.parent}return{leftM:L,topM:A}}function f(P){if(k){return P.getBoundingClientRect()}else{var K={ROOT_TAG:/^body|html$/i,OP_SCROLL:/^(?:inline|table-row)$/i},N=null,M=P.offsetTop,O=P.offsetLeft,H=P.offsetWidth,J=P.offsetHeight,I=P.offsetParent;if(I!=P){while(I){O+=I.offsetLeft;M+=I.offsetTop;if(I.tagName.toLowerCase()=="body"){N=I.ownerDocument.defaultView}I=I.offsetParent}}I=P.parentNode;while(I.tagName&&!K.ROOT_TAG.test(I.tagName)){if(I.scrollTop||I.scrollLeft){if(!K.OP_SCROLL.test(I.style.display)){if(!a||I.style.overflow!=="visible"){O-=I.scrollLeft;M-=I.scrollTop}}}I=I.parentNode}var L=b(N);O-=L.left;M-=L.top;H+=O;J+=M;return{left:O,top:M,right:H,bottom:J}}}function p(B){B=B||g;var A=B[o];A=A[u]&&A[u].clientHeight&&A[u].clientHeight<=A.body.clientHeight?A[u]:A.body;return{width:A.clientWidth,height:A.clientHeight}}function b(E){E=E||g;var F=E[o],C=F[u],D=F.body;F=(C&&C.scrollTop!=null&&(C.scrollTop>D.scrollLeft||C.scrollLeft>D.scrollLeft))?C:D;return{top:F.scrollTop,left:F.scrollLeft}}function aa(D){src=D?(D.srcElement||D.target):null;if($dp&&$dp.dd&&$dp.dd.style.display=="block"&&src!=$dp.el){var C=$dp.el,F=$dp.cal,E=$dp.el[$dp.elProp];if(E!=null){$dp.$w.hideSel();if(E!=""&&!$dp.readOnly){F.date.loadFromDate(F.splitDate(E,F.dateFmt))}if(E==""||(F.isDate(F.date)&&F.isTime(F.date)&&F.checkValid(F.date))){F.mark(true);if(E!=""){F.update()}else{F.setRealValue("")}$dp.hide()}else{F.mark(false)}}else{$dp.hide()}}}var n=[];function d(){$dp.status=2;w()}function w(){if(n.length>0){var A=n.shift();A.el={innerHTML:""};A.eCont=$dp.$(A.eCont);A.autoPickDate=true;A.qsEnabled=false;t(A)}}function h(G,F){$dp.win=e;G=G||{};if(F){$dp.status=1;t({el:{innerHTML:""}},true)}else{if(G.eCont){n.push(G);if($dp.status==2){w()}}else{if($dp.status==0){$dp.status=1}if($dp.status!=2){return}var H,D=E();if(D){H=D.srcElement||D.target;D.cancelBubble=true}G.el=$dp.$(G.el||H);if(!G.el||G.el&&G.el.disabled||(G.el==$dp.el&&$dp.dd.style.display!="none"&&$dp.dd.style.left!="-1970px")){return}t(G)}}function E(){if(v){func=E.caller;while(func!=null){var A=func.arguments[0];if(A&&(A+"").indexOf("Event")>=0){return A}func=func.caller}return null}return event}}function t(E,D){for(var H in j){if(H.substring(0,1)!="$"){$dp[H]=j[H]}}for(H in E){if($dp[H]===undefined){$dp.errMsg="invalid property:"+H}else{$dp[H]=E[H]}}$dp.elProp=$dp.el&&$dp.el.nodeName=="INPUT"?"value":"innerHTML";if($dp.el[$dp.elProp]==null){return}if($dp.lang=="auto"){$dp.lang=k?navigator.browserLanguage.toLowerCase():navigator.language.toLowerCase()}if(!$dp.dd||$dp.eCont||($dp.lang&&$dp.realLang&&$dp.realLang.name!=$dp.lang)){if($dp.dd&&!$dp.eCont){g[o].body.removeChild($dp.dd)}if(j.$dpPath==""){y(ac)}var J='<iframe src="'+j.$dpPath+'My97DatePicker.htm" frameborder="0" border="0" scrolling="no"></iframe>';if($dp.eCont){$dp.eCont.innerHTML=J;c($dp.eCont.childNodes[0],d)}else{$dp.dd=g[o].createElement("DIV");$dp.dd.style.cssText="position:absolute;z-index:19700";$dp.dd.innerHTML=J;g[o].body.appendChild($dp.dd);c($dp.dd.childNodes[0],d);if(D){$dp.dd.style.left=$dp.dd.style.top="-1970px"}else{$dp.show();I()}}}else{if($dp.cal){$dp.show();$dp.cal.init();I()}}function I(){var N=$dp.position.left,R=$dp.position.top,M=f($dp.el),O=x(e),Q=p(g),K=b(g),P=$dp.dd.offsetHeight,L=$dp.dd.offsetWidth;if(isNaN(R)){if(R=="above"||(R!="under"&&((O.topM+M.bottom+P>Q.height)&&(O.topM+M.top-P>0)))){R=K.top+O.topM+M.top-P-3}else{R=K.top+O.topM+M.bottom}R+=k?-1:1}else{R+=K.top+O.topM}if(isNaN(N)){N=K.left+Math.min(O.leftM+M.left,Q.width-L-5)-(k?2:0)}else{N+=K.left+O.leftM}$dp.dd.style.top=R+"px";$dp.dd.style.left=N+"px"}}})();var ucapFlowSys={sUcapSystemPath:"/"+location.pathname.split("/")[1]+"/",servlet:"WorkFlowServlet",commSelect:"js/ucap/flow/commonSelect.jsp",sendJsp:"js/ucap/flow/ucapFlowSend.jsp",sendReadOnlyJsp:"js/ucap/flow/ucapFlowSendReadOnly.jsp",returnJsp:"js/ucap/flow/ucapFlowReturn.jsp",transferJsp:"js/ucap/flow/ucapFlowTransfer.jsp",opinionJsp:"js/ucap/flow/OpinionDialog.jsp",actionParams:["getFlowList","getNodeList","flowjsp","getSendFlowInfo","getParticipants","getUnidsByRolePos","getSubFlowInfo","sendFlow","completeFlow","getReturnFlowInfo","returnFlow","getTransferInfo","oldFlowJsp","OpinionSave","ucapXtree","getFlowListByIds","getFlowJspByTodoUnid","getDefaultType","getParticipantsByFilter"],split_str:"!@#",openFlowDocFun:"",openFlowDocFunParams:"",sendWin:null,par:"",selectDialogParam:{title:"",info:"",values:"",texts:"",callBack:null},sendFlowDialogRead:{nextApproveType:"",nextNode:"",values:""}};var ucapOpenFlow={isSubFlowDialog:false,flowReturn:{nextNodeUnid:"",auditType:"",nodeTransactors:"",nodeTransactorids:"",notNodeTransactors:"",notNodeTransactorids:""},openFlowDialog:function(a,c){this.isSubFlowDialog=false;if(typeof a!="undefined"){if(typeof a!="function"){Ext.Msg.alert("提示信息","回调函数只能是函数，不能是字段串(默认参数为新建流程文档的URL)");return}}ucapFlowSys.openFlowDocFun=a;ucapFlowSys.openFlowDocFunParams=c;var b={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:ucapFlowSys.actionParams[0]},callback:function(e,f,d){if(f){ucapOpenFlow._flowBox(d)}else{Ext.Msg.alert("提示","获取流程列表不成功")}}};Ext.Ajax.request(b)},_flowBox:function(e){var a=e.responseText;var g=_ucapXmlDom();g.loadXML(a);var b=g.selectSingleNode("//result/flag");if(b){if(b.text=="false"){var d=g.selectSingleNode("//result/msg");Ext.Msg.alert(d.text);return}}var c=g.selectNodes("//flow");ucapFlowSys.selectDialogParam.values=c[0].getAttribute("id");ucapFlowSys.selectDialogParam.texts=c[0].getAttribute("name");ucapFlowSys.selectDialogParam.title="新建流程对话框";ucapFlowSys.selectDialogParam.info="请选择一个流程";ucapFlowSys.selectDialogParam.callBack=ucapOpenFlow.openFlowByFlowUnid;for(var f=1;f<c.length;f++){ucapFlowSys.selectDialogParam.values+=ucapFlowSys.split_str+c[f].getAttribute("id");ucapFlowSys.selectDialogParam.texts+=ucapFlowSys.split_str+c[f].getAttribute("name")}if(c.length>1){ucapOpenFlow.openCommSelect(ucapFlowSys.selectDialogParam.callBack)}else{ucapOpenFlow.openFlowByFlowUnid(ucapFlowSys.selectDialogParam.values)}},openFlowDialogByFlowIds:function(d,a,c){this.isSubFlowDialog=false;if(typeof a!="undefined"){if(typeof a!="function"){Ext.Msg.alert("提示信息","回调函数只能是函数，不能是字段串(默认参数为新建流程文档的URL)");return}}ucapFlowSys.openFlowDocFun=a;ucapFlowSys.openFlowDocFunParams=c;var b={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:ucapFlowSys.actionParams[15],flowIds:d},callback:function(f,g,e){if(g){ucapOpenFlow._flowBox(e)}else{Ext.Msg.alert("提示","获取流程列表不成功")}}};Ext.Ajax.request(b)},openCommSelect:function(c){var b=ucapFlowSys.commSelect;var a=[{text:"确定",id:"commonConfirm",handler:function(){ucapOpenFlow.commonSelectConfirm(c)}},{text:"取消",handler:function(){ucapSession.commonWin.close()}}];var d=ucapFlowSys.selectDialogParam.title;ucapSession.commonWin=new Ext.Window({title:ucapSession.win.winImg+d,width:500,closable:true,modal:true,height:300,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:ucapSession.appPath+b,scripts:true,nocache:true},buttons:a});ucapSession.commonWin.show()},commonSelectConfirm:function(d){var a=ucapCommonFun.getFormJSon("dialogSelectHtml");var c=a.ucap_selects;var b=a.par;if(c==""){Ext.Msg.alert("提示信息","请选择一个值！");return}try{if(typeof d=="string"){ucapCommonFun.evalJavaScript(d+"('"+c+"','"+b+"')")}else{d.call(this,c,b)}ucapSession.commonWin.close()}catch(f){}},openFlowByFlowUnid:function(c){var b=function(f){var d=f.responseText;var h=_ucapXmlDom();h.loadXML(d);var e=h.selectNodes("//nodes/node");ucapFlowSys.selectDialogParam.values=e[0].getAttribute("id")+"~@"+e[0].getAttribute("formid")+"~@"+c;ucapFlowSys.selectDialogParam.texts=e[0].text;ucapFlowSys.selectDialogParam.title="选择节点对话框";ucapFlowSys.selectDialogParam.info="请选择一个要进入的节点";ucapFlowSys.selectDialogParam.callBack=ucapOpenFlow.openFlowByNodeUnid;for(var g=1;g<e.length;g++){ucapFlowSys.selectDialogParam.values+=ucapFlowSys.split_str+e[g].getAttribute("id")+"~@"+e[g].getAttribute("formid")+"~@"+c;ucapFlowSys.selectDialogParam.texts+=ucapFlowSys.split_str+e[g].text}if(e.length>1){ucapOpenFlow.openCommSelect(ucapFlowSys.selectDialogParam.callBack)}else{ucapOpenFlow.openFlowByNodeUnid(ucapFlowSys.selectDialogParam.values)}};var a={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:ucapFlowSys.actionParams[1],flowid:c},callback:function(e,f,d){if(f){b(d)}else{Ext.Msg.alert("提示","获取节点列表不成功")}}};Ext.Ajax.request(a)},openFlowByNodeUnid:function(f){var d=f.split("~@");var c="&flowid="+d[2]+"&nodeid="+d[0]+"&formid="+d[1]+"&unid=";if(ucapOpenFlow.isSubFlowDialog){var e=d[2];var a=d[0];ucapFlowFun.subFlowSendFlow(e,a,"");return}var g=function(j){var h=j.responseText;var m=_ucapXmlDom();m.loadXML(h);var l=m.selectSingleNode("//result");var k=ucapFlowSys.sUcapSystemPath+l.text+c;if(typeof(ucapFlowSys.openFlowDocFun)=="function"){if(typeof(ucapFlowSys.openFlowDocFunParams)!="undefined"){if(l.text==""){k=d[0]}}ucapFlowSys.openFlowDocFun.call(this,k,ucapFlowSys.openFlowDocFunParams)}else{if(l.text==""){Ext.Msg.alert("提示信息","找不到此流程对应的表单，可能是取表单的接口未实现，或此流程对应的表单ID为空！");return}window.open(k)}};var b={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:ucapFlowSys.actionParams[2],formid:d[1]},callback:function(j,k,h){if(k){g(h)}else{Ext.Msg.alert("提示","根据流程表单，获取JSP文件时出错！")}}};Ext.Ajax.request(b)},openOldFlowDoc:function(c,a,d){if(typeof a!="undefined"){if(typeof a!="function"){Ext.Msg.alert("提示信息","回调函数只能是函数，不能是字段串(默认参数为流程文档的URL)");return}}ucapFlowSys.openFlowDocFun=a;ucapFlowSys.openFlowDocFunParams=d;var e=function(k){var g=k.responseText;var n=_ucapXmlDom();n.loadXML(g);var j=n.selectNodes("//instance");if(!j||!j[0]){Ext.Msg.alert("文档打开提示","你没有权限打开此文档！");return}var m=j[0];var h=m.getAttribute("jsp");var f=m.getAttribute("id");if(j&&j.length==1){ucapOpenFlow._openDocByInstance(h+"~@"+f,c)}else{ucapFlowSys.selectDialogParam.values=h+"~@"+f;ucapFlowSys.selectDialogParam.texts=j[0].text;ucapFlowSys.selectDialogParam.title="要进入的流程选择对话框";ucapFlowSys.selectDialogParam.info="请选择一个你要进入的流程";ucapFlowSys.selectDialogParam.callBack=ucapOpenFlow._openDocByInstance;ucapFlowSys.par=c;for(var l=1;l<j.length;l++){h=j[l].getAttribute("jsp");f=j[l].getAttribute("id");ucapFlowSys.selectDialogParam.values+=ucapFlowSys.split_str+h+"~@"+f;ucapFlowSys.selectDialogParam.texts+=ucapFlowSys.split_str+j[l].text}ucapOpenFlow.openCommSelect(ucapFlowSys.selectDialogParam.callBack)}};var b={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet+"?"+c,params:{ucapid:ucapFlowSys.actionParams[12]},callback:function(g,h,f){if(h){e(f)}else{Ext.Msg.alert("提示","获取流程文档时出错！参数为："+c)}}};Ext.Ajax.request(b)},_openDocByInstance:function(g,d){var c=g.split("~@");var b=c[0];var a=c[1];if(b!=""){var f="";if(b.indexOf("?")>-1){f="&"}else{f="?"}d=f+"instanceUnid="+a+d;var e=ucapFlowSys.sUcapSystemPath+b+d;if(typeof(ucapFlowSys.openFlowDocFun)=="function"){if(typeof(ucapFlowSys.openFlowDocFunParams)!="undefined"){}ucapFlowSys.openFlowDocFun.call(this,e,ucapFlowSys.openFlowDocFunParams)}else{window.open(e)}}else{Ext.Msg.alert("提示信息","此流程对应的JSP文件未配置,请与管理员联系!")}},OpenFlowDocByTodoUnid:function(e,a,d){if(typeof(e)=="undefined"){e=""}if(e==""){Ext.Msg.alert("提示信息","待办事宜文档的UNID不能为空!");return}ucapFlowSys.openFlowDocFun=a;ucapFlowSys.openFlowDocFunParams=d;var c=function(k){var o=k.responseText;var l=_ucapXmlDom();l.loadXML(o);var f=l.selectNodes("//instance");var j=f[0];var h=j.getAttribute("jsp");var n=j.getAttribute("id");var g=j.getAttribute("docUnid");var m="&unid="+g;ucapOpenFlow._openDocByInstance(h+"~@"+n,m)};var b={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:ucapFlowSys.actionParams[16],todoUnid:e},callback:function(g,h,f){if(h){c(f)}else{Ext.Msg.alert("提示","获取流程文档时出错！参数为："+par)}}};Ext.Ajax.request(b)}};var ucapFlowFun={flowValue:{docUnid:"",instanceUnid:"",docTitle:"",actFlowUnid:"",actNodeUnid:"",type:"",opinionNo:"",endFlowUnid:""},sendFlowDialogConfirmFun:"",completeFlowConfirmFun:"",actionName:new Array("办理结束","收回","收回","阅批结束","结束此流程","收回子流程","退回上一节点","","子流程退回","收回转办"),_initValue:function(){this.flowValue=new Object();ucapOpenFlow.isSubFlowDialog=false},sendFlowOpinion:function(e){this._initValue();if(typeof(e)=="undefined"){e=""}this.flowValue.opinionNo=e;this.flowValue.docUnid=ucapGetUrlParameter("unid");if(this.flowValue.docUnid==""){Ext.Msg.alert("提示信息","当前文档是新文档，请先保存！");return}this.flowValue.instanceUnid=ucapGetUrlParameter("instanceUnid");this.flowValue.type="1";var b=400;var d=500;var a={ucapid:ucapFlowSys.actionParams[17],docUnid:ucapFlowFun.flowValue.docUnid,instanceUnid:ucapFlowFun.flowValue.instanceUnid};var c={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:a,callback:function(s,p,l){if(p){if(result.indexOf("false")==-1){var n=_ucapXmlDom();n.loadXML(result);var o=n.selectSingleNode("//doc");var m=ucapGetAttributeValue(o,"mode");if((typeof(m)=="undefined"||m==null||m==""||m=="2")){var h=ucapFlowFun.ucapFlowSendOk;if(ucapFlowFun.flowValue.opinionNo!=""){b+=80}ucapFlowFun.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendJsp,d,b,h)}else{if(m=="0"||m=="1"){var k={nextNodeUnid:"",auditType:"",nodeTransactors:"",nodeTransactorids:"",notNodeTransactors:"",notNodeTransactorids:""};var q=ucapGetAttributeValue(o,"flowid");k.auditType=ucapGetAttributeValue(o,"auditType");k.nextNodeUnid=ucapGetAttributeValue(o,"transition");var r=o.getElementsByTagName("transactor");var j=o.getElementsByTagName("notTransactors");if(r.length>0){k.nodeTransactorids=r[0].selectSingleNode("value").text;k.nodeTransactors=r[0].selectSingleNode("name").text}if(j.length>0){if(typeof(j[0])!="undefined"){k.nodeTransactorids=j[0].selectSingleNode("value").text;k.nodeTransactors=j[0].selectSingleNode("name").text}}var g=new Array();g[0]=k;if(m=="0"){var f=ucapFlowSys.sUcapSystemPath+ucapFlowSys.opinionJsp;ucapOpinion.openDialogDefault(f,b,d,"18",q,g)}else{if(m=="1"){ucapFlowSys.sendFlowDialogRead.values=k.nodeTransactors;ucapFlowSys.sendFlowDialogRead.nextNode=ucapGetAttributeValue(o,"nodeName");ucapFlowSys.sendFlowDialogRead.nextApproveType=ucapGetAttributeValue(o,"auditName");ucapFlowFun.openSendFlowDialogReadOnly(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendReadOnlyJsp,d,b,q,g)}}}}}else{var h=ucapFlowFun.ucapFlowSendOk;if(ucapFlowFun.flowValue.opinionNo!=""){b+=80}ucapFlowFun.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendJsp,d,b,h)}}else{Ext.Msg.alert("提示","获取默认类型时出错！参数为："+Ext.encode(a))}}};Ext.Ajax.request(c);return},sendFlow:function(g,f,d){this._initValue();if(typeof(f)=="undefined"){f=""}this.flowValue.opinionNo=f;this.flowValue.docUnid=ucapGetUrlParameter("unid");if(this.flowValue.docUnid==""){Ext.Msg.alert("提示信息","当前文档是新文档，请先保存！");return}this.flowValue.instanceUnid=ucapGetUrlParameter("instanceUnid");if(typeof(g)=="string"){if(g==""){g="0"}g=parseInt(g)}this.flowValue.type=g;var b=400;var e=500;if(g==2){b+=60}if(g==3){var a={ucapid:ucapFlowSys.actionParams[6],sendType:ucapFlowFun.flowValue.type,docUnid:ucapFlowFun.flowValue.docUnid,instanceUnid:ucapFlowFun.flowValue.instanceUnid};var c={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:a,callback:function(k,l,j){if(l){ucapOpenFlow.isSubFlowDialog=true;ucapOpenFlow._flowBox(j)}else{Ext.Msg.alert("提示","获取流程文档时出错！参数为："+Ext.encode(a))}}};Ext.Ajax.request(c);return}else{if(g==5){b=330;if(ucapFlowFun.flowValue.opinionNo!=""){b+=135}var h=ucapFlowFun.returnSendOk;this.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.returnJsp,e,b,h)}else{if(g==6){b=350;var h=ucapFlowFun.transSendOk;this.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.transferJsp,e,b,h)}else{if(g==1){var a={ucapid:ucapFlowSys.actionParams[17],docUnid:ucapFlowFun.flowValue.docUnid,instanceUnid:ucapFlowFun.flowValue.instanceUnid};var c={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:a,callback:function(u,r,n){if(r){var v=n.responseText;if(v.indexOf("false")==-1){var p=_ucapXmlDom();p.loadXML(v);var q=p.selectSingleNode("//doc");var o=ucapGetAttributeValue(q,"mode");if((typeof(o)=="undefined"||o==null||o==""||o=="2")){var k=ucapFlowFun.ucapFlowSendOk;if(ucapFlowFun.flowValue.opinionNo!=""){b+=80}ucapFlowFun.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendJsp,e,b,k)}else{if(o=="0"||o=="1"){var m={nextNodeUnid:"",auditType:"",nodeTransactors:"",nodeTransactorids:"",notNodeTransactors:"",notNodeTransactorids:""};var s=ucapGetAttributeValue(q,"flowid");m.auditType=ucapGetAttributeValue(q,"auditType");m.nextNodeUnid=ucapGetAttributeValue(q,"transition");var t=q.getElementsByTagName("transactor");var l=q.getElementsByTagName("notTransactors");if(t.length>0){m.nodeTransactorids=t[0].selectSingleNode("value").text;m.nodeTransactors=t[0].selectSingleNode("name").text}if(l.length>0){if(typeof(l[0])!="undefined"){m.nodeTransactorids=l[0].selectSingleNode("value").text;m.nodeTransactors=l[0].selectSingleNode("name").text}}var j=new Array();j[0]=m;if(o=="0"){ucapFlowFun.sendFlowConfirm(s,j,"")}else{if(o=="1"){ucapFlowSys.sendFlowDialogRead.values=m.nodeTransactors;ucapFlowSys.sendFlowDialogRead.nextNode=ucapGetAttributeValue(q,"nodeName");ucapFlowSys.sendFlowDialogRead.nextApproveType=ucapGetAttributeValue(q,"auditName");ucapFlowFun.openSendFlowDialogReadOnly(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendReadOnlyJsp,e,b,s,j)}}}}}else{var k=ucapFlowFun.ucapFlowSendOk;if(ucapFlowFun.flowValue.opinionNo!=""){b+=80}ucapFlowFun.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendJsp,e,b,k)}}else{Ext.Msg.alert("提示","获取默认类型时出错！参数为："+Ext.encode(a))}}};Ext.Ajax.request(c);return}else{var h=ucapFlowFun.ucapFlowSendOk;if(ucapFlowFun.flowValue.opinionNo!=""){b+=80}ucapFlowFun.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendJsp,e,b,h)}}}}},subFlowSendFlow:function(b,a,d){ucapFlowFun.flowValue.actFlowUnid=b;ucapFlowFun.flowValue.actNodeUnid=a;if(typeof(d)=="undefined"){d=""}ucapFlowFun.flowValue.endFlowUnid=d;if(ucapSession.commonWin){ucapSession.commonWin.close()}var c=ucapFlowFun.ucapFlowSendOk;ucapFlowFun.openSendFlowDialog(ucapFlowSys.sUcapSystemPath+ucapFlowSys.sendJsp,500,400,c)},sendFlowConfirm:function(d,c,e){var b=__getSendXmlDoc(d,c,e);Ext.MessageBox.show({msg:"正在提交中，请稍等...",progressText:"提交...",width:300,wait:true,waitConfig:{interval:300},icon:Ext.MessageBox.INFO});var a={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:ucapFlowSys.actionParams[7],sendType:this.flowValue.type,docUnid:this.flowValue.docUnid,instanceUnid:this.flowValue.instanceUnid},xmlData:b,callback:function(g,j,f){if(j){Ext.MessageBox.hide();var h=ucapFlowFun.sendFlowDialogConfirmFun;if(typeof(h)!="function"){h=ucapFlowFun.sendFlowPost}h.call(this,f,ucapFlowFun.flowValue.type)}else{Ext.Msg.alert("提示","发送给后时出错！")}}};Ext.Ajax.request(a)},sendFlowPost:function(a,b){alert("提交给下一步骤成功！");window.location=window.location},openSendFlowDialog:function(b,d,a,e){var c=[{text:"确定",id:"commonConfirm",handler:function(){if(typeof e=="function"){e.call(this)}else{Ext.Msg.alert("提示信息","没有正确设置回调函数："+e)}}},{text:"取消",handler:function(){ucapFlowSys.sendWin.close()}}];ucapFlowSys.sendWin=new Ext.Window({title:ucapSession.win.winImg+"发送对话框",width:d,closable:true,modal:true,height:a,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:b,scripts:true,nocache:true},buttons:c});ucapFlowSys.sendWin.show()},openSendFlowDialogReadOnly:function(b,e,a,f,d){var c=[{text:"确定",handler:function(){ucapFlowFun.sendFlowConfirm(f,d,"")}},{text:"取消",handler:function(){ucapFlowSys.sendWin.close()}}];ucapFlowSys.sendWin=new Ext.Window({title:ucapSession.win.winImg+"发送对话框",width:e,closable:true,modal:true,height:a,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:b,scripts:true,nocache:true},buttons:c});ucapFlowSys.sendWin.show()},completeFlow:function(d,c,a,b){this._initValue();if(typeof(c)=="undefined"){c=""}if(typeof(a)=="undefined"){a=""}if(typeof(b)=="undefined"){b=""}this.flowValue.opinionNo=c;this.flowValue.docUnid=ucapGetUrlParameter("unid");if(this.flowValue.docUnid==""){Ext.Msg.alert("提示信息","当前文档是新文档，请先保存！");return}var f=function(j){var g=j.responseText;var o=_ucapXmlDom();o.loadXML(g);var h=o.selectNodes("//subFlow");var n=h[0];var k=n.text;var m=n.getAttribute("subFlowInstanceId");if(h&&h.length==1){ucapFlowFun._subFlowCompleteFlow(m)}else{ucapFlowSys.selectDialogParam.values=h[0].getAttribute("subFlowInstanceId");ucapFlowSys.selectDialogParam.texts=h[0].text;ucapFlowSys.selectDialogParam.title="要收回的子流程选择对话框";ucapFlowSys.selectDialogParam.info="请选择一个你要收回的子流程";ucapFlowSys.selectDialogParam.callBack=ucapFlowFun._subFlowCompleteFlow;for(var l=1;l<h.length;l++){ucapFlowSys.selectDialogParam.values+=ucapFlowSys.split_str+h[l].getAttribute("subFlowInstanceId");ucapFlowSys.selectDialogParam.texts+=ucapFlowSys.split_str+h[l].text}ucapOpenFlow.openCommSelect(ucapFlowSys.selectDialogParam.callBack)}};this.flowValue.instanceUnid=ucapGetUrlParameter("instanceUnid");_ucapOpinionValue.completeType="";var e=function(){var h=ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet;if(d=="5"&&b!=""){h+="?subFlowUnid="+b}var g={url:h,params:{ucapid:ucapFlowSys.actionParams[8],completeType:d,docUnid:ucapFlowFun.flowValue.docUnid,instanceUnid:ucapFlowFun.flowValue.instanceUnid},callback:function(k,m,j){if(m){if(d=="5"&&b==""){f(j)}else{var l=ucapFlowFun.completeFlowConfirmFun;if(typeof(l)!="function"){l=ucapFlowFun.sendFlowPost}l.call(this,j,d)}}else{Ext.Msg.alert("提示","发送给后时出错！")}}};Ext.Ajax.request(g)};if(ucapFlowFun.flowValue.opinionNo!=""&&c!="-99"){if(a==""){a="退回意见"}_ucapOpinionValue.name=a;_ucapOpinionValue.completeType=d;ucapOpinion.opinionDialog(null,ucapFlowFun.flowValue.opinionNo);return}else{if(c!="-99"){if(d!="5"||b!=""){Ext.MessageBox.confirm("提示信息","你是否确定要执行"+this.actionName[d]+"操作?",function(g){if(g=="yes"){e()}else{return}})}else{e()}}else{e()}}},ucapFlowSendOk:function(){ucapFlowSendOk()},returnSendOk:function(){returnSendOk()},transSendOk:function(){transSendOk()},_subFlowCompleteFlow:function(a){ucapFlowFun.completeFlow("5","","",a)}};var _ucapOpinionValue={name:"",type:"",sendType:"",completeType:""};var _ucapOpinionSend={opinionObj:null,type:""};var ucapOpinion={win:null,opinionDialog:function(g,e,h,a,d,c){if(ucapFlowFun.flowValue.docUnid==""){ucapFlowFun.flowValue.docUnid=ucapGetUrlParameter("unid");ucapFlowFun.flowValue.instanceUnid=ucapGetUrlParameter("instanceUnid")}if(ucapFlowFun.flowValue.docUnid==""){alert("当前是新文档，请先保存！");return}if(typeof c=="undefined"){c="18"}var f=ucapFlowSys.sUcapSystemPath+ucapFlowSys.opinionJsp;if(typeof(e)=="undefined"){e="99"}if(g){_ucapOpinionValue.name=g.innerText}_ucapOpinionValue.type=e;if(typeof(h)=="undefined"){h=""}_ucapOpinionValue.sendType=h;_ucapOpinionSend.type="";if(h=="2"||h=="3"){_ucapOpinionSend.opinionObj=g;_ucapOpinionSend.type=e;var b={url:ucapFlowSys.sUcapSystemPath+ucapFlowSys.servlet,params:{ucapid:"opinionInfo",docUnid:ucapFlowFun.flowValue.docUnid,instanceUnid:ucapFlowFun.flowValue.instanceUnid},callback:function(k,l,j){if(l){ucapOpinion.getSend(j,h)}else{Ext.Msg.alert("提示","判断当前用户是否有发送权限时出错！")}}};Ext.Ajax.request(b)}else{this.openDialog(f,a,d,c)}},getSend:function(b,c){var a=b.responseText;var e=_ucapXmlDom();e.loadXML(a);var d=e.selectSingleNode("//doc");var f=ucapGetAttributeValue(d,"sendType");if(f!=""){if(c=="2"){ucapFlowFun.sendFlow(f,"1")}else{if(c=="3"){ucapFlowFun.sendFlowOpinion("1")}}}else{ucapOpinion.opinionDialog(_ucapOpinionSend.opinionObj,_ucapOpinionSend.type,"1")}},openDialog:function(b,a,e,d){if(typeof d=="undefined"){d=""}b=b+"?size="+d;if(typeof a=="undefined"||a==""){a=document.body.clientHeight-50}if(typeof e=="undefined"||e==""){e=document.body.clientWidth-100}var c=[{text:"确定",id:"commonConfirm",handler:function(){doOpinionOk();ucapOpinion.win.close()}},{text:"取消",handler:function(){ucapOpinion.win.close()}}];ucapOpinion.win=new Ext.Window({title:ucapSession.win.winImg+"意见填写框",width:e,closable:true,modal:true,height:a,maximizable:true,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:b,scripts:true,nocache:true},buttons:c});ucapOpinion.win.show()},openDialogDefault:function(b,a,f,d,g,e){if(typeof d=="undefined"){d=""}b=b+"?size="+d;if(typeof a=="undefined"||a==""){a=document.body.clientHeight-50}if(typeof f=="undefined"||f==""){f=document.body.clientWidth-100}var c=[{text:"确定",id:"commonConfirm",handler:function(){doOpinionOk(g,e);ucapOpinion.win.close()}},{text:"取消",handler:function(){ucapOpinion.win.close()}}];ucapOpinion.win=new Ext.Window({title:ucapSession.win.winImg+"意见填写框",width:f,closable:true,modal:true,height:a,maximizable:true,bodyStyle:ucapSession.win.winBodyStyle,autoLoad:{url:b,scripts:true,nocache:true},buttons:c});ucapOpinion.win.show()}};function __createXmlDoc(){var c=_ucapXmlDom();var d=c.createProcessingInstruction("xml","version='1.0' encoding='GBK'");c.appendChild(d);var a=c.createElement("doc");c.appendChild(a);var b=c.createElement("ucapFlow");a.appendChild(b);return c}function __getSendXmlDoc(g,e,h){var c=__createXmlDoc();var b=c.selectSingleNode("//ucapFlow");addAttrib(b,"nextFlowUnid",g);addAttrib(b,"nextFlowType",ucapFlowFun.flowValue.type);if(e[0].auditType==""){addAttrib(b,"endFlowNodeUnid",e[0].nextNodeUnid);return c}else{if(typeof(h)!="undefined"&&h!=""){addAttrib(b,"endFlowNodeUnid",h)}else{addAttrib(b,"endFlowNodeUnid","")}}if(e[0].auditType=="8888"){addAttrib(b,"isSendConvergeNodeId","1");return c}addAttrib(b,"isSendConvergeNodeId","");for(var d=0;d<e.length;d++){var a=c.createElement("sendValue");b.appendChild(a);var f=c.createElement("nextNodeUnid");f.text=e[d].nextNodeUnid;a.appendChild(f);var f=c.createElement("auditType");f.text=e[d].auditType;a.appendChild(f);var f=c.createElement("nodeTransactorids");f.text=e[d].nodeTransactorids;a.appendChild(f);var f=c.createElement("notNodeTransactorids");f.text=e[d].notNodeTransactorids;a.appendChild(f)}return c}function ucapGetUrlParameter(b){var d=location.search.slice(1).split("&");for(var c=0;c<d.length;c++){var a=d[c].split("=");if(a[0]==b){return a[1]}}return""}function _ucapXmlDom(){if(window.ActiveXObject){var d=["MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom"];for(var b=0;b<d.length;b++){try{var a=new ActiveXObject(d[b]);return a}catch(c){}}throw new Error("MSXML is not installed on your system.")}else{if(document.implementation&&document.implementation.createDocument){var a=document.implementation.createDocument("","",null);a.parseError={valueOf:function(){return this.errorCode},toString:function(){return this.errorCode.toString()}};a.__initError__();a.addEventListener("load",function(){this.__checkForErrors__();this.__changeReadyState__(4)},false);return a}else{throw new Error("Your browser doesn't support an XML DOM object.")}}}var _sUserAgent=navigator.userAgent;var _isOpera=_sUserAgent.indexOf("Opera")>-1;var _isIE=_sUserAgent.indexOf("compatible")>-1&&_sUserAgent.indexOf("MSIE")>-1&&!_isOpera;var _isKHTML=_sUserAgent.indexOf("KHTML")>-1||_sUserAgent.indexOf("Konqueror")>-1||_sUserAgent.indexOf("AppleWebKit")>-1;var _isMoz=_sUserAgent.indexOf("Gecko")>-1&&!_isKHTML;if(_isMoz){Document.prototype.readyState=0;Document.prototype.onreadystatechange=null;Document.prototype.__changeReadyState__=function(a){this.readyState=a;if(typeof this.onreadystatechange=="function"){this.onreadystatechange()}};Document.prototype.__initError__=function(){this.parseError.errorCode=0;this.parseError.filepos=-1;this.parseError.line=-1;this.parseError.linepos=-1;this.parseError.reason=null;this.parseError.srcText=null;this.parseError.url=null};Document.prototype.__checkForErrors__=function(){if(this.documentElement.tagName=="parsererror"){var a=/>([\s\S]*?)Location:([\s\S]*?)Line Number (\d+), Column (\d+):<sourcetext>([\s\S]*?)(?:\-*\^)/;a.test(this.xml);this.parseError.errorCode=-999999;this.parseError.reason=RegExp.$1;this.parseError.url=RegExp.$2;this.parseError.line=parseInt(RegExp.$3);this.parseError.linepos=parseInt(RegExp.$4);this.parseError.srcText=RegExp.$5}};Document.prototype.loadXML=function(e){this.__initError__();this.__changeReadyState__(1);var b=new DOMParser();var a=b.parseFromString(e,"text/xml");while(this.firstChild){this.removeChild(this.firstChild)}for(var d=0;d<a.childNodes.length;d++){var c=this.importNode(a.childNodes[d],true);this.appendChild(c)}this.__checkForErrors__();this.__changeReadyState__(4)};Document.prototype.__load__=Document.prototype.load;Document.prototype.load=function(a){this.__initError__();this.__changeReadyState__(1);this.__load__(a)};Node.prototype.__defineGetter__("xml",function(){var a=new XMLSerializer();return a.serializeToString(this,"text/xml")})}function addAttrib(b,a,d){var c=b.ownerDocument.createAttribute(a);c.value=d;b.setAttributeNode(c)}function ucapGetAttributeValue(b,c){var a=b.getAttribute(c);if(a==null){return""}else{return a.trim()}}String.prototype.trim=function(){var a=this.match(/^\s*(\S+(\s+\S+)*)\s*$/);return(a==null)?"":a[1]};function _ucapVisualFlow(){window.open(sUcapSystemPath+"jsp/common/visualflow.jsp")};